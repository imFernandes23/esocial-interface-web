import{c as we}from"./chunk-MI4H3XG5.js";import{a as Me}from"./chunk-ENKFK5UL.js";import"./chunk-KBWQJKVL.js";import{C as m,Da as le,E as fe,Ea as ae,F as oe,Fa as Ie,Ia as ce,J as S,K as be,Ka as Se,Na as Te,O as se,P as h,Q as p,R as d,S as G,V as F,W as A,X as Ce,Y as U,_ as D,a as j,aa as f,b as H,d as ne,da as Ee,e as ie,ea as ye,fa as Ne,ga as V,i as he,ia as Q,ja as _,k as _e,ka as $,la as q,o as xe,q as J,t as z,u as P,v as k,w as re,wa as X,y as W,z as ve,za as B}from"./chunk-OT5C62IN.js";var me=class o{catalog=z(Me);treeSvc=z(we);buildViewTreeFromLatest(t){let e=this.catalog.getLatestSchema();if(!e)throw new Error("Nenhum conjunto de schemas carregado.");let n=e.files?.[t];if(!n)throw new Error(`XSD do evento n\xE3o encontrado: ${t}`);let i=e.events?.find(v=>v.isTipos)?.fileName??Object.keys(e.files||{}).find(v=>/tipos\.xsd$/i.test(v))??Object.keys(e.files||{}).find(v=>/tipos/i.test(v));if(!i)throw new Error("Arquivo tipos.xsd n\xE3o encontrado no conjunto.");let r=e.files[i],s=this.treeSvc.buildEventoTree(n,r),l=this.toView(s,new Set),g=e.events?.find(v=>v.fileName===t)?.label||t;return{code:(g.match(/S-\d{3,4}/i)?.[0]||t.match(/S-\d{3,4}/i)?.[0]||"\u2014").toUpperCase(),title:g,root:l}}toView(t,e){let n=t.id||`${t.kind}:${t.name}:${e.size}`;if(e.has(n))return{id:n,name:t.name,kind:t.kind,meta:t.meta,source:t,children:[]};e.add(n);let i=(t.children||[]).map(r=>this.toView(r,e));return{id:n,name:t.name,kind:t.kind,meta:t.meta,source:t,children:i}}static \u0275fac=function(e){return new(e||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})};var Z=class o{fields=W({});choices=W({});groupCounts=W({});choiceMeta=W({});normStrict(t){return("/"+(t||"").replace(/^\/+/,"")).trim()}stripRoot(t){return this.normStrict(t).replace(/^\/eSocial\//i,"/")}resolveKey(t,e){if(!e)return;if(t[e]!==void 0)return e;let n=this.stripRoot(e);for(let i of Object.keys(t))if(this.stripRoot(i).endsWith(n))return i}registerField(t,e,n=""){if(!t)return;let i=this.fields();i[t]||this.fields.set(H(j({},i),{[t]:{type:e,value:n??""}}))}setValue(t,e,n){t&&this.fields.update(i=>{let r=i[t],s=n??r?.type??"text";return H(j({},i),{[t]:{type:s,value:e??""}})})}getValue(t){let e=this.fields(),n=this.resolveKey(e,t)??t;return e[n]?.value??""}getType(t){let e=this.fields(),n=this.resolveKey(e,t)??t;return e[n]?.type}getText(t){return this.getValue(t)}setText(t,e){this.setValue(t,e,"text")}getEnum(t){return this.getValue(t)}setEnum(t,e){this.setValue(t,e,"enum")}setNumber(t,e){this.setValue(t,e,"number")}setDate(t,e){this.setValue(t,e,"date")}clearByPath(t){if(!t)return;let i=this.fields(),{[t]:e}=i,n=ie(i,[ne(t)]);this.fields.set(n)}clearByPrefix(t){if(!t)return;let e=this.fields(),n={},i=t.endsWith("/")?t:t+"/";for(let r of Object.keys(e))r===t||r.startsWith(i)||(n[r]=e[r]);this.fields.set(n)}getChoice(t){let e=this.choices(),n=this.resolveKey(e,t)??t;return e[n]}setChoice(t,e,n){this.choices.update(l=>{let a=this.resolveKey(l,t)??t;return H(j({},l),{[a]:e})}),n&&this.choiceMeta.update(l=>{let a=this.resolveKey(l,t)??t;return H(j({},l),{[a]:{basePath:n.basePath??"",optionElementNames:n.optionElementNames??[],chosenElementName:n.chosenElementName??""}})});let i=n?.basePath??"",r=n?.optionElementNames??[],s=n?.chosenElementName??"";if(i&&r.length)for(let l of r){if(l===s)continue;let a=i.endsWith("/")?`${i}${l}`:`${i}/${l}`;this.clearByPrefix(a)}}clearChoice(t){let e=this.choices(),n=this.resolveKey(e,t)??t,u=e,{[n]:i}=u,r=ie(u,[ne(n)]);this.choices.set(r);let s=this.choiceMeta(),l=this.resolveKey(s,t)??t,v=s,{[l]:a}=v,g=ie(v,[ne(l)]);this.choiceMeta.set(g)}getGroupCount(t){let e=this.groupCounts(),n=this.resolveKey(e,t)??t;return e[n]??0}setGroupCount(t,e){if(!t)return;e=Math.max(0,e|0);let n=this.getGroupCount(t);for(let i=n;i>e;i--)this.clearByPrefix(`${t}[${i}]`);this.groupCounts.update(i=>H(j({},i),{[t]:e}))}addGroup(t){let e=this.getGroupCount(t)+1;return this.setGroupCount(t,e),e}removeGroup(t){let e=this.getGroupCount(t);e<=0||(this.clearByPrefix(`${t}[${e}]`),this.groupCounts.update(n=>H(j({},n),{[t]:e-1})))}snapshot(){return{fields:this.fields(),choices:this.choices(),groupCounts:this.groupCounts(),choiceMeta:this.choiceMeta()}}asJson(){return this.snapshot()}resetAll(){this.fields.set({}),this.choices.set({}),this.groupCounts.set({}),this.choiceMeta.set({})}loadSnapshot(t){this.fields.set(j({},t.fields??{})),this.choices.set(j({},t.choices??{})),this.groupCounts.set(j({},t.groupCounts??{})),this.choiceMeta.set(j({},t.choiceMeta??{}))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})};function Oe(o){o||(o=z(re));let t=new he(e=>{if(o.destroyed){e.next();return}return o.onDestroy(e.next.bind(e))});return e=>e.pipe(xe(t))}var ee=class o{doc=null;pathSubjects=new Map;parentOrders=new Map;registerOrder(t,e){this.parentOrders.set(this.normalizePath(t),e.slice())}normalizePath(t){return(t||"").replace(/\[\d+]/g,"")}init(t="eSocial"){let e=`<?xml version="1.0" encoding="UTF-8"?><${t}/>`;this.doc=new DOMParser().parseFromString(e,"application/xml"),this.ensureDsXmlns(),this.emitAll()}ensureDoc(){return this.doc||this.init("eSocial"),this.doc}NS={ds:"http://www.w3.org/2000/09/xmldsig#"};observe(t){return this.subjectFor(t).asObservable()}subjectFor(t){let e=this.pathSubjects.get(t);return e||(e=new _e(this.getValue(t)??""),this.pathSubjects.set(t,e)),e}emitAll(){for(let[t,e]of this.pathSubjects.entries())e.next(this.getValue(t)??"")}getValue(t){let e=this.ensureDoc(),{attr:n,elementPath:i}=this.splitAttr(t),r=this.ensureElement(e,i,!1);return r?n?r.getAttribute(n)??"":r.textContent??"":""}setValue(t,e){let n=this.ensureDoc(),{attr:i,elementPath:r}=this.splitAttr(t),s=this.ensureElement(n,r,!0);if(s){if(i)s.setAttribute(i,e??"");else{for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(n.createTextNode(e??""))}this.subjectFor(t).next(e??"")}}serialize(t=!0){let e=this.ensureDoc();return this.ensureDsXmlns(),t?this.prettyFromDoc(e):new XMLSerializer().serializeToString(e)}prettyFromDoc(t){let e=['<?xml version="1.0" encoding="UTF-8"?>'],n=r=>"  ".repeat(r),i=(r,s)=>{let l=Array.from(r.attributes).map(u=>`${u.name}="${u.value}"`).join(" "),a=l?`<${r.tagName} ${l}>`:`<${r.tagName}>`,g=Array.from(r.childNodes).filter(u=>u.nodeType!==Node.TEXT_NODE?!0:(u.nodeValue??"").trim()!=="");if(g.length===0){e.push(`${n(s)}${a.replace(">","/>")}`);return}if(g.length===1&&g[0].nodeType===Node.TEXT_NODE){e.push(`${n(s)}${a}${(g[0].nodeValue??"").trim()}</${r.tagName}>`);return}e.push(`${n(s)}${a}`);for(let u of g)u.nodeType===Node.ELEMENT_NODE?i(u,s+1):u.nodeType===Node.TEXT_NODE&&e.push(`${n(s+1)}${(u.nodeValue??"").trim()}`);e.push(`${n(s)}</${r.tagName}>`)};return i(t.documentElement,0),e.join(`
`)}debugDump(){console.group("[LiveXML dump]");for(let[t,e]of this.pathSubjects.entries())console.log(t,"=>",e.getValue());console.groupEnd()}import(t){this.doc=new DOMParser().parseFromString(t,"application/xml");let n=this.ensureDoc().documentElement,i=(r,s)=>{for(let u of Array.from(r.attributes)){let v=`${s}/@${u.name}`;this.subjectFor(v).next(u.value)}let l=r.children.length>0,a=(r.textContent??"").trim();!l&&a!==""&&this.subjectFor(s).next(a);let g=new Map;for(let u of Array.from(r.children)){let v=g.get(u.tagName)??[];v.push(u),g.set(u.tagName,v)}for(let[u,v]of g.entries())v.forEach((w,O)=>{i(w,`${s}/${u}[${O+1}]`)})};i(n,n.tagName),this.emitAll()}ensureNsOnRoot(t,e){let n=e.documentElement,i=`xmlns:${t}`;if(!n.hasAttribute(i)){let r=this.NS[t];r&&n.setAttribute(i,r)}}ensureDsXmlns(){if(!this.doc)return;let t=this.doc.documentElement;if(!t)return;let e=this.NS.ds;(this.doc.getElementsByTagNameNS(e,"*").length>0||this.doc.getElementsByTagName("ds:Signature").length>0)&&!t.hasAttribute("xmlns:ds")&&t.setAttribute("xmlns:ds",e)}createElementSmart(t,e){if(e.includes(":")){let[n]=e.split(":",1),i=this.NS[n],r=i?t.createElementNS(i,e):t.createElement(e);return i&&this.ensureNsOnRoot(n,t),r}return t.createElement(e)}splitAttr(t){let e=t.lastIndexOf("/@");return e>=0?{elementPath:t.slice(0,e),attr:t.slice(e+2)}:{elementPath:t}}parsePart(t){let e=t.match(/^([^\[]+)(?:\[(\d+)])?$/);return{name:e?.[1]??t,index:e?.[2]?parseInt(e[2],10):1}}ensureElement(t,e,n){let i=(e||"").split("/").filter(Boolean);if(i.length===0)return null;let r=this.parsePart(i[0]),s=t.documentElement;if(!s||s.tagName!==r.name){if(!n)return null;this.init(r.name),t=this.ensureDoc(),s=t.documentElement}let l=s,a=this.normalizePath(s.tagName);for(let g=1;g<i.length;g++){let{name:u,index:v}=this.parsePart(i[g]),w=this.nthChildOrdered(t,l,a,u,v,n);if(!w)return null;l=w,a=this.normalizePath(a+"/"+u+(v?`[${v}]`:""))}return l}resolveElement(t){let e=this.ensureDoc();return this.ensureElement(e,t,!1)}ensurePath(t){let e=this.ensureDoc(),{attr:n,elementPath:i}=this.splitAttr(t);if(n)throw new Error("ensurePath n\xE3o manipula atributos.");let r=this.ensureElement(e,i,!0);if(!r)throw new Error(`Falha ao garantir path: ${t}`);return r}getElement(t){return this.resolveElement(t)}setGroupCount(t,e){this._setGroupCountInternal(t,e),this.emitAll()}_setGroupCountInternal(t,e){let n=this.ensureDoc(),i=t.split("/").filter(Boolean);if(i.length<2)return;let r=this.ensureElement(n,i.slice(0,-1).join("/"),!0);if(!r)return;let s=i[i.length-1],l=Array.from(r.children).filter(a=>a.tagName===s);if(l.length<e)for(let a=l.length+1;a<=e;a++)this.nthChildOrdered(n,r,this.normalizePath(i.slice(0,-1).join("/")),s,a,!0);else if(l.length>e)for(let a=l.length-1;a>=e;a--)r.removeChild(l[a])}count(t){let e=this.ensureDoc(),n=t.split("/").filter(Boolean);if(!n.length)return 0;let i=n.slice(0,-1),r=n[n.length-1],s=r.match(/^(.+?)(?:\[(\d+)])?$/),l=s?.[1]??r,a=s?.[2]?parseInt(s[2],10):void 0,g=i.length?this.ensureElement(e,i.join("/"),!1):e.documentElement;if(!g)return 0;let u=Array.from(g.children).filter(v=>v.tagName===l);return a!=null?a<=u.length?1:0:u.length}getText(t){return this.resolveElement(t)?.textContent?.trim()??""}validateXml(t){try{let n=new DOMParser().parseFromString(t,"application/xml").querySelector("parsererror");return n?{ok:!1,error:n.textContent||"XML inv\xE1lido"}:{ok:!0}}catch(e){return{ok:!1,error:e?.message||"XML inv\xE1lido"}}}nthChildOrdered(t,e,n,i,r,s=!0){let l=Array.from(e.children).filter(u=>u.tagName===i);if(l.length>=r)return l[r-1];if(!s)return null;let a=this.parentOrders.get(n),g=()=>{let u=this.createElementSmart(t,i),v=Array.from(e.children).filter(w=>w.tagName===i).pop();if(v)return v.nextSibling?e.insertBefore(u,v.nextSibling):e.appendChild(u),u;if(a){let w=a.indexOf(i);if(w>=0){let O=Array.from(e.children);for(let L of O){let Y=a.indexOf(L.tagName);if(Y>=0&&Y>w)return e.insertBefore(u,L),u}}}return e.appendChild(u),u};for(;Array.from(e.children).filter(u=>u.tagName===i).length<r;)g();return Array.from(e.children).filter(u=>u.tagName===i)[r-1]??null}makeEventId(t){let e=(s,l)=>String(s).padStart(l,"0"),n=new Date,i=`${n.getFullYear()}${e(n.getMonth()+1,2)}${e(n.getDate(),2)}${e(n.getHours(),2)}${e(n.getMinutes(),2)}${e(n.getSeconds(),2)}`,r=e(Math.floor(Math.random()*1e7),7);return`ID${t??"00000000000000"}${i}${r}`}ensureEventId(t){let e=this.ensurePath(t);e.getAttribute("Id")||e.setAttribute("Id",this.makeEventId())}setChoice(t,e,n){let i=this.getElement(t)??this.ensurePath(t);for(let r of Array.from(i.children))e.includes(r.tagName)&&r.tagName!==n&&i.removeChild(r);n&&(Array.from(i.children).some(s=>s.tagName===n)||i.appendChild(this.ensureDoc().createElement(n))),this.emitAll()}enforceOrderEverywhere(){if(!this.doc)return;let t=(e,n)=>{let i=this.normalizePath(n),r=this.parentOrders.get(i);if(r&&e.children.length>1){let l=Array.from(e.children);l.sort((a,g)=>{let u=r.indexOf(a.tagName),v=r.indexOf(g.tagName);return u<0&&v<0?0:u<0?1:v<0?-1:u-v});for(let a of l)e.appendChild(a)}let s={};for(let l of Array.from(e.children)){let a=l.tagName,g=s[a]=(s[a]??0)+1;t(l,`${i}/${a}[${g}]`)}};t(this.doc.documentElement,this.doc.documentElement.tagName)}toAbsPath(t,e){let n=(t||"").replace(/^\/+/,"");if(!n)return e;if(n.startsWith(e))return n;let[i,r]=e.split("/");return n.startsWith(i+"/")?n:n.startsWith(r+"/")?`${i}/${n}`:`${e}/${n}`}applySnapshot(t,e,n="eSocial"){if(!e)return;let i=this.ensureDoc(),r=`${n}/${t}`;this.ensurePath(r),this.ensureEventId(r);let s=e.choiceMeta||{};for(let[a,g]of Object.entries(e.choices||{})){let u=s[a];if(!u)continue;let v=this.toAbsPath(u.basePath,r);this.setChoice(v,u.optionElementNames||[],u.chosenElementName||null)}for(let[a,g]of Object.entries(e.groupCounts||{})){let u=this.toAbsPath(a,r);this.setGroupCount(u,Number(g)||0)}let l=Object.entries(e.fields||{});l.sort((a,g)=>a[0].split("/").length-g[0].split("/").length);for(let[a,g]of l){let u=this.toAbsPath(a,r),{elementPath:v,attr:w}=this.splitAttr(u),O=this.ensureElement(i,v,!0);if(!O)continue;let L=(g?.value??"").toString();if(w)O.setAttribute(w,L);else{for(;O.firstChild;)O.removeChild(O.firstChild);L!==""&&O.appendChild(i.createTextNode(L))}}this.enforceOrderEverywhere(),this.emitAll()}buildSnapshotFromXml(t,e,n,i="eSocial"){let r={},s={},l={},a={},u=new DOMParser().parseFromString(t,"application/xml").documentElement;if(!u||u.tagName!==i)return{fields:{},groupCounts:{},choices:{},choiceMeta:{}};let v=Array.from(u.children).find(c=>c.tagName===n);if(!v)return{fields:{},groupCounts:{},choices:{},choiceMeta:{}};let w=c=>(c||"").toLowerCase(),O=c=>{if(!c)return null;if(w(c.kind)==="element"&&c.name)return c.name;for(let x of c.children||[]){let b=O(x);if(b)return b}return null},L=c=>{let x=c.split("/").filter(Boolean),b=v;for(let C=0;C<x.length;C++){let E=x[C].match(/^(.+?)(?:\[(\d+)])?$/),y=E?.[1]??x[C],I=E?.[2]?parseInt(E[2],10):void 0,M=Array.from(b.children).filter(N=>N.tagName===y);if(C===x.length-1&&I==null)return M.length;if(b=I==null?M[0]??null:M[I-1]??null,!b)return 0}return b?1:0},Y=c=>{let x=c.split("/").filter(Boolean),b=v;for(let E=0;E<x.length;E++){let y=x[E].match(/^(.+?)(?:\[(\d+)])?$/),I=y?.[1]??x[E],M=y?.[2]?parseInt(y[2],10):1;if(b=Array.from(b.children).filter(T=>T.tagName===I)[M-1]??null,!b)return null}return(b.textContent??"").trim()||null},pe=(c,x)=>{let b=c.split("/").filter(Boolean),C=v;for(let y=0;y<b.length;y++){let I=b[y].match(/^(.+?)(?:\[(\d+)])?$/),M=I?.[1]??b[y],N=I?.[2]?parseInt(I[2],10):1;if(C=Array.from(C.children).filter(R=>R.tagName===M)[N-1]??null,!C)return null}return(C.getAttribute(x)??"").trim()||null},ge=c=>w(c?.meta?.base||c?.meta?.typeName||"").includes("date")?"date":c?.meta?.numericFacets?"number":(c?.children||[]).some(b=>w(b.kind)==="enumeration")?"enum":"text",K=(c,x)=>{if(!c)return;let b=w(c.kind);if(b==="choice"){let C=(c.children||[]).map(N=>O(N)).filter(Boolean),E=null,y="";for(let N of c.children||[]){let T=O(N);if(!T)continue;let R=x?`${x}/${T}`:T;if(L(R)>0){E=T,y=N.id;break}}let I=`${x}::choice@${c.id}`;E&&y&&(l[I]=y,a[I]={basePath:x,optionElementNames:Array.from(new Set(C)),chosenElementName:E});let M=(c.children||[]).find(N=>N.id===y);M&&E&&K(M,x);return}if(b==="attribute"){let C=c.name;if(!C)return;let E=pe(x,C);E!=null&&(r[`${x}/@${C}`]={type:"text",value:E});return}if(b==="element"){let C=c.name,E=x?`${x}/${C}`:C,y=L(E),I=c.meta?.occurs?.max;if((I==="unbounded"||typeof I=="number"&&I>1)&&(s[E]=y),(c.children||[]).length)for(let N=1;N<=Math.max(y,0);N++)for(let T of c.children||[])K(T,`${E}[${N}]`);else{let N=ge(c);for(let T=1;T<=Math.max(y,0);T++){let R=`${E}[${T}]`,te=Y(R);te!=null&&(r[R]={type:N,value:te})}}return}if((c.children||[]).length)for(let C of c.children)K(C,x)};return K(e,""),{fields:r,groupCounts:s,choices:l,choiceMeta:a}}static \u0275fac=function(e){return new(e||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})};function Ve(o,t){if(o&1){let e=U();p(0,"span",20)(1,"button",21),D("click",function(){P(e);let i=f(2);return k(i.decOcc(i.node))}),_(2,"\u2212"),d(),p(3,"span",22),_(4),d(),p(5,"button",21),D("click",function(){P(e);let i=f(2);return k(i.incOcc(i.node))}),_(6,"+"),d()()}if(o&2){let e=f(2);m(),h("disabled",!e.canRemove(e.node)),m(3),$(e.occCount(e.node)),m(),h("disabled",!e.canAdd(e.node))}}function Xe(o,t){if(o&1&&(p(0,"span",23),_(1),d()),o&2){let e=f(2);m(),$(e.occCount(e.node))}}function Fe(o,t){if(o&1&&(F(0),p(1,"div",26)(2,"div",27),_(3),d(),G(4,"app-xs-tree-node",28),d(),A()),o&2){let e=t.index,n=f(3);m(3),q("Inst\xE2ncia ",e+1),m(),h("node",n.node)("vPrefix",n.vPrefix)("disableRepeat",!0)("instanceIndex",e)("lite",n.lite)}}function Ae(o,t){if(o&1&&(p(0,"div",24),S(1,Fe,5,6,"ng-container",25),d()),o&2){let e=f(2);m(),h("ngForOf",e.occIndexes(e.node))}}function Re(o,t){if(o&1&&(F(0),p(1,"details",14)(2,"summary",15)(3,"span",16),_(4),d(),S(5,Ve,7,3,"span",17)(6,Xe,2,1,"span",18),d(),S(7,Ae,2,1,"div",19),d(),A()),o&2){let e=f();m(4),$(e.node.name||e.node.kind),m(),h("ngIf",!e.lite),m(),h("ngIf",e.lite),m(),h("ngIf",e.occCount(e.node)>0)}}function Le(o,t){if(o&1&&Ce(0,29),o&2){f();let e=V(4);h("ngTemplateOutlet",e)}}function je(o,t){if(o&1&&(F(0),G(1,"app-xs-tree-node",30),A()),o&2){let e=t.$implicit,n=f(3);m(),h("node",e)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)("lite",n.lite)}}function ze(o,t){if(o&1&&(F(0),S(1,je,2,4,"ng-container",25),A()),o&2){let e=f(2);m(),h("ngForOf",e.node.children)}}function qe(o,t){if(o&1&&(F(0),p(1,"div",31)(2,"span",32),_(3),d(),p(4,"span",33),_(5),d()(),A()),o&2){let e=f(3);m(3),q("",e.label(),":"),m(2),$(e.displayValue()||"\u2014")}}function Be(o,t){if(o&1&&(p(0,"li"),_(1),d()),o&2){let e=t.$implicit;m(),$(e)}}function We(o,t){if(o&1&&(p(0,"div",35)(1,"ul",36),S(2,Be,2,1,"li",25),d()()),o&2){let e=f(4);m(2),h("ngForOf",e.node.meta==null?null:e.node.meta.docs)}}function Ke(o,t){if(o&1&&(p(0,"option",42),_(1),d()),o&2){let e=t.$implicit;h("value",e.id),m(),q(" ",e.name||"op\xE7\xE3o"," ")}}function Ue(o,t){if(o&1){let e=U();p(0,"div",38)(1,"label"),_(2,"Escolha uma op\xE7\xE3o:"),d(),p(3,"select",39),D("change",function(i){P(e);let r=f(5);return k(r.onChoose(i.target.value))}),p(4,"option",40),_(5,"\u2014 selecione \u2014"),d(),S(6,Ke,2,2,"option",41),d()()}if(o&2){let e=f(5);m(3),h("value",e.selectedChoiceId()),m(3),h("ngForOf",e.node.children)}}function He(o,t){if(o&1&&(p(0,"div",24),G(1,"app-xs-tree-node",30),d()),o&2){let e=t.ngIf,n=f(5);m(),h("node",e)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)("lite",n.lite)}}function Ge(o,t){if(o&1&&(F(0),S(1,Ue,7,2,"div",37)(2,He,2,4,"div",19),A()),o&2){let e=f(4);m(),h("ngIf",!e.lite),m(),h("ngIf",e.selectedChild())}}function Ye(o,t){if(o&1&&(p(0,"option",42),_(1),d()),o&2){let e=t.$implicit,n=f(7);h("value",e.name),m(),q(" ",n.enumLabel(e)," ")}}function Je(o,t){if(o&1){let e=U();p(0,"div",44)(1,"label"),_(2,"Selecionar:"),d(),p(3,"select",39),D("change",function(i){P(e);let r=f(6);return k(r.onChooseEnum(i.target.value))}),p(4,"option",40),_(5,"\u2014 selecione \u2014"),d(),S(6,Ye,2,2,"option",41),d()()}if(o&2){let e=f(6);m(3),h("value",e.selectedEnum()),m(3),h("ngForOf",e.enumOptions())}}function Qe(o,t){if(o&1&&(p(0,"div",31)(1,"span",32),_(2),d(),p(3,"span",33),_(4),d()()),o&2){let e=f(6);m(2),q("",e.label(),":"),m(2),$(e.displayValue()||"\u2014")}}function Ze(o,t){if(o&1&&(F(0),S(1,Je,7,2,"div",43)(2,Qe,5,2,"ng-template",null,8,X),A()),o&2){let e=V(3),n=f(5);m(),h("ngIf",!n.lite)("ngIfElse",e)}}function et(o,t){if(o&1&&(p(0,"div",50),_(1),d()),o&2){let e=f(8);m(),$(e.numberHint())}}function tt(o,t){if(o&1&&(p(0,"div",51),_(1),d()),o&2){let e=f(8);m(),$(e.numberError())}}function nt(o,t){if(o&1){let e=U();F(0),p(1,"input",47),D("input",function(i){P(e);let r=f(7);return k(r.onNumber(i.target.value))}),d(),S(2,et,2,1,"div",48)(3,tt,2,1,"div",49),A()}if(o&2){let e=f(7);m(),Q("invalid",e.numberError()),h("value",e.numberValue())("placeholder",e.numberHint()||"n\xFAmero..."),se("min",e.minAttr())("max",e.maxAttr())("step",e.stepAttr()),m(),h("ngIf",e.numberHint()),m(),h("ngIf",e.numberError())}}function it(o,t){if(o&1&&(p(0,"div",31)(1,"span",32),_(2),d(),p(3,"span",33),_(4),d()()),o&2){let e=f(7);m(2),q("",e.label(),":"),m(2),$(e.displayValue()||"\u2014")}}function rt(o,t){if(o&1&&(p(0,"div",46),S(1,nt,4,9,"ng-container",13)(2,it,5,2,"ng-template",null,9,X),d()),o&2){let e=V(3),n=f(6);m(),h("ngIf",!n.lite)("ngIfElse",e)}}function ot(o,t){if(o&1&&S(0,rt,4,2,"div",45),o&2){f();let e=V(4),n=f(4);h("ngIf",n.isNumericInput())("ngIfElse",e)}}function st(o,t){if(o&1&&(p(0,"div",50),_(1),d()),o&2){let e=f(8);m(),$(e.dateHint())}}function lt(o,t){if(o&1&&(p(0,"div",51),_(1),d()),o&2){let e=f(8);m(),$(e.dateError())}}function at(o,t){if(o&1){let e=U();F(0),p(1,"input",54),D("input",function(i){P(e);let r=f(7);return k(r.onDate(i.target.value))}),d(),S(2,st,2,1,"div",48)(3,lt,2,1,"div",49),A()}if(o&2){let e=f(7);m(),Q("invalid",e.dateError()),h("value",e.dateValue()),se("min",e.dateMinAttr())("max",e.dateMaxAttr()),m(),h("ngIf",e.dateHint()),m(),h("ngIf",e.dateError())}}function ct(o,t){if(o&1&&(p(0,"div",31)(1,"span",32),_(2),d(),p(3,"span",33),_(4),d()()),o&2){let e=f(7);m(2),q("",e.label(),":"),m(2),$(e.displayValue()||"\u2014")}}function mt(o,t){if(o&1&&(p(0,"div",53),S(1,at,4,7,"ng-container",13)(2,ct,5,2,"ng-template",null,10,X),d()),o&2){let e=V(3),n=f(6);m(),h("ngIf",!n.lite)("ngIfElse",e)}}function ut(o,t){if(o&1&&S(0,mt,4,2,"div",52),o&2){f();let e=V(6),n=f(4);h("ngIf",n.isDateHere())("ngIfElse",e)}}function dt(o,t){if(o&1&&(p(0,"div",50),_(1),d()),o&2){let e=f(8);m(),$(e.hint())}}function pt(o,t){if(o&1&&(p(0,"div",51),_(1),d()),o&2){let e=f(8);m(),$(e.textError())}}function gt(o,t){if(o&1){let e=U();F(0),p(1,"input",57),D("input",function(i){P(e);let r=f(7);return k(r.onText(i.target.value))}),d(),S(2,dt,2,1,"div",48)(3,pt,2,1,"div",49),A()}if(o&2){let e=f(7);m(),Q("invalid",e.textError()),h("value",e.textValue())("placeholder",e.hint()||"digite..."),se("minlength",e.exactLen()??e.minLen()??null)("maxlength",e.exactLen()??e.maxLen()??null)("pattern",e.htmlPattern()),m(),h("ngIf",e.hint()),m(),h("ngIf",e.textError())}}function ft(o,t){if(o&1&&(p(0,"div",31)(1,"span",32),_(2),d(),p(3,"span",33),_(4),d()()),o&2){let e=f(7);m(2),q("",e.label(),":"),m(2),$(e.displayValue()||"\u2014")}}function ht(o,t){if(o&1&&(p(0,"div",56),S(1,gt,4,9,"ng-container",13)(2,ft,5,2,"ng-template",null,12,X),d()),o&2){let e=V(3),n=f(6);m(),h("ngIf",!n.lite)("ngIfElse",e)}}function _t(o,t){if(o&1&&G(0,"app-xs-tree-node",30),o&2){let e=t.$implicit,n=f(8);h("node",e)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)("lite",n.lite)}}function xt(o,t){if(o&1&&(p(0,"div",24),S(1,_t,1,4,"app-xs-tree-node",58),d()),o&2){let e=f(7);m(),h("ngForOf",e.node.children)}}function vt(o,t){if(o&1&&S(0,xt,2,1,"div",19),o&2){let e=f(6);h("ngIf",e.node.children==null?null:e.node.children.length)}}function bt(o,t){if(o&1&&S(0,ht,4,2,"div",55)(1,vt,1,1,"ng-template",null,11,X),o&2){let e=V(2),n=f(5);h("ngIf",n.isStringInput())("ngIfElse",e)}}function Ct(o,t){if(o&1&&S(0,Ze,4,2,"ng-container",13)(1,ot,1,2,"ng-template",null,5,X)(3,ut,1,2,"ng-template",null,6,X)(5,bt,3,2,"ng-template",null,7,X),o&2){let e=V(2),n=f(4);h("ngIf",n.isEnumList())("ngIfElse",e)}}function Et(o,t){if(o&1&&(p(0,"details",14)(1,"summary",15)(2,"span",16),_(3),d()(),S(4,We,3,1,"div",34)(5,Ge,3,2,"ng-container",13)(6,Ct,7,2,"ng-template",null,4,X),d()),o&2){let e=V(7),n=f(3);m(3),$(n.node.name||n.node.kind),m(),h("ngIf",!n.lite&&(n.node.meta==null||n.node.meta.docs==null?null:n.node.meta.docs.length)),m(),h("ngIf",n.isChoice())("ngIfElse",e)}}function yt(o,t){if(o&1&&S(0,qe,6,2,"ng-container",13)(1,Et,8,4,"ng-template",null,3,X),o&2){let e=V(2),n=f(2);h("ngIf",n.lite&&n.isLeafNode())("ngIfElse",e)}}function Nt(o,t){if(o&1&&S(0,ze,2,1,"ng-container",13)(1,yt,3,2,"ng-template",null,2,X),o&2){let e=V(2),n=f();h("ngIf",n.isWrapper())("ngIfElse",e)}}var de=class o{constructor(t,e){this.liveXml=t;this.destroyRef=e}node;vPrefix="";instanceIndex;idPrefix="";disableRepeat=!1;lite=!1;formChange=new be;form=z(Z);liveBoundPath;ngOnInit(){this.bindToLiveXmlIfReady()}ngOnChanges(t){("vPrefix"in t||"instanceIndex"in t)&&this.bindToLiveXmlIfReady()}emitFormUpdate(t,e,n){console.groupCollapsed("[field:update]"),console.log("path  :",t),console.log("value :",e),console.log("valid :",n),console.groupEnd();let i=this.getFormSnapshot();return this.formChange.emit(i),i}getFormSnapshot(){let t=this.form;return typeof t.dump=="function"?t.dump():typeof t.snapshot=="function"?t.snapshot():typeof t.toJSON=="function"?t.toJSON():"value"in t?t.value:typeof t.getAll=="function"?t.getAll():{warning:"Snapshot n\xE3o dispon\xEDvel; implemente dump()/snapshot()/toJSON()/value no DynamicFormStateService."}}trackByIndex(t){return t}lc=t=>(t||"").toLowerCase();elName(){return this.node?.name||""}label(){return this.node.name||this.node.kind||""}getVisualPath(){if(!((this.node?.kind||"").toLowerCase()==="element"))return this.vPrefix||"";let e=this.instanceIndex!=null?`[${this.instanceIndex+1}]`:"";return(this.vPrefix?this.vPrefix+"/":"")+this.elName()+e}fieldKey(){return this.getVisualPath()}basePathNoIndex(){return(this.node?.kind||"").toLowerCase()==="element"?(this.vPrefix?this.vPrefix+"/":"")+(this.node.name||""):this.vPrefix||""}choiceKey(){return`${this.vPrefix||""}::choice@${this.node.id}`}readFormOnce(){let t=this.fieldKey();return this.isEnumList()?this.form.getEnum(t)??"":this.form.getText(t)??""}applyToFormFromXml(t){let e=this.fieldKey();this.isEnumList()?this.form.setEnum(e,t??""):this.form.setText(e,t??"")}bindToLiveXmlIfReady(){let t=this.getVisualPath();if(!t||this.liveBoundPath===t)return;this.liveBoundPath=t;let e=(this.node?.kind||"").toLowerCase()==="element",n=this.node.meta?.occurs?.min??0;if(e&&n>0&&this.liveXml.ensurePath(t),this.node?.children?.length){let r=this.node.children.filter(s=>(s.kind||"").toLowerCase()==="element").map(s=>s.name).filter(Boolean);r.length&&this.liveXml.registerOrder(t,r)}this.liveXml.observe(t).pipe(Oe(this.destroyRef)).subscribe(r=>{r!==this.readFormOnce()&&this.applyToFormFromXml(r)});let i=this.readFormOnce();(i??"").trim()!==""&&this.liveXml.setValue(t,i)}childrenOfKind(t,e){return(t.children||[]).filter(n=>this.lc(n.kind)===this.lc(e))}firstChildOfKind(t,e){return(t.children||[]).find(n=>this.lc(n.kind)===this.lc(e))}isWrapper(t=this.node){let e=this.lc(t.kind),n=t.name||"";return!!(["schema","complextype","sequence","simpletype","restriction","all","group","pattern","length","minlength","maxlength","mininclusive","maxinclusive","minexclusive","maxexclusive","totaldigits","fractiondigits"].includes(e)||/^(TS_|T_)/i.test(n))}chain(t=this.node,e=8){let n=[],i=t,r=0;for(;i&&r++<e;){n.push(i);let s=this.firstChildOfKind(i,"simpletype");if(s){i=s;continue}let l=this.firstChildOfKind(i,"restriction");if(l){i=l;continue}break}return n}effectiveBase(){let t="";for(let e of this.chain()){let n=e.meta||{};n.base?t=String(n.base):n.typeName&&(t=String(n.typeName))}return this.lc(t)}isRequiredNode(t=this.node){let e=(t.meta?.use||"").toString().toLowerCase(),n=t.meta?.occurs?.min;return e==="required"||typeof n=="number"&&n>0}isRequiredElement(){return(this.node.meta?.occurs?.min??0)>=1}occCount(t){return this.form.getGroupCount(this.basePathNoIndex())}occIndexes(t){let e=this.occCount(t);return Array.from({length:e},(n,i)=>i)}canAdd(t){let{max:e}=t.meta?.occurs??{max:1},n=this.occCount(t);return e==="unbounded"||n<(e??1)}canRemove(t){let{min:e}=t.meta?.occurs??{min:0};return this.occCount(t)>(e??0)}incOcc(t){let e=this.basePathNoIndex(),n=this.form.getGroupCount(e);this.form.setGroupCount(e,n+1),this.liveXml.setGroupCount(e,n+1),this.emitFormUpdate(this.getVisualPath(),"",!0)}decOcc(t){let e=this.basePathNoIndex(),n=this.form.getGroupCount(e);n<=0||(this.form.clearByPrefix(`${e}[${n}]`),this.form.setGroupCount(e,n-1),this.liveXml.setGroupCount(e,n-1),this.emitFormUpdate(this.getVisualPath(),"",!0))}setOccTo(t){t=Math.max(0,t|0),this.form.setGroupCount(this.basePathNoIndex(),t)}isRepeatable(){if(this.disableRepeat)return!1;let t=this.node.meta?.occurs;return t?t.max==="unbounded"?!0:typeof t.max=="number"&&t.max>1:!1}isChoice(){return this.lc(this.node.kind)==="choice"}parentBasePath(){return this.vPrefix||""}optionElementNames(){return(this.node.children||[]).map(t=>t.name).filter(t=>!!t)}chosenElementName(t){return(this.node.children||[]).find(e=>e.id===t)?.name??""}selectedChoiceId=B(()=>this.form.getChoice(this.choiceKey())??"");onChoose(t){let e=this.vPrefix||"",n=(this.node.children||[]).map(r=>r.name).filter(Boolean),i=(this.node.children||[]).find(r=>r.id===t)?.name??"";this.form.setChoice(`${this.vPrefix}::choice@${this.node.id}`,t,{basePath:e,optionElementNames:n,chosenElementName:i}),this.liveXml.setChoice(e,n,i||null),this.emitFormUpdate(this.getVisualPath()+" [choice]",t,!!t),console.groupCollapsed("[field:update]"),console.log("path  :",this.getVisualPath()+" [choice]"),console.log("value :",t),console.log("valid :",!!t),console.groupEnd()}selectedChild=B(()=>{let t=this.selectedChoiceId();if(!t){if(this.isChoice()&&this.node.children?.length===1){let e=this.node.children[0];return this.form.setChoice(this.choiceKey(),e.id,{basePath:this.vPrefix||"",optionElementNames:this.node.children?.filter(n=>!!n.name).map(n=>n.name)??[],chosenElementName:e.name??""}),e}return null}return(this.node.children||[]).find(e=>e.id===t)||null});collectEnumOptionsDeep(t,e=0){if(e>3)return[];let n=[];for(let a of this.childrenOfKind(t,"enumeration"))n.push(...a.children?.length?a.children:[a]);let i=this.firstChildOfKind(t,"restriction");if(i)for(let a of this.childrenOfKind(i,"enumeration"))n.push(...a.children?.length?a.children:[a]);let r=this.firstChildOfKind(t,"simpletype");r&&n.push(...this.collectEnumOptionsDeep(r,e+1));for(let a of t.children||[])if(this.lc(a.kind)!=="enumeration"&&a.children?.length)for(let g of this.childrenOfKind(a,"enumeration"))n.push(...g.children?.length?g.children:[g]);let s=t.meta?.numericFacets?.enums;if(s?.length)for(let a of s)n.push({id:`${t.id}#enum:${a}`,name:String(a),kind:"enumeration",children:[],source:t.source,meta:{docs:[]}});let l={};return n.filter(a=>{let g=a.name??"";return l[g]?!1:(l[g]=!0,!0)})}enumOptions=B(()=>this.collectEnumOptionsDeep(this.node));isEnumList(){return this.enumOptions().length>0}selectedEnum=B(()=>this.form.getEnum(this.fieldKey())??"");onChooseEnum(t){let e=(t??"").trim();this.form.setEnum(this.fieldKey(),e);let n=this.isRequiredNode(),i=this.enumOptions().map(l=>l.name),r=(e!==""||!n)&&(e===""||i.includes(e)),s=this.getVisualPath();this.liveXml.setValue(s,e),console.groupCollapsed("[field:update]"),console.log("path  :",s),console.log("value :",e),console.log("valid :",r),console.groupEnd()}enumLabel(t){let e=t.name||"",n=t.meta?.docs&&t.meta.docs[0]?String(t.meta.docs[0]).trim():"";return n?`${e} - ${n}`:e}isStringInput(){if(this.isEnumList()||this.isNumericInput())return!1;let t=this.effectiveBase(),e=this.lc(this.node.kind);return(e==="element"||e==="simpletype")&&t.includes("string")}textValue=B(()=>this.form.getText(this.fieldKey()));onText(t){let e=(t??"").trim();this.form.setText(this.fieldKey(),e);let n=this.textError()==="",i=this.getVisualPath();this.liveXml.setValue(i,e),console.groupCollapsed("[field:update]"),console.log("path  :",i),console.log("value :",e),console.log("valid :",n),console.groupEnd()}effectiveStringFacets(){let t,e,n,i=[],r=s=>{if(!s)return;let l=s.replace(/^\^/,"").replace(/\$$/,"").trim();l&&!i.includes(l)&&i.push(l)};for(let s of this.chain()){let l=s.meta?.stringFacets;l&&(l.length!=null&&(t=l.length),l.minLength!=null&&(e=l.minLength),l.maxLength!=null&&(n=l.maxLength),(l.patterns||[]).forEach(r)),this.childrenOfKind(s,"pattern").forEach(a=>r(a.name))}return{length:t,minLength:e,maxLength:n,patterns:i}}exactLen(){return this.effectiveStringFacets().length}minLen(){return this.effectiveStringFacets().minLength}maxLen(){return this.effectiveStringFacets().maxLength}collectAllPatternsDeep(t=this.node){let e=[],n=i=>{let r=this.normalizePattern(i);r&&!e.includes(r)&&e.push(r)};for(let i of this.chain(t))i.meta?.stringFacets?.patterns?.forEach(n),this.childrenOfKind(i,"pattern").forEach(r=>n(r.name));return e}patterns(){return this.collectAllPatternsDeep()}htmlPattern(){let t=this.patterns();return t.length?t.length===1?t[0]:`(?:${t.join(")|(?:")})`:null}normalizePattern(t){if(!t)return null;let e=String(t).trim();return e=e.replace(/^pattern\s*:\s*/i,"").replace(/^regex\s*:\s*/i,"").trim(),(e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"))&&(e=e.slice(1,-1).trim()),e.startsWith("^")&&(e=e.slice(1)),e.endsWith("$")&&(e=e.slice(0,-1)),e=e.replace(/\\\\/g,"\\"),!e||e===".*"||e===".+"?null:e}compileAnchoredRegex(t){let e=this.normalizePattern(t);if(!e)return null;try{return new RegExp(`^(?:${e})$`)}catch{return null}}textError=B(()=>{let t=(this.textValue()??"").trim();if(t==="")return"Obrigat\xF3rio";for(let s of this.patterns()){let l=this.compileAnchoredRegex(s);if(l&&!l.test(t))return`Valor n\xE3o atende ao padr\xE3o: ${s}`}let e=t.length,n=this.exactLen();if(n!=null&&e!==n)return`Deve ter exatamente ${n} caracteres.`;let i=this.minLen();if(i!=null&&e<i)return`M\xEDnimo de ${i} caracteres.`;let r=this.maxLen();return r!=null&&e>r?`M\xE1ximo de ${r} caracteres.`:""});hint(){let t=[],e=this.patterns();e.length&&t.push(`pattern: ${e[0]}`);let n=this.exactLen(),i=this.minLen(),r=this.maxLen();return n!=null?t.push(`tamanho: ${n}`):(i!=null&&t.push(`m\xEDn: ${i}`),r!=null&&t.push(`m\xE1x: ${r}`)),t.join(" \xB7 ")}numericBases=["byte","short","int","integer","long","decimal","float","double","nonnegativeinteger","positiveinteger","nonpositiveinteger","negativeinteger","unsignedbyte","unsignedshort","unsignedint","unsignedlong"];isNumericInput(){if(this.isEnumList())return!1;let t=this.effectiveBase(),e=this.lc(this.node.kind);return(e==="element"||e==="simpletype")&&this.numericBases.some(n=>t.endsWith(n))}numberValue=B(()=>this.form.getText(this.fieldKey()));onNumber(t){let e=(t??"").trim();this.form.setText(this.fieldKey(),e);let n=this.numberError()==="",i=this.getVisualPath();this.liveXml.setValue(i,e),console.groupCollapsed("[field:update]"),console.log("path  :",i),console.log("value :",e),console.log("valid :",n),console.groupEnd()}numericPatterns(){return this.collectAllPatternsDeep()}numericHtmlPattern(){let t=this.numericPatterns();return t.length?t.length===1?t[0]:`(?:${t.join(")|(?:")})`:null}minAttr(){let t=this.effectiveNumericFacets();return t.minInclusive!=null?t.minInclusive:t.minExclusive!=null?t.minExclusive+1:null}maxAttr(){let t=this.effectiveNumericFacets();return t.maxInclusive!=null?t.maxInclusive:t.maxExclusive!=null?t.maxExclusive-1:null}stepAttr(){let t=this.effectiveNumericFacets();return t.fractionDigits!=null&&t.fractionDigits>0?"0."+"0".repeat(t.fractionDigits-1)+"1":"1"}effectiveNumericFacets(){let t={minInclusive:void 0,maxInclusive:void 0,minExclusive:void 0,maxExclusive:void 0,totalDigits:void 0,fractionDigits:void 0};for(let e of this.chain()){let n=e.meta?.numericFacets;n&&(n.minInclusive!=null&&(t.minInclusive=n.minInclusive),n.maxInclusive!=null&&(t.maxInclusive=n.maxInclusive),n.minExclusive!=null&&(t.minExclusive=n.minExclusive),n.maxExclusive!=null&&(t.maxExclusive=n.maxExclusive),n.totalDigits!=null&&(t.totalDigits=n.totalDigits),n.fractionDigits!=null&&(t.fractionDigits=n.fractionDigits))}return t}numberError=B(()=>{let t=(this.numberValue()??"").trim();if(t==="")return"Obrigat\xF3rio";for(let l of this.numericPatterns()){let a=this.compileAnchoredRegex(l);if(a&&!a.test(t))return`Valor n\xE3o atende ao padr\xE3o: ${l}`}if(!/^-?\d+(\.\d+)?$/.test(t))return"N\xFAmero inv\xE1lido";let n=this.effectiveNumericFacets(),i=Number(t),r=this.effectiveBase();return!r.includes("decimal")&&!r.includes("float")&&!r.includes("double")&&!/^[-]?\d+$/.test(t)?"Deve ser inteiro":n.fractionDigits!=null&&(t.split(".")[1]||"").length>n.fractionDigits?`M\xE1ximo de ${n.fractionDigits} casas decimais`:n.totalDigits!=null&&t.replace(/^-/,"").replace(".","").length>n.totalDigits?`M\xE1ximo de ${n.totalDigits} d\xEDgitos`:n.minInclusive!=null&&!(i>=n.minInclusive)?`M\xEDnimo: ${n.minInclusive}`:n.minExclusive!=null&&!(i>n.minExclusive)?`Deve ser > ${n.minExclusive}`:n.maxInclusive!=null&&!(i<=n.maxInclusive)?`M\xE1ximo: ${n.maxInclusive}`:n.maxExclusive!=null&&!(i<n.maxExclusive)?`Deve ser < ${n.maxExclusive}`:""});numberHint(){let t=[],e=this.numericPatterns();e.length&&t.push(`pattern: ${e[0]}`);let n=this.effectiveNumericFacets();return n.minInclusive!=null&&t.push(`m\xEDn: ${n.minInclusive}`),n.maxInclusive!=null&&t.push(`m\xE1x: ${n.maxInclusive}`),n.minExclusive!=null&&t.push(`> ${n.minExclusive}`),n.maxExclusive!=null&&t.push(`< ${n.maxExclusive}`),n.totalDigits!=null&&t.push(`d\xEDgitos: ${n.totalDigits}`),n.fractionDigits!=null&&t.push(`decimais: ${n.fractionDigits}`),t.join(" \xB7 ")}qnToToken(t){return t?String(t).toLowerCase().trim().replace(/^\{[^}]+\}/,"").replace(/^[a-z_][\w.-]*:/,"").trim():""}isDateHere(){let t=(this.node.kind||"").toLowerCase();return t==="element"||t==="simpletype"?(this.qnToToken(this.node.meta?.base)||this.qnToToken(this.node.meta?.typeName))==="date":!1}dateValue(){return this.textValue()}onDate(t){let e=(t??"").trim();this.form.setText(this.fieldKey(),e);let n=this.dateError()==="",i=this.getVisualPath();this.liveXml.setValue(i,e),console.groupCollapsed("[field:update]"),console.log("path  :",i),console.log("value :",e),console.log("valid :",n),console.groupEnd()}dateFacetsHere(){return this.node.meta?.dateFacets??{}}addDays(t,e){let n=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t||"");if(!n)return null;let i=new Date(Date.UTC(+n[1],+n[2]-1,+n[3]+e)),r=String(i.getUTCMonth()+1).padStart(2,"0"),s=String(i.getUTCDate()).padStart(2,"0");return`${i.getUTCFullYear()}-${r}-${s}`}dateMinAttr(){let t=this.dateFacetsHere();return t.minInclusive??(t.minExclusive?this.addDays(t.minExclusive,1):null)}dateMaxAttr(){let t=this.dateFacetsHere();return t.maxInclusive??(t.maxExclusive?this.addDays(t.maxExclusive,-1):null)}dateHint(){let t=this.dateFacetsHere(),e=[];return t.minInclusive&&e.push(`m\xEDn: ${t.minInclusive}`),t.minExclusive&&e.push(`> ${t.minExclusive}`),t.maxInclusive&&e.push(`m\xE1x: ${t.maxInclusive}`),t.maxExclusive&&e.push(`< ${t.maxExclusive}`),e.join(" \xB7 ")}dateError(){let t=(this.dateValue()||"").trim();if(!t)return"Obrigat\xF3rio";if(!/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/.test(t))return"Formato inv\xE1lido (AAAA-MM-DD)";let e=new Date(t),[n,i,r]=t.split("-").map(Number);if(isNaN(+e)||e.getUTCFullYear()!==n||e.getUTCMonth()+1!==i||e.getUTCDate()!==r)return"Data inexistente";let s=this.dateFacetsHere();return s.minInclusive&&!(t>=s.minInclusive)?`M\xEDnimo: ${s.minInclusive}`:s.minExclusive&&!(t>s.minExclusive)?`Deve ser > ${s.minExclusive}`:s.maxInclusive&&!(t<=s.maxInclusive)?`M\xE1ximo: ${s.maxInclusive}`:s.maxExclusive&&!(t<s.maxExclusive)?`Deve ser < ${s.maxExclusive}`:""}isLeafNode(){return this.isEnumList()||this.isNumericInput()||this.isDateHere()||this.isStringInput()}displayValue(){return this.isEnumList()?this.selectedEnum()||"":this.isNumericInput()?this.numberValue()||"":this.isDateHere()?this.dateValue()||"":this.isStringInput()&&this.textValue()||""}static \u0275fac=function(e){return new(e||o)(fe(ee),fe(re))};static \u0275cmp=oe({type:o,selectors:[["app-xs-tree-node"]],inputs:{node:"node",vPrefix:"vPrefix",instanceIndex:"instanceIndex",idPrefix:"idPrefix",disableRepeat:"disableRepeat",lite:"lite"},outputs:{formChange:"formChange"},features:[ve],decls:5,vars:2,consts:[["notRepeatable",""],["renderSelf",""],["normalBox",""],["fullBox",""],["notChoice",""],["maybeNumber",""],["maybeDate",""],["maybeString",""],["enumLite",""],["numberLite",""],["dateLite",""],["regularChildren",""],["stringLite",""],[4,"ngIf","ngIfElse"],["open","",1,"node"],[1,"sum"],[1,"name"],["class","occ-ctrl",4,"ngIf"],["class","occ-badge",4,"ngIf"],["class","children",4,"ngIf"],[1,"occ-ctrl"],["type","button",1,"btn",3,"click","disabled"],[1,"occ"],[1,"occ-badge"],[1,"children"],[4,"ngFor","ngForOf"],[1,"instance"],[1,"inst-header"],[3,"node","vPrefix","disableRepeat","instanceIndex","lite"],[3,"ngTemplateOutlet"],[3,"node","idPrefix","vPrefix","lite"],[1,"lite-row"],[1,"lite-label"],[1,"lite-value"],["class","docbox",4,"ngIf"],[1,"docbox"],[1,"docbox-list"],["class","choice-picker",4,"ngIf"],[1,"choice-picker"],[3,"change","value"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","enum-picker",4,"ngIf","ngIfElse"],[1,"enum-picker"],["class","number-input",4,"ngIf","ngIfElse"],[1,"number-input"],["type","number","inputmode","decimal",1,"text",3,"input","value","placeholder"],["class","hint",4,"ngIf"],["class","error",4,"ngIf"],[1,"hint"],[1,"error"],["class","date-input",4,"ngIf","ngIfElse"],[1,"date-input"],["type","date","placeholder","AAAA-MM-DD",1,"text",3,"input","value"],["class","string-input",4,"ngIf","ngIfElse"],[1,"string-input"],["type","text",1,"text",3,"input","value","placeholder"],[3,"node","idPrefix","vPrefix","lite",4,"ngFor","ngForOf"]],template:function(e,n){if(e&1&&S(0,Re,8,4,"ng-container",13)(1,Le,1,1,"ng-template",null,0,X)(3,Nt,3,2,"ng-template",null,1,X),e&2){let i=V(2);h("ngIf",n.isRepeatable())("ngIfElse",i)}},dependencies:[o,ce,le,ae,Ie],styles:[".node[_ngcontent-%COMP%]{border:1px solid #d7d7db;border-radius:12px;padding:8px 12px;background:#fff}[_nghost-%COMP%]{display:block;margin-top:12px}.sum[_ngcontent-%COMP%]{cursor:pointer;font-weight:600}.children[_ngcontent-%COMP%]{display:grid;grid-auto-rows:auto;gap:12px;margin-top:8px}details.node[_ngcontent-%COMP%] + details.node[_ngcontent-%COMP%]{margin-top:12px}.docbox[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;border:1px solid #e5e7eb;background:#fafafa;border-radius:10px}.docbox-list[_ngcontent-%COMP%]{margin:0;padding-left:18px;white-space:pre-wrap;font-size:13px}.choice-picker[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:10px}.choice-picker[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;border-radius:8px;border:1px solid #c8c8cc;background:#fff}.string-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-top:10px}.text[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #c8c8cc;border-radius:8px}.text.invalid[_ngcontent-%COMP%]{border-color:#e11d48;background:#fff1f2}.hint[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.error[_ngcontent-%COMP%]{font-size:12px;color:#e11d48}.number-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-top:10px}.occ-ctrl[_ngcontent-%COMP%]{display:inline-flex;gap:8px;margin-left:10px;align-items:center}.occ-ctrl[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:0 8px;border:1px solid #e5e7eb;border-radius:6px;background:#f8fafc;cursor:pointer}.occ-ctrl[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.occ-ctrl[_ngcontent-%COMP%]   .occ[_ngcontent-%COMP%]{min-width:22px;text-align:center;font-weight:600}.instance[_ngcontent-%COMP%]{border:1px dashed #e5e7eb;border-radius:10px;padding:10px}.inst-header[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin:6px 0 10px}[_nghost-%COMP%], .page[_ngcontent-%COMP%], .content[_ngcontent-%COMP%], .node[_ngcontent-%COMP%], .children[_ngcontent-%COMP%]{max-width:100%;overflow-x:hidden}.docbox[_ngcontent-%COMP%], .docbox-list[_ngcontent-%COMP%], .docbox-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], details.node[_ngcontent-%COMP%], summary.sum[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%], .string-input[_ngcontent-%COMP%], .number-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{white-space:normal;overflow-wrap:anywhere;word-break:break-word}*[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}details.node[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.lite-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:.5rem;padding:.25rem .5rem;border-left:3px solid #e5e7eb;margin:.25rem 0;font-size:.95rem}.lite-label[_ngcontent-%COMP%]{font-weight:600;color:#374151}.lite-value[_ngcontent-%COMP%]{color:#111827;word-break:break-word}"]})};var It=["xmlDlg"];function St(o,t){if(o&1&&(p(0,"div",18),G(1,"app-xs-tree-node",19),d()),o&2){let e=t.ngIf,n=f();m(),h("node",e)("vPrefix","eSocial")("lite",n.lite())}}function Tt(o,t){o&1&&(p(0,"div",20),_(1," N\xE3o foi poss\xEDvel construir a \xE1rvore do evento. Verifique se o "),p(2,"b"),_(3,"tipos.xsd"),d(),_(4," est\xE1 presente. "),d())}function wt(o,t){o&1&&(F(0),_(1,"XML malformado"),A())}function Mt(o,t){if(o&1&&(F(0),_(1),A()),o&2){let e=f();m(),q("Incompleto: ",e.missingRequired.length," obrigat\xF3rio(s)")}}function Ot(o,t){o&1&&(F(0),_(1,"V\xE1lido"),A())}function Pt(o,t){if(o&1&&(p(0,"li"),_(1),d()),o&2){let e=t.$implicit;m(),$(e)}}function kt(o,t){if(o&1&&(p(0,"div",21)(1,"div",22),_(2,"Campos obrigat\xF3rios ausentes:"),d(),p(3,"ul"),S(4,Pt,2,1,"li",23),d()()),o&2){let e=f();m(4),h("ngForOf",e.missingRequired)}}var Pe=class o{route=z(Se);adapter=z(me);liveXml=z(ee);form=z(Z);eventName="";xmlDlg;xmlText="";xmlOk=!0;requiredOk=!0;xmlErr="";missingRequired=[];headerTitle=W("\u2014");root=W(null);lite=W(!1);toggleLite(){this.lite.update(t=>!t)}eventVPrefix=B(()=>`eSocial/${this.eventName}`);constructor(){let t=decodeURIComponent(this.route.snapshot.paramMap.get("fileName")||""),{code:e,title:n,root:i}=this.adapter.buildViewTreeFromLatest(t),r=new RegExp(`^\\s*${e}\\b`,"i").test(n);this.headerTitle.set(r?n:`${e} - ${n}`),this.root.set(i),this.eventName=t.replace(".xsd",""),console.groupCollapsed("[VIEW TREE]",t),console.log({meta:{code:e,title:n,fileName:t},root:i}),console.groupEnd(),window.__viewTree=i}ngOnInit(){this.bootstrapLiveXml(),this.refreshXmlFromForm()}bootstrapLiveXml(){this.liveXml.init("eSocial");let t=`eSocial/${this.eventName}`;this.liveXml.ensurePath(t),this.liveXml.getValue(`${t}/@Id`)||this.liveXml.setValue(`${t}/@Id`,this.generateEventId())}generateEventId(t){let e=(s,l)=>s.toString().padStart(l,"0"),n=new Date,i=`${n.getFullYear()}${e(n.getMonth()+1,2)}${e(n.getDate(),2)}${e(n.getHours(),2)}${e(n.getMinutes(),2)}${e(n.getSeconds(),2)}`,r=Math.floor(Math.random()*1e7).toString().padStart(7,"0");return`ID${t??"00000000000000"}${i}${r}`}expandAll(){document.querySelectorAll("details.node, details.docs").forEach(t=>t.setAttribute("open",""))}collapseAll(){document.querySelectorAll("details.node, details.docs").forEach(t=>t.removeAttribute("open"))}openXmlModal(){this.xmlText=this.liveXml.serialize(!0),this.revalidateXmlAndRequired(),this.xmlDlg.nativeElement.showModal()}closeXmlModal(){this.xmlDlg.nativeElement.close()}onXmlInput(t){this.xmlText=t.target.value??"",this.revalidateXmlAndRequired()}updateXmlValidity(){let t=this.liveXml.validateXml(this.xmlText);this.xmlOk=t.ok,this.xmlErr=t.error||""}revalidateXmlAndRequired(){let t=this.liveXml.validateXml(this.xmlText);if(this.xmlOk=t.ok,this.xmlErr=t.error||"",this.xmlOk){let e=new DOMParser().parseFromString(this.xmlText,"application/xml");this.missingRequired=this.collectMissingRequiredFromDoc(e),this.requiredOk=this.missingRequired.length===0}else this.missingRequired=[],this.requiredOk=!1}applyXmlToForm(){this.xmlOk&&this.liveXml.import(this.xmlText)}getDraftKey(){return`esocial.event.draft:${this.eventName}`}getLegacyDraftKey(){return"esocial.liveXml.draft"}saveDraftFromForm(){let t=this.liveXml.serialize(!0);localStorage.setItem(this.getDraftKey(),t),alert("Rascunho salvo (formul\xE1rio).")}saveXmlLocal(){this.xmlText=this.liveXml.serialize(!0),localStorage.setItem("esocial.liveXml.draft",this.xmlText)}loadDraftIntoModal(){let t=localStorage.getItem(this.getDraftKey());if(t==null&&(t=localStorage.getItem(this.getLegacyDraftKey())),t==null){alert("Nenhum rascunho encontrado para este evento.");return}this.xmlText=t,this.revalidateXmlAndRequired(),this.xmlDlg?.nativeElement.open||this.xmlDlg?.nativeElement.showModal()}clearEventDrafts(){let t="esocial.event.draft:",e=[];for(let i=0;i<localStorage.length;i++){let r=localStorage.key(i);r&&r.startsWith(t)&&e.push(r)}if(!e.length){alert("Nenhum rascunho de evento encontrado.");return}confirm(`Remover ${e.length} rascunho(s) de evento?`)&&(e.forEach(i=>localStorage.removeItem(i)),alert(`${e.length} rascunho(s) removido(s).`))}loadXmlLocal(){let t=localStorage.getItem("esocial.liveXml.draft");if(!t){console.warn("[rascunho] nada salvo em localStorage");return}this.importExternalXmlIntoForm(t),this.xmlText=this.liveXml.serialize(!0),console.log(this.xmlText)}clearAllLocalDrafts(){let t="esocial.",e=[];for(let i=0;i<localStorage.length;i++){let r=localStorage.key(i);r&&r.startsWith(t)&&e.push(r)}if(!e.length){alert("Nenhum rascunho encontrado.");return}confirm(`Remover ${e.length} rascunho(s) local(is)?`)&&(e.forEach(i=>localStorage.removeItem(i)),alert(`${e.length} item(ns) removido(s) do armazenamento local.`))}refreshXmlFromForm(){this.xmlText=this.liveXml.serialize(!0)}importExternalXmlIntoForm(t){let e=this.root();if(!e)return;let n=this.buildSnapshotFromXml(t,e,this.eventName,"eSocial");this.form.loadSnapshot(n),this.liveXml.init("eSocial"),this.liveXml.applySnapshot(this.eventName,n,"eSocial"),this.refreshXmlFromForm()}collectMissingRequiredFromDoc(t){let e=[],n=this.root?.();if(!n)return e;let i=(r,s)=>{let l=(r.kind||"").toLowerCase(),a=r.name||"";if(this.isIgnoredName(a))return;let g=l==="element"?s?`${s}/${a}`:a:s;if(l==="choice"&&(r.meta?.occurs?.min??1)>0&&((r.children??[]).some(w=>{if((w.kind||"").toLowerCase()!=="element")return!1;let O=`${g}/${w.name}`;return this.countInDoc(t,O)>0})||e.push(`${g} [escolha um]`)),l==="element"&&r.children?.length){(r.meta?.occurs?.min??1)>0&&this.countInDoc(t,g)<1&&e.push(g);for(let v of r.children)i(v,g)}if(l==="element"&&(!r.children||r.children.length===0)&&(r.meta?.occurs?.min??1)>0&&(this.textInDoc(t,g)||e.push(g)),(l==="sequence"||l==="complextype"||l==="schema"||l==="simpletype"||l==="group")&&r.children)for(let u of r.children)i(u,g)};return i(n,""),e.map(r=>r.startsWith("eSocial")?r:`eSocial/${r}`)}isIgnoredName(t){return t?/^ds:/i.test(t):!1}textInDoc(t,e){let n=e.split("/").filter(Boolean),i=t.documentElement;if(!i||i.tagName!==n[0])return null;for(let s=1;s<n.length;s++){let l=n[s].replace(/\[\d+]/,""),a=Array.from(i.children).filter(g=>g.tagName===l);if(a.length===0||(i=a[0]??null,!i))return null}let r=(i.textContent??"").trim();return r.length?r:null}countInDoc(t,e){let n=e.split("/").filter(Boolean),i=t.documentElement;if(!i||i.tagName!==n[0])return 0;for(let r=1;r<n.length;r++){let s=n[r].match(/^(.+?)(?:\[(\d+)])?$/),l=s?.[1]??n[r],a=s?.[2]?parseInt(s[2],10):void 0,g=Array.from(i.children).filter(u=>u.tagName===l);if(a!=null){if(a<1||a>g.length||(i=g[a-1]??null,!i))return 0}else{if(r===n.length-1)return g.length;if(i=g[0]??null,!i)return 0}}return i?1:0}buildSnapshotFromXml(t,e,n,i="eSocial"){let r={},s={},l={},a={},u=new DOMParser().parseFromString(t,"application/xml").documentElement;if(!u||u.tagName!==i)return{fields:{},groupCounts:{},choices:{},choiceMeta:{}};let v=Array.from(u.children).find(c=>c.tagName===n);if(!v)return{fields:{},groupCounts:{},choices:{},choiceMeta:{}};let w=c=>(c||"").toLowerCase(),O=c=>{if(!c)return null;if(w(c.kind)==="element"&&c.name)return c.name;for(let x of c.children||[]){let b=O(x);if(b)return b}return null},L=c=>{let x=c.split("/").filter(Boolean),b=v;for(let C=0;C<x.length;C++){let E=x[C].match(/^(.+?)(?:\[(\d+)])?$/),y=E?.[1]??x[C],I=E?.[2]?parseInt(E[2],10):void 0,M=Array.from(b.children).filter(N=>N.tagName===y);if(C===x.length-1&&I==null)return M.length;if(b=I==null?M[0]??null:M[I-1]??null,!b)return 0}return b?1:0},Y=c=>{let x=c.split("/").filter(Boolean),b=v;for(let E=0;E<x.length;E++){let y=x[E].match(/^(.+?)(?:\[(\d+)])?$/),I=y?.[1]??x[E],M=y?.[2]?parseInt(y[2],10):1;if(b=Array.from(b.children).filter(T=>T.tagName===I)[M-1]??null,!b)return null}return(b.textContent??"").trim()||null},pe=(c,x)=>{let b=c.split("/").filter(Boolean),C=v;for(let y=0;y<b.length;y++){let I=b[y].match(/^(.+?)(?:\[(\d+)])?$/),M=I?.[1]??b[y],N=I?.[2]?parseInt(I[2],10):1;if(C=Array.from(C.children).filter(R=>R.tagName===M)[N-1]??null,!C)return null}return(C.getAttribute(x)??"").trim()||null},ge=c=>w(c?.meta?.base||c?.meta?.typeName||"").includes("date")?"date":c?.meta?.numericFacets?"number":(c?.children||[]).some(b=>w(b.kind)==="enumeration")?"enum":"text",K=(c,x)=>{if(!c)return;let b=w(c.kind);if(b==="choice"){let C=(c.children||[]).map(N=>O(N)).filter(Boolean),E=null,y="";for(let N of c.children||[]){let T=O(N);if(!T)continue;let R=x?`${x}/${T}`:T;if(L(R)>0){E=T,y=N.id;break}}let I=`${x}::choice@${c.id}`;E&&y&&(l[I]=y,a[I]={basePath:x,optionElementNames:Array.from(new Set(C)),chosenElementName:E});let M=(c.children||[]).find(N=>N.id===y);M&&E&&K(M,x);return}if(b==="attribute"){let C=pe(x,c.name);C!=null&&(r[`${x}/@${c.name}`]={type:"text",value:C});return}if(b==="element"){let C=c.name,E=x?`${x}/${C}`:C,y=L(E),I=c.meta?.occurs?.max;if((I==="unbounded"||typeof I=="number"&&I>1)&&(s[E]=y),(c.children||[]).length)for(let N=1;N<=Math.max(y,0);N++)for(let T of c.children||[])K(T,`${E}[${N}]`);else{let N=ge(c);for(let T=1;T<=Math.max(y,0);T++){let R=`${E}[${T}]`,te=Y(R);te!=null&&(r[R]={type:N,value:te})}}return}if((c.children||[]).length)for(let C of c.children)K(C,x)};return K(e,""),{fields:r,groupCounts:s,choices:l,choiceMeta:a}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=oe({type:o,selectors:[["app-novo-evento-winzard"]],viewQuery:function(e,n){if(e&1&&Ee(It,5),e&2){let i;ye(i=Ne())&&(n.xmlDlg=i.first)}},decls:41,vars:13,consts:[["missing",""],["xmlDlg",""],[1,"actions"],["routerLink","/gestao",1,"button"],["type","button",3,"click"],["type","button",1,"btn",3,"click"],[1,"title"],["class","root",4,"ngIf","ngIfElse"],[1,"xml-dlg"],["method","dialog",1,"xml-dlg-body",3,"submit"],[1,"xml-dlg-header"],[1,"status"],[4,"ngIf"],[1,"xml-scroll"],["disabled","true","spellcheck","false",1,"xml-text",3,"input","value"],["class","xml-issues",4,"ngIf"],[1,"xml-dlg-footer"],[1,"spacer"],[1,"root"],[3,"node","vPrefix","lite"],[1,"placeholder"],[1,"xml-issues"],[1,"issues-title"],[4,"ngFor","ngForOf"]],template:function(e,n){if(e&1){let i=U();p(0,"div",2)(1,"button",3),_(2,"\u2190 Voltar"),d(),p(3,"button",4),D("click",function(){return P(i),k(n.expandAll())}),_(4,"Expandir tudo"),d(),p(5,"button",4),D("click",function(){return P(i),k(n.collapseAll())}),_(6,"Recolher tudo"),d(),p(7,"button",5),D("click",function(){return P(i),k(n.openXmlModal())}),_(8,"Pr\xE9via do XML"),d(),p(9,"button",4),D("click",function(){return P(i),k(n.toggleLite())}),_(10),d(),p(11,"button",5),D("click",function(){return P(i),k(n.saveDraftFromForm())}),_(12,"Salvar"),d()(),p(13,"h2",6),_(14),d(),S(15,St,2,3,"div",7)(16,Tt,5,0,"ng-template",null,0,X),p(18,"dialog",8,1)(20,"form",9),D("submit",function(s){return P(i),k(s.preventDefault())}),p(21,"header",10)(22,"strong"),_(23,"Editor de XML"),d(),p(24,"span",11),S(25,wt,2,0,"ng-container",12)(26,Mt,2,1,"ng-container",12)(27,Ot,2,0,"ng-container",12),d()(),p(28,"div",13)(29,"textarea",14),D("input",function(s){return P(i),k(n.onXmlInput(s))}),d(),S(30,kt,5,1,"div",15),d(),p(31,"footer",16)(32,"button",5),D("click",function(){return P(i),k(n.closeXmlModal())}),_(33,"Voltar"),d(),p(34,"button",5),D("click",function(){return P(i),k(n.loadDraftIntoModal())}),_(35,"Carregar rascunho"),d(),p(36,"button",5),D("click",function(){return P(i),k(n.clearAllLocalDrafts())}),_(37,"Limpar rascunhos"),d(),p(38,"button",5),D("click",function(){return P(i),k(n.applyXmlToForm())}),_(39,"Aplicar"),d(),G(40,"span",17),d()()()}if(e&2){let i=V(17);m(10),q(" ",n.lite()?"Modo completo":"Modo lite",`
`),m(4),$(n.headerTitle()),m(),h("ngIf",n.root())("ngIfElse",i),m(9),Q("ok",n.xmlOk&&n.requiredOk)("err",!(n.xmlOk&&n.requiredOk)),m(),h("ngIf",!n.xmlOk),m(),h("ngIf",n.xmlOk&&!n.requiredOk),m(),h("ngIf",n.xmlOk&&n.requiredOk),m(2),h("value",n.xmlText),m(),h("ngIf",n.xmlOk&&!n.requiredOk)}},dependencies:[ce,le,ae,Te,de],styles:[".back[_ngcontent-%COMP%]{margin-bottom:10px;padding:6px 10px;border-radius:8px;border:1px solid #c8c8cc;background:#f5f5f7}.title[_ngcontent-%COMP%]{margin:0 0 10px}[_nghost-%COMP%]{display:block}.actions[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1000;display:flex;gap:.5rem;align-items:center;padding:.5rem 1rem;background:#fff;border-bottom:1px solid #e5e7eb;box-shadow:0 1px 4px #0000000d}.title[_ngcontent-%COMP%]{margin:1rem 0}.actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:10px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;border:1px solid #c8c8cc;background:#f5f5f7;cursor:pointer}.root[_ngcontent-%COMP%]{display:grid;gap:10px}.placeholder[_ngcontent-%COMP%]{opacity:.85;border:1px dashed #c8c8cc;border-radius:12px;padding:14px;background:#fff}dialog.xml-dlg[_ngcontent-%COMP%]{width:min(1100px,96vw);max-height:90vh;padding:0;border:none;border-radius:12px;overflow:hidden;box-shadow:0 20px 50px #00000059}.xml-dlg-body[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto 1fr auto;height:min(80vh,calc(100vh - 4rem))}.xml-dlg-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fff}.xml-dlg-header[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:auto;font-size:.9rem}.xml-dlg-header[_ngcontent-%COMP%]   .status.ok[_ngcontent-%COMP%]{color:#059669}.xml-dlg-header[_ngcontent-%COMP%]   .status.err[_ngcontent-%COMP%]{color:#dc2626}.xml-scroll[_ngcontent-%COMP%]{overflow:auto;background:#0b1020}.xml-text[_ngcontent-%COMP%]{display:block;width:100%;height:60vh;border:0;outline:0;resize:none;box-sizing:border-box;padding:12px 16px;color:#e6edf3;background:#0b1020;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:13px;line-height:1.45}.xml-issues[_ngcontent-%COMP%]{padding:10px 16px;color:#eab308;background:#0f172a;border-top:1px solid #1f2937}.xml-issues[_ngcontent-%COMP%]   .issues-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.xml-dlg-footer[_ngcontent-%COMP%]{position:sticky;bottom:0;background:#fff;display:flex;align-items:center;gap:8px;padding:12px 16px;border-top:1px solid #e5e7eb}.btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{background:#f9fafb}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border-color:#2563eb}.btn-primary[_ngcontent-%COMP%]:hover{background:#1d4ed8}"]})};export{Pe as NovoEventoWinzardComponent};
