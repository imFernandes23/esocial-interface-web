import{c as ue}from"./chunk-27D4PCIU.js";import{a as pe}from"./chunk-X5A3O7XB.js";import"./chunk-VV2HN75Q.js";import{C as m,Da as B,E as R,Ea as H,F as W,Fa as ce,Ia as K,J as x,Ka as me,Na as de,O as U,P as p,Q as u,R as c,S,V as N,W as T,X as oe,Y as I,_ as C,a as F,aa as h,b as L,d as j,da as se,e as q,ea as ae,fa as le,ga as O,i as te,ia as V,ja as _,k as ne,ka as E,la as A,o as ie,q as D,t as M,u as v,v as b,w as z,wa as w,y as P,z as re,za as k}from"./chunk-H64DG2YF.js";var Q=class r{catalog=M(pe);treeSvc=M(ue);buildViewTreeFromLatest(e){let t=this.catalog.getLatestSchema();if(!t)throw new Error("Nenhum conjunto de schemas carregado.");let n=t.files?.[e];if(!n)throw new Error(`XSD do evento n\xE3o encontrado: ${e}`);let i=t.events?.find(f=>f.isTipos)?.fileName??Object.keys(t.files||{}).find(f=>/tipos\.xsd$/i.test(f))??Object.keys(t.files||{}).find(f=>/tipos/i.test(f));if(!i)throw new Error("Arquivo tipos.xsd n\xE3o encontrado no conjunto.");let o=t.files[i],s=this.treeSvc.buildEventoTree(n,o),a=this.toView(s,new Set),g=t.events?.find(f=>f.fileName===e)?.label||e;return{code:(g.match(/S-\d{3,4}/i)?.[0]||e.match(/S-\d{3,4}/i)?.[0]||"\u2014").toUpperCase(),title:g,root:a}}toView(e,t){let n=e.id||`${e.kind}:${e.name}:${t.size}`;if(t.has(n))return{id:n,name:e.name,kind:e.kind,meta:e.meta,source:e,children:[]};t.add(n);let i=(e.children||[]).map(o=>this.toView(o,t));return{id:n,name:e.name,kind:e.kind,meta:e.meta,source:e,children:i}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"})};var G=class r{choiceMap=P({});getChoice(e){return this.choiceMap()[e]}setChoice(e,t){this.choiceMap.update(n=>L(F({},n),{[e]:t}))}clearChoice(e){let i=this.choiceMap(),{[e]:t}=i,n=q(i,[j(e)]);this.choiceMap.set(n)}enumMap=P({});getEnum(e){return this.enumMap()[e]}setEnum(e,t){this.enumMap.update(n=>L(F({},n),{[e]:t}))}clearEnum(e){let i=this.enumMap(),{[e]:t}=i,n=q(i,[j(e)]);this.enumMap.set(n)}textMap=P({});getText(e){return this.textMap()[e]??""}setText(e,t){this.textMap.update(n=>L(F({},n),{[e]:t}))}clearText(e){let i=this.textMap(),{[e]:t}=i,n=q(i,[j(e)]);this.textMap.set(n)}loadFromXml(e){}toXml(){return""}static \u0275fac=function(t){return new(t||r)};static \u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"})};function ge(r){r||(r=M(z));let e=new te(t=>{if(r.destroyed){t.next();return}return r.onDestroy(t.next.bind(t))});return t=>t.pipe(ie(e))}var $=class r{doc=null;pathSubjects=new Map;parentOrders=new Map;registerOrder(e,t){this.parentOrders.set(this.normalizePath(e),t.slice())}normalizePath(e){return e.replace(/\[\d+]/g,"")}init(e="eSocial"){let t=`<?xml version="1.0" encoding="UTF-8"?><${e}/>`;this.doc=new DOMParser().parseFromString(t,"application/xml")}ensureDoc(){return this.doc||this.init("eSocial"),this.doc}NS={ds:"http://www.w3.org/2000/09/xmldsig#"};observe(e){return this.subjectFor(e).asObservable()}getValue(e){let t=this.ensureDoc(),{attr:n,elementPath:i}=this.splitAttr(e),o=this.ensureElement(t,i,!1);return o?n?o.getAttribute(n)??"":o.textContent??"":""}setValue(e,t){let n=this.ensureDoc(),{attr:i,elementPath:o}=this.splitAttr(e),s=this.ensureElement(n,o,!0);if(s){if(i)s.setAttribute(i,t??"");else{for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(n.createTextNode(t??""))}this.subjectFor(e).next(t??"")}}serialize(e=!0){let t=this.ensureDoc();return e?this.prettyFromDoc(t):new XMLSerializer().serializeToString(t)}prettyFromDoc(e){let t=['<?xml version="1.0" encoding="UTF-8"?>'],n=o=>"  ".repeat(o),i=(o,s)=>{let a=Array.from(o.attributes).map(l=>`${l.name}="${l.value}"`).join(" "),d=a?`<${o.tagName} ${a}>`:`<${o.tagName}>`,g=Array.from(o.childNodes).filter(l=>l.nodeType!==Node.TEXT_NODE?!0:(l.nodeValue??"").trim()!=="");if(g.length===0){t.push(`${n(s)}${d.replace(">","/>")}`);return}if(g.length===1&&g[0].nodeType===Node.TEXT_NODE){t.push(`${n(s)}${d}${(g[0].nodeValue??"").trim()}</${o.tagName}>`);return}t.push(`${n(s)}${d}`);for(let l of g)l.nodeType===Node.ELEMENT_NODE?i(l,s+1):l.nodeType===Node.TEXT_NODE&&t.push(`${n(s+1)}${(l.nodeValue??"").trim()}`);t.push(`${n(s)}</${o.tagName}>`)};return i(e.documentElement,0),t.join(`
`)}debugDump(){console.group("[LiveXML dump]");for(let[e,t]of this.pathSubjects.entries())console.log(e,"=>",t.getValue());console.groupEnd()}import(e){this.doc=new DOMParser().parseFromString(e,"application/xml");let n=this.ensureDoc().documentElement,i=(o,s)=>{for(let l of Array.from(o.attributes)){let f=`${s}/@${l.name}`;this.subjectFor(f).next(l.value)}let a=o.children.length>0,d=(o.textContent??"").trim();!a&&d!==""&&this.subjectFor(s).next(d);let g=new Map;for(let l of Array.from(o.children)){let f=g.get(l.tagName)??[];f.push(l),g.set(l.tagName,f)}for(let[l,f]of g.entries())f.forEach((y,X)=>{i(y,`${s}/${l}[${X+1}]`)})};i(n,n.tagName)}ensureNsOnRoot(e,t){let n=t.documentElement,i=`xmlns:${e}`;if(!n.hasAttribute(i)){let o=this.NS[e];o&&n.setAttribute(i,o)}}createElementSmart(e,t){if(t.includes(":")){let[n]=t.split(":",1),i=this.NS[n],o=i?e.createElementNS(i,t):e.createElement(t);return i&&this.ensureNsOnRoot(n,e),o}return e.createElement(t)}subjectFor(e){let t=this.pathSubjects.get(e);return t||(t=new ne(this.getValue(e)??""),this.pathSubjects.set(e,t)),t}splitAttr(e){let t=e.lastIndexOf("/@");return t>=0?{elementPath:e.slice(0,t),attr:e.slice(t+2)}:{elementPath:e}}ensureElement(e,t,n){let i=t.split("/").filter(Boolean);if(i.length===0)return null;let o=this.parsePart(i[0]),s=e.documentElement;if(!s||s.tagName!==o.name){if(!n)return null;this.init(o.name),e=this.ensureDoc(),s=e.documentElement}let a=s,d=this.normalizePath(s.tagName);for(let g=1;g<i.length;g++){let{name:l,index:f}=this.parsePart(i[g]),y=this.nthChildOrdered(e,a,d,l,f,n);if(!y)return null;a=y,d=this.normalizePath(d+"/"+l+(f?`[${f}]`:""))}return a}parsePart(e){let t=e.match(/^([^\[]+)(?:\[(\d+)])?$/);return{name:t?.[1]??e,index:t?.[2]?parseInt(t[2],10):1}}resolveElement(e){let t=this.ensureDoc();return this.ensureElement(t,e,!1)}count(e){let t=this.ensureDoc(),n=e.split("/").filter(Boolean);if(!n.length)return 0;let i=n.slice(0,-1),o=n[n.length-1],s=o.match(/^(.+?)(?:\[(\d+)])?$/),a=s?.[1]??o,d=s?.[2]?parseInt(s[2],10):void 0,g=i.length?this.ensureElement(t,i.join("/"),!1):t.documentElement;if(!g)return 0;let l=Array.from(g.children).filter(f=>f.tagName===a);return d!=null?d<=l.length?1:0:l.length}getText(e){return this.resolveElement(e)?.textContent?.trim()??""}validateXml(e){try{let n=new DOMParser().parseFromString(e,"application/xml").querySelector("parsererror");return n?{ok:!1,error:n.textContent||"XML inv\xE1lido"}:{ok:!0}}catch(t){return{ok:!1,error:t?.message||"XML inv\xE1lido"}}}nthChildOrdered(e,t,n,i,o,s=!0){let a=Array.from(t.children).filter(l=>l.tagName===i);if(a.length>=o)return a[o-1];if(!s)return null;let d=this.parentOrders.get(n),g=()=>{let l=this.createElementSmart(e,i),f=Array.from(t.children).filter(y=>y.tagName===i).pop();if(f)return f.nextSibling?t.insertBefore(l,f.nextSibling):t.appendChild(l),l;if(d){let y=d.indexOf(i);if(y>=0){let X=Array.from(t.children);for(let Z of X){let ee=d.indexOf(Z.tagName);if(ee>=0&&ee>y)return t.insertBefore(l,Z),l}}}return t.appendChild(l),l};for(;Array.from(t.children).filter(l=>l.tagName===i).length<o;)g();return Array.from(t.children).filter(l=>l.tagName===i)[o-1]??null}ensurePath(e){let t=this.ensureDoc(),{attr:n,elementPath:i}=this.splitAttr(e);n||this.ensureElement(t,i,!0)}prettyXml(e){try{let t=new DOMParser().parseFromString(e,"application/xml"),n=['<?xml version="1.0" encoding="UTF-8"?>'],i=s=>"  ".repeat(s),o=(s,a)=>{let d=Array.from(s.attributes).map(f=>`${f.name}="${f.value}"`).join(" "),g=d?`<${s.tagName} ${d}>`:`<${s.tagName}>`,l=Array.from(s.childNodes).filter(f=>f.nodeType!==Node.TEXT_NODE?!0:(f.nodeValue??"").trim()!=="");if(l.length===0){n.push(`${i(a)}${g.replace(">","/>")}`);return}if(l.length===1&&l[0].nodeType===Node.TEXT_NODE){let f=(l[0].nodeValue??"").trim();n.push(`${i(a)}${g}${f}</${s.tagName}>`);return}n.push(`${i(a)}${g}`);for(let f of l)f.nodeType===Node.ELEMENT_NODE?o(f,a+1):f.nodeType===Node.TEXT_NODE&&n.push(`${i(a+1)}${(f.nodeValue??"").trim()}`);n.push(`${i(a)}</${s.tagName}>`)};return o(t.documentElement,0),n.join(`
`)}catch{return e}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"})};function ve(r,e){if(r&1&&(N(0),u(1,"div",18)(2,"div",19),_(3),c(),S(4,"app-xs-tree-node",20),c(),T()),r&2){let t=e.index,n=h(3);m(3),A("Inst\xE2ncia ",t+1),m(),p("node",n.node)("vPrefix",n.vPrefix)("disableRepeat",!0)("instanceIndex",t)}}function be(r,e){if(r&1&&(u(0,"div",16),x(1,ve,5,5,"ng-container",17),c()),r&2){let t=h(2);m(),p("ngForOf",t.occIndexes(t.node))}}function Ce(r,e){if(r&1){let t=I();N(0),u(1,"details",9)(2,"summary",10)(3,"span",11),_(4),c(),u(5,"span",12)(6,"button",13),C("click",function(){v(t);let i=h();return b(i.decOcc(i.node))}),_(7,"\u2212"),c(),u(8,"span",14),_(9),c(),u(10,"button",13),C("click",function(){v(t);let i=h();return b(i.incOcc(i.node))}),_(11,"+"),c()()(),x(12,be,2,1,"div",15),c(),T()}if(r&2){let t=h();m(4),E(t.node.name||t.node.kind),m(2),p("disabled",!t.canRemove(t.node)),m(3),E(t.occCount(t.node)),m(),p("disabled",!t.canAdd(t.node)),m(2),p("ngIf",t.occCount(t.node)>0)}}function Ee(r,e){if(r&1&&oe(0,21),r&2){h();let t=O(4);p("ngTemplateOutlet",t)}}function ye(r,e){if(r&1&&(N(0),S(1,"app-xs-tree-node",22),T()),r&2){let t=e.$implicit,n=h(3);m(),p("node",t)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)}}function Ne(r,e){if(r&1&&(N(0),x(1,ye,2,3,"ng-container",17),T()),r&2){let t=h(2);m(),p("ngForOf",t.node.children)}}function Te(r,e){if(r&1&&(u(0,"li"),_(1),c()),r&2){let t=e.$implicit;m(),E(t)}}function Oe(r,e){if(r&1&&(u(0,"div",24)(1,"ul",25),x(2,Te,2,1,"li",17),c()()),r&2){let t=h(3);m(2),p("ngForOf",t.node.meta==null?null:t.node.meta.docs)}}function we(r,e){if(r&1&&(u(0,"option",30),_(1),c()),r&2){let t=e.$implicit;p("value",t.id),m(),E(t.name||"op\xE7\xE3o")}}function Me(r,e){if(r&1&&(u(0,"div",16),S(1,"app-xs-tree-node",22),c()),r&2){let t=e.ngIf,n=h(4);m(),p("node",t)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)}}function Ie(r,e){if(r&1){let t=I();N(0),u(1,"div",26)(2,"label"),_(3,"Escolha uma op\xE7\xE3o:"),c(),u(4,"select",27),C("change",function(i){v(t);let o=h(3);return b(o.onChoose(i.target.value))}),u(5,"option",28),_(6,"\u2014 selecione \u2014"),c(),x(7,we,2,2,"option",29),c()(),x(8,Me,2,3,"div",15),T()}if(r&2){let t=h(3);m(4),p("value",t.selectedChoiceId()),m(3),p("ngForOf",t.node.children),m(),p("ngIf",t.selectedChild())}}function ke(r,e){if(r&1&&(u(0,"option",30),_(1),c()),r&2){let t=e.$implicit,n=h(5);p("value",t.name),m(),A(" ",n.enumLabel(t)," ")}}function Pe(r,e){if(r&1){let t=I();N(0),u(1,"div",31)(2,"label"),_(3,"Selecionar:"),c(),u(4,"select",27),C("change",function(i){v(t);let o=h(4);return b(o.onChooseEnum(i.target.value))}),u(5,"option",28),_(6,"\u2014 selecione \u2014"),c(),x(7,ke,2,2,"option",29),c()(),T()}if(r&2){let t=h(4);m(4),p("value",t.selectedEnum()),m(3),p("ngForOf",t.enumOptions())}}function Se(r,e){if(r&1&&(u(0,"div",37),_(1),c()),r&2){let t=h(6);m(),E(t.numberHint())}}function De(r,e){if(r&1&&(u(0,"div",38),_(1),c()),r&2){let t=h(6);m(),E(t.numberError())}}function Ve(r,e){if(r&1){let t=I();u(0,"div",33)(1,"input",34),C("input",function(i){v(t);let o=h(5);return b(o.onNumber(i.target.value))}),c(),x(2,Se,2,1,"div",35)(3,De,2,1,"div",36),c()}if(r&2){let t=h(5);m(),V("invalid",t.numberError()),p("value",t.numberValue())("placeholder",t.numberHint()||"n\xFAmero..."),U("min",t.minAttr())("max",t.maxAttr())("step",t.stepAttr()),m(),p("ngIf",t.numberHint()),m(),p("ngIf",t.numberError())}}function $e(r,e){if(r&1&&x(0,Ve,4,9,"div",32),r&2){h();let t=O(4),n=h(3);p("ngIf",n.isNumericInput())("ngIfElse",t)}}function Xe(r,e){if(r&1&&(u(0,"div",37),_(1),c()),r&2){let t=h(6);m(),E(t.dateHint())}}function Fe(r,e){if(r&1&&(u(0,"div",38),_(1),c()),r&2){let t=h(6);m(),E(t.dateError())}}function Le(r,e){if(r&1){let t=I();u(0,"div",40)(1,"input",41),C("input",function(i){v(t);let o=h(5);return b(o.onDate(i.target.value))}),c(),x(2,Xe,2,1,"div",35)(3,Fe,2,1,"div",36),c()}if(r&2){let t=h(5);m(),V("invalid",t.dateError()),p("value",t.dateValue()),U("min",t.dateMinAttr())("max",t.dateMaxAttr()),m(),p("ngIf",t.dateHint()),m(),p("ngIf",t.dateError())}}function Re(r,e){if(r&1&&x(0,Le,4,7,"div",39),r&2){h();let t=O(6),n=h(3);p("ngIf",n.isDateHere())("ngIfElse",t)}}function Ae(r,e){if(r&1&&(u(0,"div",37),_(1),c()),r&2){let t=h(6);m(),E(t.hint())}}function je(r,e){if(r&1&&(u(0,"div",38),_(1),c()),r&2){let t=h(6);m(),E(t.textError())}}function qe(r,e){if(r&1){let t=I();u(0,"div",43)(1,"input",44),C("input",function(i){v(t);let o=h(5);return b(o.onText(i.target.value))}),c(),x(2,Ae,2,1,"div",35)(3,je,2,1,"div",36),c()}if(r&2){let t=h(5);m(),V("invalid",t.textError()),p("value",t.textValue())("placeholder",t.hint()||"digite..."),U("minlength",t.exactLen()??t.minLen()??null)("maxlength",t.exactLen()??t.maxLen()??null)("pattern",t.htmlPattern()),m(),p("ngIf",t.hint()),m(),p("ngIf",t.textError())}}function ze(r,e){if(r&1&&S(0,"app-xs-tree-node",22),r&2){let t=e.$implicit,n=h(7);p("node",t)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)}}function We(r,e){if(r&1&&(u(0,"div",16),x(1,ze,1,3,"app-xs-tree-node",45),c()),r&2){let t=h(6);m(),p("ngForOf",t.node.children)}}function Ue(r,e){if(r&1&&x(0,We,2,1,"div",15),r&2){let t=h(5);p("ngIf",t.node.children==null?null:t.node.children.length)}}function Be(r,e){if(r&1&&x(0,qe,4,9,"div",42)(1,Ue,1,1,"ng-template",null,7,w),r&2){let t=O(2),n=h(4);p("ngIf",n.isStringInput())("ngIfElse",t)}}function He(r,e){if(r&1&&x(0,Pe,8,2,"ng-container",8)(1,$e,1,2,"ng-template",null,4,w)(3,Re,1,2,"ng-template",null,5,w)(5,Be,3,2,"ng-template",null,6,w),r&2){let t=O(2),n=h(3);p("ngIf",n.isEnumList())("ngIfElse",t)}}function Ke(r,e){if(r&1&&(u(0,"details",9)(1,"summary",10)(2,"span",11),_(3),c()(),x(4,Oe,3,1,"div",23)(5,Ie,9,3,"ng-container",8)(6,He,7,2,"ng-template",null,3,w),c()),r&2){let t=O(7),n=h(2);m(3),E(n.node.name||n.node.kind),m(),p("ngIf",n.node.meta==null||n.node.meta.docs==null?null:n.node.meta.docs.length),m(),p("ngIf",n.isChoice())("ngIfElse",t)}}function Qe(r,e){if(r&1&&x(0,Ne,2,1,"ng-container",8)(1,Ke,8,4,"ng-template",null,2,w),r&2){let t=O(2),n=h();p("ngIf",n.isWrapper())("ngIfElse",t)}}var J=class r{constructor(e,t){this.liveXml=e;this.destroyRef=t}node;vPrefix="";instanceIndex;liveBoundPath;ngOnInit(){this.bindToLiveXmlIfReady()}ngOnChanges(e){("vPrefix"in e||"instanceIndex"in e)&&this.bindToLiveXmlIfReady()}form=M(G);readFormOnce(){let e=this.keyFor(this.node.id);return this.isEnumList()?this.form.getEnum(e)??"":this.form.getText(e)??""}applyToFormFromXml(e){let t=this.keyFor(this.node.id);this.isEnumList()?this.form.setEnum(t,e??""):this.form.setText(t,e??"")}bindToLiveXmlIfReady(){let e=this.getVisualPath();if(!e||this.liveBoundPath===e)return;this.liveBoundPath=e;let t=(this.node?.kind||"").toLowerCase()==="element",n=this.node.meta?.occurs?.min??1;if(t&&n>0&&this.liveXml.ensurePath(e),this.node?.children?.length){let o=this.node.children.filter(s=>(s.kind||"").toLowerCase()==="element").map(s=>s.name).filter(Boolean);o.length&&this.liveXml.registerOrder(e,o)}this.liveXml.observe(e).pipe(ge(this.destroyRef)).subscribe(o=>{o!==this.readFormOnce()&&this.applyToFormFromXml(o)});let i=this.readFormOnce();(i??"").trim()!==""&&this.liveXml.setValue(e,i)}lc=e=>(e||"").toLowerCase();pathFor(){return this.keyFor(this.node.id)}logUpdate(e,t,n){console.groupCollapsed("[field:update]"),console.log("path  :",e),console.log("value :",t),console.log("valid :",n),console.groupEnd()}elName(){return this.node?.name||""}getVisualPath(){if(!((this.node?.kind||"").toLowerCase()==="element"))return this.vPrefix||"";let t=this.instanceIndex!=null?`[${this.instanceIndex+1}]`:"";return(this.vPrefix?this.vPrefix+"/":"")+this.elName()+t}isRequiredElement(){return(this.node.meta?.occurs?.min??0)>=1}childrenOfKind(e,t){return(e.children||[]).filter(n=>this.lc(n.kind)===this.lc(t))}firstChildOfKind(e,t){return(e.children||[]).find(n=>this.lc(n.kind)===this.lc(t))}isWrapper(e=this.node){let t=this.lc(e.kind),n=e.name||"";return!!(["schema","complextype","sequence","simpletype","restriction","all","group","pattern","length","minlength","maxlength","mininclusive","maxinclusive","minexclusive","maxexclusive","totaldigits","fractiondigits"].includes(t)||/^(TS_|T_)/i.test(n))}chain(e=this.node,t=8){let n=[],i=e,o=0;for(;i&&o++<t;){n.push(i);let s=this.firstChildOfKind(i,"simpletype");if(s){i=s;continue}let a=this.firstChildOfKind(i,"restriction");if(a){i=a;continue}break}return n}effectiveBase(){let e="";for(let t of this.chain()){let n=t.meta||{};n.base?e=String(n.base):n.typeName&&(e=String(n.typeName))}return this.lc(e)}effectiveStringFacets(){let e,t,n,i=[],o=s=>{if(!s)return;let a=s.replace(/^\^/,"").replace(/\$$/,"").trim();a&&!i.includes(a)&&i.push(a)};for(let s of this.chain()){let a=s.meta?.stringFacets;a&&(a.length!=null&&(e=a.length),a.minLength!=null&&(t=a.minLength),a.maxLength!=null&&(n=a.maxLength),(a.patterns||[]).forEach(o)),this.childrenOfKind(s,"pattern").forEach(d=>o(d.name))}return{length:e,minLength:t,maxLength:n,patterns:i}}effectiveNumericFacets(){let e={minInclusive:void 0,maxInclusive:void 0,minExclusive:void 0,maxExclusive:void 0,totalDigits:void 0,fractionDigits:void 0};for(let t of this.chain()){let n=t.meta?.numericFacets;n&&(n.minInclusive!=null&&(e.minInclusive=n.minInclusive),n.maxInclusive!=null&&(e.maxInclusive=n.maxInclusive),n.minExclusive!=null&&(e.minExclusive=n.minExclusive),n.maxExclusive!=null&&(e.maxExclusive=n.maxExclusive),n.totalDigits!=null&&(e.totalDigits=n.totalDigits),n.fractionDigits!=null&&(e.fractionDigits=n.fractionDigits))}return e}isRequiredNode(e=this.node){let t=(e.meta?.use||"").toString().toLowerCase(),n=e.meta?.occurs?.min;return t==="required"||typeof n=="number"&&n>0}idPrefix="";disableRepeat=!1;keyFor(e){return(this.idPrefix?this.idPrefix:"")+e}getVal(e){return this.store?.[this.keyFor(e)]??""}setVal(e,t){(this.store||={})[this.keyFor(e)]=t??""}occ=new Map;occursMeta(e){return e.meta?.occurs??{min:0,max:1}}initOcc(e){if(!this.occ.has(e.id)){let{min:t}=this.occursMeta(e);this.occ.set(e.id,Math.max(0,Number(t||0)))}}occCount(e){return this.initOcc(e),this.occ.get(e.id)}occIndexes(e){return Array.from({length:this.occCount(e)},(t,n)=>n)}canAdd(e){let{max:t}=this.occursMeta(e),n=this.occCount(e);return t==="unbounded"||n<(t??1)}canRemove(e){let{min:t}=this.occursMeta(e);return this.occCount(e)>(t??0)}incOcc(e){this.canAdd(e)&&this.occ.set(e.id,this.occCount(e)+1)}decOcc(e){this.canRemove(e)&&this.occ.set(e.id,this.occCount(e)-1)}isRepeatable(){if(this.disableRepeat)return!1;let e=this.node.meta?.occurs;return e?e.max==="unbounded"?!0:typeof e.max=="number"&&e.max>1:!1}isChoice(){return this.lc(this.node.kind)==="choice"}selectedChoiceId=k(()=>this.form.getChoice(this.keyFor(this.node.id))??"");onChoose(e){this.form.setChoice(this.keyFor(this.node.id),e),this.logUpdate(this.getVisualPath()+" [choice]",e,!!e)}selectedChild=k(()=>{let e=this.selectedChoiceId();if(!e){if(this.isChoice()&&this.node.children?.length===1){let t=this.node.children[0];return this.form.setChoice(this.node.id,t.id),t}return null}return(this.node.children||[]).find(t=>t.id===e)||null});collectEnumOptionsDeep(e,t=0){if(t>3)return[];let n=[];for(let d of this.childrenOfKind(e,"enumeration"))n.push(...d.children?.length?d.children:[d]);let i=this.firstChildOfKind(e,"restriction");if(i)for(let d of this.childrenOfKind(i,"enumeration"))n.push(...d.children?.length?d.children:[d]);let o=this.firstChildOfKind(e,"simpletype");o&&n.push(...this.collectEnumOptionsDeep(o,t+1));for(let d of e.children||[])if(this.lc(d.kind)!=="enumeration"&&d.children?.length)for(let g of this.childrenOfKind(d,"enumeration"))n.push(...g.children?.length?g.children:[g]);let s=e.meta?.numericFacets?.enums;if(s?.length)for(let d of s)n.push({id:`${e.id}#enum:${d}`,name:String(d),kind:"enumeration",children:[],source:e.source,meta:{docs:[]}});let a={};return n.filter(d=>{let g=d.name??"";return a[g]?!1:(a[g]=!0,!0)})}enumOptions=k(()=>this.collectEnumOptionsDeep(this.node));isEnumList(){return this.enumOptions().length>0}selectedEnum=k(()=>this.form.getEnum(this.keyFor(this.node.id))??"");onChooseEnum(e){let t=(e??"").trim();this.form.setEnum(this.keyFor(this.node.id),t);let n=this.isRequiredNode(),i=this.enumOptions().map(a=>a.name),o=(t!==""||!n)&&(t===""||i.includes(t)),s=this.getVisualPath();this.liveXml.setValue(s,t),this.logUpdate(s,t,o)}enumLabel(e){let t=e.name||"",n=e.meta?.docs&&e.meta.docs[0]?String(e.meta.docs[0]).trim():"";return n?`${t} - ${n}`:t}enumError(e){let t=this.enumOptions().map(n=>n.name);return e?t.length&&!t.includes(e)?"Valor n\xE3o \xE9 uma op\xE7\xE3o v\xE1lida":"":this.isRequiredElement()?"Obrigat\xF3rio":""}isStringInput(){if(this.isEnumList()||this.isNumericInput())return!1;let e=this.effectiveBase(),t=this.lc(this.node.kind);return(t==="element"||t==="simpletype")&&e.includes("string")}textValue=k(()=>this.form.getText(this.keyFor(this.node.id)));onText(e){let t=(e??"").trim();this.form.setText(this.keyFor(this.node.id),t);let n=this.textError()==="",i=this.getVisualPath();this.liveXml.setValue(i,t),this.logUpdate(i,t,n)}exactLen(){return this.effectiveStringFacets().length}minLen(){return this.effectiveStringFacets().minLength}maxLen(){return this.effectiveStringFacets().maxLength}collectAllPatternsDeep(e=this.node){let t=[],n=i=>{let o=this.normalizePattern(i);o&&!t.includes(o)&&t.push(o)};for(let i of this.chain(e))i.meta?.stringFacets?.patterns?.forEach(n),this.childrenOfKind(i,"pattern").forEach(o=>n(o.name));return t}patterns(){return this.collectAllPatternsDeep()}htmlPattern(){let e=this.patterns();return e.length?e.length===1?e[0]:`(?:${e.join(")|(?:")})`:null}compileAnchoredRegex(e){let t=this.normalizePattern(e);if(!t)return null;try{return new RegExp(`^(?:${t})$`)}catch{return null}}textError=k(()=>{let e=(this.textValue()??"").trim();if(e==="")return"Obrigat\xF3rio";for(let s of this.patterns()){let a=this.compileAnchoredRegex(s);if(a&&!a.test(e))return`Valor n\xE3o atende ao padr\xE3o: ${s}`}let t=e.length,n=this.exactLen();if(n!=null&&t!==n)return`Deve ter exatamente ${n} caracteres.`;let i=this.minLen();if(i!=null&&t<i)return`M\xEDnimo de ${i} caracteres.`;let o=this.maxLen();return o!=null&&t>o?`M\xE1ximo de ${o} caracteres.`:""});hint(){let e=[],t=this.patterns();t.length&&e.push(`pattern: ${t[0]}`);let n=this.exactLen(),i=this.minLen(),o=this.maxLen();return n!=null?e.push(`tamanho: ${n}`):(i!=null&&e.push(`m\xEDn: ${i}`),o!=null&&e.push(`m\xE1x: ${o}`)),e.join(" \xB7 ")}numericBases=["byte","short","int","integer","long","decimal","float","double","nonnegativeinteger","positiveinteger","nonpositiveinteger","negativeinteger","unsignedbyte","unsignedshort","unsignedint","unsignedlong"];isNumericInput(){if(this.isEnumList())return!1;let e=this.effectiveBase(),t=this.lc(this.node.kind);return(t==="element"||t==="simpletype")&&this.numericBases.some(n=>e.endsWith(n))}numberValue=k(()=>this.form.getText(this.keyFor(this.node.id)));onNumber(e){let t=(e??"").trim();this.form.setText(this.keyFor(this.node.id),t);let n=this.numberError()==="",i=this.getVisualPath();this.liveXml.setValue(i,t),this.logUpdate(i,t,n)}numericPatterns(){return this.collectAllPatternsDeep()}numericHtmlPattern(){let e=this.numericPatterns();return e.length?e.length===1?e[0]:`(?:${e.join(")|(?:")})`:null}minAttr(){let e=this.effectiveNumericFacets();return e.minInclusive!=null?e.minInclusive:e.minExclusive!=null?e.minExclusive+1:null}maxAttr(){let e=this.effectiveNumericFacets();return e.maxInclusive!=null?e.maxInclusive:e.maxExclusive!=null?e.maxExclusive-1:null}stepAttr(){let e=this.effectiveNumericFacets();return e.fractionDigits!=null&&e.fractionDigits>0?"0."+"0".repeat(e.fractionDigits-1)+"1":"1"}numberError=k(()=>{let e=(this.numberValue()??"").trim();if(e==="")return"Obrigat\xF3rio";for(let a of this.numericPatterns()){let d=this.compileAnchoredRegex(a);if(d&&!d.test(e))return`Valor n\xE3o atende ao padr\xE3o: ${a}`}if(!/^-?\d+(\.\d+)?$/.test(e))return"N\xFAmero inv\xE1lido";let n=this.effectiveNumericFacets(),i=Number(e),o=this.effectiveBase();return!o.includes("decimal")&&!o.includes("float")&&!o.includes("double")&&!/^[-]?\d+$/.test(e)?"Deve ser inteiro":n.fractionDigits!=null&&(e.split(".")[1]||"").length>n.fractionDigits?`M\xE1ximo de ${n.fractionDigits} casas decimais`:n.totalDigits!=null&&e.replace(/^-/,"").replace(".","").length>n.totalDigits?`M\xE1ximo de ${n.totalDigits} d\xEDgitos`:n.minInclusive!=null&&!(i>=n.minInclusive)?`M\xEDnimo: ${n.minInclusive}`:n.minExclusive!=null&&!(i>n.minExclusive)?`Deve ser > ${n.minExclusive}`:n.maxInclusive!=null&&!(i<=n.maxInclusive)?`M\xE1ximo: ${n.maxInclusive}`:n.maxExclusive!=null&&!(i<n.maxExclusive)?`Deve ser < ${n.maxExclusive}`:""});numberHint(){let e=[],t=this.numericPatterns();t.length&&e.push(`pattern: ${t[0]}`);let n=this.effectiveNumericFacets();return n.minInclusive!=null&&e.push(`m\xEDn: ${n.minInclusive}`),n.maxInclusive!=null&&e.push(`m\xE1x: ${n.maxInclusive}`),n.minExclusive!=null&&e.push(`> ${n.minExclusive}`),n.maxExclusive!=null&&e.push(`< ${n.maxExclusive}`),n.totalDigits!=null&&e.push(`d\xEDgitos: ${n.totalDigits}`),n.fractionDigits!=null&&e.push(`decimais: ${n.fractionDigits}`),e.join(" \xB7 ")}normalizePattern(e){if(!e)return null;let t=String(e).trim();return t=t.replace(/^pattern\s*:\s*/i,"").replace(/^regex\s*:\s*/i,"").trim(),(t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))&&(t=t.slice(1,-1).trim()),t.startsWith("^")&&(t=t.slice(1)),t.endsWith("$")&&(t=t.slice(0,-1)),t=t.replace(/\\\\/g,"\\"),!t||t===".*"||t===".+"?null:t}qnToToken(e){return e?String(e).toLowerCase().trim().replace(/^\{[^}]+\}/,"").replace(/^[a-z_][\w.-]*:/,"").trim():""}isDateHere(){let e=(this.node.kind||"").toLowerCase();return e==="element"||e==="simpletype"?(this.qnToToken(this.node.meta?.base)||this.qnToToken(this.node.meta?.typeName))==="date":!1}dateValue(){return this.textValue()}onDate(e){let t=(e??"").trim();this.form.setText(this.keyFor(this.node.id),t);let n=this.dateError()==="",i=this.getVisualPath();this.liveXml.setValue(i,t),this.logUpdate(i,t,n)}dateFacetsHere(){return this.node.meta?.dateFacets??{}}addDays(e,t){let n=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e||"");if(!n)return null;let i=new Date(Date.UTC(+n[1],+n[2]-1,+n[3]+t)),o=String(i.getUTCMonth()+1).padStart(2,"0"),s=String(i.getUTCDate()).padStart(2,"0");return`${i.getUTCFullYear()}-${o}-${s}`}dateMinAttr(){let e=this.dateFacetsHere();return e.minInclusive??(e.minExclusive?this.addDays(e.minExclusive,1):null)}dateMaxAttr(){let e=this.dateFacetsHere();return e.maxInclusive??(e.maxExclusive?this.addDays(e.maxExclusive,-1):null)}dateHint(){let e=this.dateFacetsHere(),t=[];return e.minInclusive&&t.push(`m\xEDn: ${e.minInclusive}`),e.minExclusive&&t.push(`> ${e.minExclusive}`),e.maxInclusive&&t.push(`m\xE1x: ${e.maxInclusive}`),e.maxExclusive&&t.push(`< ${e.maxExclusive}`),t.join(" \xB7 ")}dateError(){let e=(this.dateValue()||"").trim();if(!e)return"Obrigat\xF3rio";if(!/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/.test(e))return"Formato inv\xE1lido (AAAA-MM-DD)";let t=new Date(e),[n,i,o]=e.split("-").map(Number);if(isNaN(+t)||t.getUTCFullYear()!==n||t.getUTCMonth()+1!==i||t.getUTCDate()!==o)return"Data inexistente";let s=this.dateFacetsHere();return s.minInclusive&&!(e>=s.minInclusive)?`M\xEDnimo: ${s.minInclusive}`:s.minExclusive&&!(e>s.minExclusive)?`Deve ser > ${s.minExclusive}`:s.maxInclusive&&!(e<=s.maxInclusive)?`M\xE1ximo: ${s.maxInclusive}`:s.maxExclusive&&!(e<s.maxExclusive)?`Deve ser < ${s.maxExclusive}`:""}static \u0275fac=function(t){return new(t||r)(R($),R(z))};static \u0275cmp=W({type:r,selectors:[["app-xs-tree-node"]],inputs:{node:"node",vPrefix:"vPrefix",instanceIndex:"instanceIndex",idPrefix:"idPrefix",disableRepeat:"disableRepeat"},features:[re],decls:5,vars:2,consts:[["notRepeatable",""],["renderSelf",""],["normalBox",""],["notChoice",""],["maybeNumber",""],["maybeDate",""],["maybeString",""],["regularChildren",""],[4,"ngIf","ngIfElse"],["open","",1,"node"],[1,"sum"],[1,"name"],[1,"occ-ctrl"],["type","button",1,"btn",3,"click","disabled"],[1,"occ"],["class","children",4,"ngIf"],[1,"children"],[4,"ngFor","ngForOf"],[1,"instance"],[1,"inst-header"],[3,"node","vPrefix","disableRepeat","instanceIndex"],[3,"ngTemplateOutlet"],[3,"node","idPrefix","vPrefix"],["class","docbox",4,"ngIf"],[1,"docbox"],[1,"docbox-list"],[1,"choice-picker"],[3,"change","value"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"enum-picker"],["class","number-input",4,"ngIf","ngIfElse"],[1,"number-input"],["type","number","inputmode","decimal",1,"text",3,"input","value","placeholder"],["class","hint",4,"ngIf"],["class","error",4,"ngIf"],[1,"hint"],[1,"error"],["class","date-input",4,"ngIf","ngIfElse"],[1,"date-input"],["type","date","placeholder","AAAA-MM-DD",1,"text",3,"input","value"],["class","string-input",4,"ngIf","ngIfElse"],[1,"string-input"],["type","text",1,"text",3,"input","value","placeholder"],[3,"node","idPrefix","vPrefix",4,"ngFor","ngForOf"]],template:function(t,n){if(t&1&&x(0,Ce,13,5,"ng-container",8)(1,Ee,1,1,"ng-template",null,0,w)(3,Qe,3,2,"ng-template",null,1,w),t&2){let i=O(2);p("ngIf",n.isRepeatable())("ngIfElse",i)}},dependencies:[r,K,B,H,ce],styles:[".node[_ngcontent-%COMP%]{border:1px solid #d7d7db;border-radius:12px;padding:8px 12px;background:#fff}[_nghost-%COMP%]{display:block;margin-top:12px}.sum[_ngcontent-%COMP%]{cursor:pointer;font-weight:600}.children[_ngcontent-%COMP%]{display:grid;grid-auto-rows:auto;gap:12px;margin-top:8px}details.node[_ngcontent-%COMP%] + details.node[_ngcontent-%COMP%]{margin-top:12px}.docbox[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;border:1px solid #e5e7eb;background:#fafafa;border-radius:10px}.docbox-list[_ngcontent-%COMP%]{margin:0;padding-left:18px;white-space:pre-wrap;font-size:13px}.choice-picker[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:10px}.choice-picker[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;border-radius:8px;border:1px solid #c8c8cc;background:#fff}.string-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-top:10px}.text[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #c8c8cc;border-radius:8px}.text.invalid[_ngcontent-%COMP%]{border-color:#e11d48;background:#fff1f2}.hint[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.error[_ngcontent-%COMP%]{font-size:12px;color:#e11d48}.number-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-top:10px}.occ-ctrl[_ngcontent-%COMP%]{display:inline-flex;gap:8px;margin-left:10px;align-items:center}.occ-ctrl[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:0 8px;border:1px solid #e5e7eb;border-radius:6px;background:#f8fafc;cursor:pointer}.occ-ctrl[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.occ-ctrl[_ngcontent-%COMP%]   .occ[_ngcontent-%COMP%]{min-width:22px;text-align:center;font-weight:600}.instance[_ngcontent-%COMP%]{border:1px dashed #e5e7eb;border-radius:10px;padding:10px}.inst-header[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin:6px 0 10px}[_nghost-%COMP%], .page[_ngcontent-%COMP%], .content[_ngcontent-%COMP%], .node[_ngcontent-%COMP%], .children[_ngcontent-%COMP%]{max-width:100%;overflow-x:hidden}.docbox[_ngcontent-%COMP%], .docbox-list[_ngcontent-%COMP%], .docbox-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], details.node[_ngcontent-%COMP%], summary.sum[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%], .string-input[_ngcontent-%COMP%], .number-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{white-space:normal;overflow-wrap:anywhere;word-break:break-word}*[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}details.node[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}"]})};var Ye=["xmlDlg"];function Ge(r,e){if(r&1&&(u(0,"div",19),S(1,"app-xs-tree-node",20),c()),r&2){let t=e.ngIf;m(),p("node",t)}}function Je(r,e){r&1&&(u(0,"div",21),_(1," N\xE3o foi poss\xEDvel construir a \xE1rvore do evento. Verifique se o "),u(2,"b"),_(3,"tipos.xsd"),c(),_(4," est\xE1 presente. "),c())}function Ze(r,e){r&1&&(N(0),_(1,"XML malformado"),T())}function et(r,e){if(r&1&&(N(0),_(1),T()),r&2){let t=h();m(),A("Incompleto: ",t.missingRequired.length," obrigat\xF3rio(s)")}}function tt(r,e){r&1&&(N(0),_(1,"V\xE1lido"),T())}function nt(r,e){if(r&1&&(u(0,"li"),_(1),c()),r&2){let t=e.$implicit;m(),E(t)}}function it(r,e){if(r&1&&(u(0,"div",22)(1,"div",23),_(2,"Campos obrigat\xF3rios ausentes:"),c(),u(3,"ul"),x(4,nt,2,1,"li",24),c()()),r&2){let t=h();m(4),p("ngForOf",t.missingRequired)}}var he=class r{constructor(e){this.liveXml=e;let t=decodeURIComponent(this.route.snapshot.paramMap.get("fileName")||""),{code:n,title:i,root:o}=this.adapter.buildViewTreeFromLatest(t),s=new RegExp(`^\\s*${n}\\b`,"i").test(i);this.headerTitle.set(s?i:`${n} - ${i}`),this.root.set(o),this.eventName=t.replace(".xsd",""),console.groupCollapsed("[VIEW TREE]",t),console.log({meta:{code:n,title:i,fileName:t},root:o}),console.groupEnd(),window.__viewTree=o}route=M(me);adapter=M(Q);eventName="";xmlDlg;xmlText="";xmlOk=!0;requiredOk=!0;xmlErr="";missingRequired=[];headerTitle=P("\u2014");root=P(null);ngOnInit(){this.bootstrapLiveXml()}bootstrapLiveXml(){this.liveXml.init("eSocial");let e=`eSocial/${this.eventName}`;this.liveXml.ensurePath(e);let t=this.generateEventId(),n=`${e}/@Id`;this.liveXml.setValue(n,t),console.log("[liveXML] set Id em",n,"=>",this.liveXml.getValue(n))}generateEventId(e){let t=(s,a)=>s.toString().padStart(a,"0"),n=new Date,i=`${n.getFullYear()}${t(n.getMonth()+1,2)}${t(n.getDate(),2)}${t(n.getHours(),2)}${t(n.getMinutes(),2)}${t(n.getSeconds(),2)}`,o=Math.floor(Math.random()*1e7).toString().padStart(7,"0");return`ID${e??"00000000000000"}${i}${o}`}expandAll(){document.querySelectorAll("details.node, details.docs").forEach(e=>e.setAttribute("open",""))}collapseAll(){document.querySelectorAll("details.node, details.docs").forEach(e=>e.removeAttribute("open"))}onGerarXmlConsole(){let e=this.liveXml.serialize(!0);console.log(`[LiveXML] XML gerado:
`+e)}openXmlModal(){this.xmlText=this.liveXml.serialize(!0),this.revalidateXmlAndRequired(),this.xmlDlg.nativeElement.showModal()}closeXmlModal(){this.xmlDlg.nativeElement.close()}onXmlInput(e){this.xmlText=e.target.value??"",this.revalidateXmlAndRequired()}updateXmlValidity(){let e=this.liveXml.validateXml(this.xmlText);this.xmlOk=e.ok,this.xmlErr=e.error||""}revalidateXmlAndRequired(){let e=this.liveXml.validateXml(this.xmlText);if(this.xmlOk=e.ok,this.xmlErr=e.error||"",this.xmlOk){let t=new DOMParser().parseFromString(this.xmlText,"application/xml");this.missingRequired=this.collectMissingRequiredFromDoc(t),this.requiredOk=this.missingRequired.length===0}else this.missingRequired=[],this.requiredOk=!1}applyXmlToForm(){this.xmlOk&&this.liveXml.import(this.xmlText)}downloadXml(){let e=new Blob([this.xmlText],{type:"application/xml;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="evento.xml",n.click(),URL.revokeObjectURL(t)}saveXmlLocal(){localStorage.setItem("esocial.liveXml.draft",this.xmlText)}loadXmlLocal(){let e=localStorage.getItem("esocial.liveXml.draft");e!=null&&(this.xmlText=e,this.updateXmlValidity())}collectMissingRequiredFromDoc(e){let t=[],n=this.root?.();if(!n)return t;let i=(o,s)=>{let a=(o.kind||"").toLowerCase(),d=o.name||"";if(this.isIgnoredName(d))return;let g=a==="element"?s?`${s}/${d}`:d:s;if(a==="choice"&&(o.meta?.occurs?.min??1)>0&&((o.children??[]).some(y=>{if((y.kind||"").toLowerCase()!=="element")return!1;let X=`${g}/${y.name}`;return this.countInDoc(e,X)>0})||t.push(`${g} [escolha um]`)),a==="element"&&o.children?.length){(o.meta?.occurs?.min??1)>0&&this.countInDoc(e,g)<1&&t.push(g);for(let f of o.children)i(f,g)}if(a==="element"&&(!o.children||o.children.length===0)&&(o.meta?.occurs?.min??1)>0&&(this.textInDoc(e,g)||t.push(g)),(a==="sequence"||a==="complextype"||a==="schema"||a==="simpletype"||a==="group")&&o.children)for(let l of o.children)i(l,g)};return i(n,""),t.map(o=>o.startsWith("eSocial")?o:`eSocial/${o}`)}isIgnoredName(e){return e?/^ds:/i.test(e):!1}textInDoc(e,t){let n=t.split("/").filter(Boolean),i=e.documentElement;if(!i||i.tagName!==n[0])return null;for(let s=1;s<n.length;s++){let a=n[s].replace(/\[\d+]/,""),g=Array.from(i.children).filter(l=>l.tagName===a);if(g.length===0||(i=g[0]??null,!i))return null}let o=(i.textContent??"").trim();return o.length?o:null}countInDoc(e,t){let n=t.split("/").filter(Boolean),i=e.documentElement;if(!i||i.tagName!==n[0])return 0;for(let o=1;o<n.length;o++){let s=n[o].match(/^(.+?)(?:\[(\d+)])?$/),a=s?.[1]??n[o],d=s?.[2]?parseInt(s[2],10):void 0,l=Array.from(i.children).filter(f=>f.tagName===a);if(d!=null){if(d<1||d>l.length||(i=l[d-1]??null,!i))return 0}else{if(o===n.length-1)return l.length;if(i=l[0]??null,!i)return 0}}return i?1:0}static \u0275fac=function(t){return new(t||r)(R($))};static \u0275cmp=W({type:r,selectors:[["app-novo-evento-winzard"]],viewQuery:function(t,n){if(t&1&&se(Ye,5),t&2){let i;ae(i=le())&&(n.xmlDlg=i.first)}},decls:39,vars:13,consts:[["missing",""],["xmlDlg",""],[1,"actions"],["routerLink","/gestao",1,"button"],["type","button",3,"click"],["type","button",1,"btn",3,"click"],[1,"title"],["class","root",4,"ngIf","ngIfElse"],[1,"xml-dlg"],["method","dialog",1,"xml-dlg-body",3,"submit"],[1,"xml-dlg-header"],[1,"status"],[4,"ngIf"],[1,"xml-scroll"],["spellcheck","false",1,"xml-text",3,"input","value"],["class","xml-issues",4,"ngIf"],[1,"xml-dlg-footer"],[1,"spacer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"root"],[3,"node"],[1,"placeholder"],[1,"xml-issues"],[1,"issues-title"],[4,"ngFor","ngForOf"]],template:function(t,n){if(t&1){let i=I();u(0,"div",2)(1,"button",3),_(2,"\u2190 Voltar"),c(),u(3,"button",4),C("click",function(){return v(i),b(n.expandAll())}),_(4,"Expandir tudo"),c(),u(5,"button",4),C("click",function(){return v(i),b(n.collapseAll())}),_(6,"Recolher tudo"),c(),u(7,"button",5),C("click",function(){return v(i),b(n.openXmlModal())}),_(8,"XML / Preview"),c()(),u(9,"h2",6),_(10),c(),x(11,Ge,2,1,"div",7)(12,Je,5,0,"ng-template",null,0,w),u(14,"dialog",8,1)(16,"form",9),C("submit",function(s){return v(i),b(s.preventDefault())}),u(17,"header",10)(18,"strong"),_(19,"Editor de XML"),c(),u(20,"span",11),x(21,Ze,2,0,"ng-container",12)(22,et,2,1,"ng-container",12)(23,tt,2,0,"ng-container",12),c()(),u(24,"div",13)(25,"textarea",14),C("input",function(s){return v(i),b(n.onXmlInput(s))}),c(),x(26,it,5,1,"div",15),c(),u(27,"footer",16)(28,"button",5),C("click",function(){return v(i),b(n.loadXmlLocal())}),_(29,"Carregar rascunho"),c(),u(30,"button",5),C("click",function(){return v(i),b(n.saveXmlLocal())}),_(31,"Salvar rascunho"),c(),S(32,"span",17),u(33,"button",5),C("click",function(){return v(i),b(n.downloadXml())}),_(34,"Baixar .xml"),c(),u(35,"button",18),C("click",function(){return v(i),b(n.applyXmlToForm())}),_(36," Aplicar no formul\xE1rio "),c(),u(37,"button",5),C("click",function(){return v(i),b(n.closeXmlModal())}),_(38,"Fechar"),c()()()()}if(t&2){let i=O(13);m(10),E(n.headerTitle()),m(),p("ngIf",n.root())("ngIfElse",i),m(9),V("ok",n.xmlOk&&n.requiredOk)("err",!(n.xmlOk&&n.requiredOk)),m(),p("ngIf",!n.xmlOk),m(),p("ngIf",n.xmlOk&&!n.requiredOk),m(),p("ngIf",n.xmlOk&&n.requiredOk),m(2),p("value",n.xmlText),m(),p("ngIf",n.xmlOk&&!n.requiredOk),m(9),p("disabled",!(n.xmlOk&&n.requiredOk))}},dependencies:[K,B,H,de,J],styles:[".back[_ngcontent-%COMP%]{margin-bottom:10px;padding:6px 10px;border-radius:8px;border:1px solid #c8c8cc;background:#f5f5f7}.title[_ngcontent-%COMP%]{margin:0 0 10px}.actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:10px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;border:1px solid #c8c8cc;background:#f5f5f7;cursor:pointer}.root[_ngcontent-%COMP%]{display:grid;gap:10px}.placeholder[_ngcontent-%COMP%]{opacity:.85;border:1px dashed #c8c8cc;border-radius:12px;padding:14px;background:#fff}dialog.xml-dlg[_ngcontent-%COMP%]{width:min(1100px,96vw);max-height:90vh;padding:0;border:none;border-radius:12px;overflow:hidden;box-shadow:0 20px 50px #00000059}.xml-dlg-body[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto 1fr auto;height:min(80vh,calc(100vh - 4rem))}.xml-dlg-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fff}.xml-dlg-header[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:auto;font-size:.9rem}.xml-dlg-header[_ngcontent-%COMP%]   .status.ok[_ngcontent-%COMP%]{color:#059669}.xml-dlg-header[_ngcontent-%COMP%]   .status.err[_ngcontent-%COMP%]{color:#dc2626}.xml-scroll[_ngcontent-%COMP%]{overflow:auto;background:#0b1020}.xml-text[_ngcontent-%COMP%]{display:block;width:100%;height:60vh;border:0;outline:0;resize:none;box-sizing:border-box;padding:12px 16px;color:#e6edf3;background:#0b1020;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:13px;line-height:1.45}.xml-issues[_ngcontent-%COMP%]{padding:10px 16px;color:#eab308;background:#0f172a;border-top:1px solid #1f2937}.xml-issues[_ngcontent-%COMP%]   .issues-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.xml-dlg-footer[_ngcontent-%COMP%]{position:sticky;bottom:0;background:#fff;display:flex;align-items:center;gap:8px;padding:12px 16px;border-top:1px solid #e5e7eb}.btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{background:#f9fafb}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border-color:#2563eb}.btn-primary[_ngcontent-%COMP%]:hover{background:#1d4ed8}"]})};export{he as NovoEventoWinzardComponent};
