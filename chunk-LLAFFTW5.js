import{c as pe}from"./chunk-27D4PCIU.js";import{a as ge}from"./chunk-X5A3O7XB.js";import"./chunk-VV2HN75Q.js";import{C as c,Da as U,E as V,Ea as K,F as B,Fa as me,Ia as H,J as x,Ka as de,Na as ue,O as W,P as p,Q as d,R as l,S as k,V as O,W as w,X as se,Y as M,_ as C,a as R,aa as g,b as L,d as j,da as ae,e as q,ea as le,fa as ce,ga as N,i as ne,ia as X,ja as h,k as ie,ka as E,la as A,o as re,q as D,t as P,u as v,v as b,w as z,wa as T,y as S,z as oe,za as I}from"./chunk-H64DG2YF.js";var Q=class o{catalog=P(ge);treeSvc=P(pe);buildViewTreeFromLatest(e){let t=this.catalog.getLatestSchema();if(!t)throw new Error("Nenhum conjunto de schemas carregado.");let n=t.files?.[e];if(!n)throw new Error(`XSD do evento n\xE3o encontrado: ${e}`);let i=t.events?.find(_=>_.isTipos)?.fileName??Object.keys(t.files||{}).find(_=>/tipos\.xsd$/i.test(_))??Object.keys(t.files||{}).find(_=>/tipos/i.test(_));if(!i)throw new Error("Arquivo tipos.xsd n\xE3o encontrado no conjunto.");let r=t.files[i],s=this.treeSvc.buildEventoTree(n,r),a=this.toView(s,new Set),f=t.events?.find(_=>_.fileName===e)?.label||e;return{code:(f.match(/S-\d{3,4}/i)?.[0]||e.match(/S-\d{3,4}/i)?.[0]||"\u2014").toUpperCase(),title:f,root:a}}toView(e,t){let n=e.id||`${e.kind}:${e.name}:${t.size}`;if(t.has(n))return{id:n,name:e.name,kind:e.kind,meta:e.meta,source:e,children:[]};t.add(n);let i=(e.children||[]).map(r=>this.toView(r,t));return{id:n,name:e.name,kind:e.kind,meta:e.meta,source:e,children:i}}static \u0275fac=function(t){return new(t||o)};static \u0275prov=D({token:o,factory:o.\u0275fac,providedIn:"root"})};function G(o){o||(o=P(z));let e=new ne(t=>{if(o.destroyed){t.next();return}return o.onDestroy(t.next.bind(t))});return t=>t.pipe(re(e))}var $=class o{doc=null;pathSubjects=new Map;parentOrders=new Map;registerOrder(e,t){this.parentOrders.set(this.normalizePath(e),t.slice())}normalizePath(e){return e.replace(/\[\d+]/g,"")}reemit(e){for(let[t,n]of this.pathSubjects.entries())(!e||t.startsWith(e))&&n.next(this.getValue(t)??"")}emitAll(){for(let[e,t]of this.pathSubjects.entries())t.next(this.getValue(e)??"")}init(e="eSocial"){let t=`<?xml version="1.0" encoding="UTF-8"?><${e}/>`;this.doc=new DOMParser().parseFromString(t,"application/xml")}ensureDoc(){return this.doc||this.init("eSocial"),this.doc}NS={ds:"http://www.w3.org/2000/09/xmldsig#"};observe(e){return this.subjectFor(e).asObservable()}getValue(e){let t=this.ensureDoc(),{attr:n,elementPath:i}=this.splitAttr(e),r=this.ensureElement(t,i,!1);return r?n?r.getAttribute(n)??"":r.textContent??"":""}setValue(e,t){let n=this.ensureDoc(),{attr:i,elementPath:r}=this.splitAttr(e),s=this.ensureElement(n,r,!0);if(s){if(i)s.setAttribute(i,t??"");else{for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(n.createTextNode(t??""))}this.subjectFor(e).next(t??"")}}serialize(e=!0){let t=this.ensureDoc();return e?this.prettyFromDoc(t):new XMLSerializer().serializeToString(t)}prettyFromDoc(e){let t=['<?xml version="1.0" encoding="UTF-8"?>'],n=r=>"  ".repeat(r),i=(r,s)=>{let a=Array.from(r.attributes).map(u=>`${u.name}="${u.value}"`).join(" "),m=a?`<${r.tagName} ${a}>`:`<${r.tagName}>`,f=Array.from(r.childNodes).filter(u=>u.nodeType!==Node.TEXT_NODE?!0:(u.nodeValue??"").trim()!=="");if(f.length===0){t.push(`${n(s)}${m.replace(">","/>")}`);return}if(f.length===1&&f[0].nodeType===Node.TEXT_NODE){t.push(`${n(s)}${m}${(f[0].nodeValue??"").trim()}</${r.tagName}>`);return}t.push(`${n(s)}${m}`);for(let u of f)u.nodeType===Node.ELEMENT_NODE?i(u,s+1):u.nodeType===Node.TEXT_NODE&&t.push(`${n(s+1)}${(u.nodeValue??"").trim()}`);t.push(`${n(s)}</${r.tagName}>`)};return i(e.documentElement,0),t.join(`
`)}debugDump(){console.group("[LiveXML dump]");for(let[e,t]of this.pathSubjects.entries())console.log(e,"=>",t.getValue());console.groupEnd()}import(e){this.doc=new DOMParser().parseFromString(e,"application/xml");let n=this.ensureDoc().documentElement,i=(r,s)=>{for(let u of Array.from(r.attributes)){let _=`${s}/@${u.name}`;this.subjectFor(_).next(u.value)}let a=r.children.length>0,m=(r.textContent??"").trim();!a&&m!==""&&this.subjectFor(s).next(m);let f=new Map;for(let u of Array.from(r.children)){let _=f.get(u.tagName)??[];_.push(u),f.set(u.tagName,_)}for(let[u,_]of f.entries())_.forEach((y,F)=>{i(y,`${s}/${u}[${F+1}]`)})};i(n,n.tagName),this.emitAll()}ensureNsOnRoot(e,t){let n=t.documentElement,i=`xmlns:${e}`;if(!n.hasAttribute(i)){let r=this.NS[e];r&&n.setAttribute(i,r)}}createElementSmart(e,t){if(t.includes(":")){let[n]=t.split(":",1),i=this.NS[n],r=i?e.createElementNS(i,t):e.createElement(t);return i&&this.ensureNsOnRoot(n,e),r}return e.createElement(t)}subjectFor(e){let t=this.pathSubjects.get(e);return t||(t=new ie(this.getValue(e)??""),this.pathSubjects.set(e,t)),t}splitAttr(e){let t=e.lastIndexOf("/@");return t>=0?{elementPath:e.slice(0,t),attr:e.slice(t+2)}:{elementPath:e}}ensureElement(e,t,n){let i=t.split("/").filter(Boolean);if(i.length===0)return null;let r=this.parsePart(i[0]),s=e.documentElement;if(!s||s.tagName!==r.name){if(!n)return null;this.init(r.name),e=this.ensureDoc(),s=e.documentElement}let a=s,m=this.normalizePath(s.tagName);for(let f=1;f<i.length;f++){let{name:u,index:_}=this.parsePart(i[f]),y=this.nthChildOrdered(e,a,m,u,_,n);if(!y)return null;a=y,m=this.normalizePath(m+"/"+u+(_?`[${_}]`:""))}return a}parsePart(e){let t=e.match(/^([^\[]+)(?:\[(\d+)])?$/);return{name:t?.[1]??e,index:t?.[2]?parseInt(t[2],10):1}}resolveElement(e){let t=this.ensureDoc();return this.ensureElement(t,e,!1)}count(e){if(!this.doc)return 0;let t=e.split("/").filter(Boolean);if(!t.length)return 0;let n=this.doc.documentElement;if(!n||n.tagName!==t[0])return 0;for(let s=1;s<t.length-1;s++){let a=t[s].replace(/\[\d+]/,""),m=Array.from(n.children).filter(f=>f.tagName===a);if(m.length===0)return 0;n=m[0]}if(!n)return 0;let r=t[t.length-1].replace(/\[\d+]/,"");return Array.from(n.children).filter(s=>s.tagName===r).length}getText(e){return this.resolveElement(e)?.textContent?.trim()??""}validateXml(e){try{let n=new DOMParser().parseFromString(e,"application/xml").querySelector("parsererror");return n?{ok:!1,error:n.textContent||"XML inv\xE1lido"}:{ok:!0}}catch(t){return{ok:!1,error:t?.message||"XML inv\xE1lido"}}}nthChildOrdered(e,t,n,i,r,s=!0){let a=Array.from(t.children).filter(u=>u.tagName===i);if(a.length>=r)return a[r-1];if(!s)return null;let m=this.parentOrders.get(n),f=()=>{let u=this.createElementSmart(e,i),_=Array.from(t.children).filter(y=>y.tagName===i).pop();if(_)return _.nextSibling?t.insertBefore(u,_.nextSibling):t.appendChild(u),u;if(m){let y=m.indexOf(i);if(y>=0){let F=Array.from(t.children);for(let ee of F){let te=m.indexOf(ee.tagName);if(te>=0&&te>y)return t.insertBefore(u,ee),u}}}return t.appendChild(u),u};for(;Array.from(t.children).filter(u=>u.tagName===i).length<r;)f();return Array.from(t.children).filter(u=>u.tagName===i)[r-1]??null}ensurePath(e){let t=this.ensureDoc(),{attr:n,elementPath:i}=this.splitAttr(e);n||this.ensureElement(t,i,!0)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=D({token:o,factory:o.\u0275fac,providedIn:"root"})};var J=class o{choiceMap=S({});getChoice(e){return this.choiceMap()[e]}setChoice(e,t){this.choiceMap.update(n=>L(R({},n),{[e]:t}))}clearChoice(e){let i=this.choiceMap(),{[e]:t}=i,n=q(i,[j(e)]);this.choiceMap.set(n)}enumMap=S({});getEnum(e){return this.enumMap()[e]}setEnum(e,t){this.enumMap.update(n=>L(R({},n),{[e]:t}))}clearEnum(e){let i=this.enumMap(),{[e]:t}=i,n=q(i,[j(e)]);this.enumMap.set(n)}textMap=S({});getText(e){return this.textMap()[e]??""}setText(e,t){this.textMap.update(n=>L(R({},n),{[e]:t}))}clearText(e){let i=this.textMap(),{[e]:t}=i,n=q(i,[j(e)]);this.textMap.set(n)}loadFromXml(e){}toXml(){return""}static \u0275fac=function(t){return new(t||o)};static \u0275prov=D({token:o,factory:o.\u0275fac,providedIn:"root"})};function be(o,e){if(o&1&&(O(0),d(1,"div",18)(2,"div",19),h(3),l(),k(4,"app-xs-tree-node",20),l(),w()),o&2){let t=e.index,n=g(3);c(3),A("Inst\xE2ncia ",t+1),c(),p("node",n.node)("vPrefix",n.vPrefix)("disableRepeat",!0)("instanceIndex",t)}}function Ce(o,e){if(o&1&&(d(0,"div",16),x(1,be,5,5,"ng-container",17),l()),o&2){let t=g(2);c(),p("ngForOf",t.occIndexes(t.node))("ngForTrackBy",t.trackByIndex)}}function Ee(o,e){if(o&1){let t=M();O(0),d(1,"details",9)(2,"summary",10)(3,"span",11),h(4),l(),d(5,"span",12)(6,"button",13),C("click",function(){v(t);let i=g();return b(i.decOcc(i.node))}),h(7,"\u2212"),l(),d(8,"span",14),h(9),l(),d(10,"button",13),C("click",function(){v(t);let i=g();return b(i.incOcc(i.node))}),h(11,"+"),l()()(),x(12,Ce,2,2,"div",15),l(),w()}if(o&2){let t=g();c(4),E(t.node.name||t.node.kind),c(2),p("disabled",!t.canRemove(t.node)),c(3),E(t.occCount(t.node)),c(),p("disabled",!t.canAdd(t.node)),c(2),p("ngIf",t.occCount(t.node)>0)}}function ye(o,e){if(o&1&&se(0,21),o&2){g();let t=N(4);p("ngTemplateOutlet",t)}}function Oe(o,e){if(o&1&&(O(0),k(1,"app-xs-tree-node",23),w()),o&2){let t=e.$implicit,n=g(3);c(),p("node",t)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)}}function we(o,e){if(o&1&&(O(0),x(1,Oe,2,3,"ng-container",22),w()),o&2){let t=g(2);c(),p("ngForOf",t.node.children)}}function Ne(o,e){if(o&1&&(d(0,"li"),h(1),l()),o&2){let t=e.$implicit;c(),E(t)}}function Te(o,e){if(o&1&&(d(0,"div",25)(1,"ul",26),x(2,Ne,2,1,"li",22),l()()),o&2){let t=g(3);c(2),p("ngForOf",t.node.meta==null?null:t.node.meta.docs)}}function Me(o,e){if(o&1&&(d(0,"option",31),h(1),l()),o&2){let t=e.$implicit;p("value",t.id),c(),E(t.name||"op\xE7\xE3o")}}function Ie(o,e){if(o&1&&(d(0,"div",16),k(1,"app-xs-tree-node",23),l()),o&2){let t=e.ngIf,n=g(4);c(),p("node",t)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)}}function Pe(o,e){if(o&1){let t=M();O(0),d(1,"div",27)(2,"label"),h(3,"Escolha uma op\xE7\xE3o:"),l(),d(4,"select",28),C("change",function(i){v(t);let r=g(3);return b(r.onChoose(i.target.value))}),d(5,"option",29),h(6,"\u2014 selecione \u2014"),l(),x(7,Me,2,2,"option",30),l()(),x(8,Ie,2,3,"div",15),w()}if(o&2){let t=g(3);c(4),p("value",t.selectedChoiceId()),c(3),p("ngForOf",t.node.children),c(),p("ngIf",t.selectedChild())}}function Se(o,e){if(o&1&&(d(0,"option",31),h(1),l()),o&2){let t=e.$implicit,n=g(5);p("value",t.name),c(),A(" ",n.enumLabel(t)," ")}}function ke(o,e){if(o&1){let t=M();O(0),d(1,"div",32)(2,"label"),h(3,"Selecionar:"),l(),d(4,"select",28),C("change",function(i){v(t);let r=g(4);return b(r.onChooseEnum(i.target.value))}),d(5,"option",29),h(6,"\u2014 selecione \u2014"),l(),x(7,Se,2,2,"option",30),l()(),w()}if(o&2){let t=g(4);c(4),p("value",t.selectedEnum()),c(3),p("ngForOf",t.enumOptions())}}function De(o,e){if(o&1&&(d(0,"div",38),h(1),l()),o&2){let t=g(6);c(),E(t.numberHint())}}function Ve(o,e){if(o&1&&(d(0,"div",39),h(1),l()),o&2){let t=g(6);c(),E(t.numberError())}}function Xe(o,e){if(o&1){let t=M();d(0,"div",34)(1,"input",35),C("input",function(i){v(t);let r=g(5);return b(r.onNumber(i.target.value))}),l(),x(2,De,2,1,"div",36)(3,Ve,2,1,"div",37),l()}if(o&2){let t=g(5);c(),X("invalid",t.numberError()),p("value",t.numberValue())("placeholder",t.numberHint()||"n\xFAmero..."),W("min",t.minAttr())("max",t.maxAttr())("step",t.stepAttr()),c(),p("ngIf",t.numberHint()),c(),p("ngIf",t.numberError())}}function $e(o,e){if(o&1&&x(0,Xe,4,9,"div",33),o&2){g();let t=N(4),n=g(3);p("ngIf",n.isNumericInput())("ngIfElse",t)}}function Fe(o,e){if(o&1&&(d(0,"div",38),h(1),l()),o&2){let t=g(6);c(),E(t.dateHint())}}function Re(o,e){if(o&1&&(d(0,"div",39),h(1),l()),o&2){let t=g(6);c(),E(t.dateError())}}function Le(o,e){if(o&1){let t=M();d(0,"div",41)(1,"input",42),C("input",function(i){v(t);let r=g(5);return b(r.onDate(i.target.value))}),l(),x(2,Fe,2,1,"div",36)(3,Re,2,1,"div",37),l()}if(o&2){let t=g(5);c(),X("invalid",t.dateError()),p("value",t.dateValue()),W("min",t.dateMinAttr())("max",t.dateMaxAttr()),c(),p("ngIf",t.dateHint()),c(),p("ngIf",t.dateError())}}function Ae(o,e){if(o&1&&x(0,Le,4,7,"div",40),o&2){g();let t=N(6),n=g(3);p("ngIf",n.isDateHere())("ngIfElse",t)}}function je(o,e){if(o&1&&(d(0,"div",38),h(1),l()),o&2){let t=g(6);c(),E(t.hint())}}function qe(o,e){if(o&1&&(d(0,"div",39),h(1),l()),o&2){let t=g(6);c(),E(t.textError())}}function ze(o,e){if(o&1){let t=M();d(0,"div",44)(1,"input",45),C("input",function(i){v(t);let r=g(5);return b(r.onText(i.target.value))}),l(),x(2,je,2,1,"div",36)(3,qe,2,1,"div",37),l()}if(o&2){let t=g(5);c(),X("invalid",t.textError()),p("value",t.textValue())("placeholder",t.hint()||"digite..."),W("minlength",t.exactLen()??t.minLen()??null)("maxlength",t.exactLen()??t.maxLen()??null)("pattern",t.htmlPattern()),c(),p("ngIf",t.hint()),c(),p("ngIf",t.textError())}}function Be(o,e){if(o&1&&k(0,"app-xs-tree-node",23),o&2){let t=e.$implicit,n=g(7);p("node",t)("idPrefix",n.idPrefix)("vPrefix",(n.node.kind||"").toLowerCase()==="element"?n.getVisualPath():n.vPrefix)}}function We(o,e){if(o&1&&(d(0,"div",16),x(1,Be,1,3,"app-xs-tree-node",46),l()),o&2){let t=g(6);c(),p("ngForOf",t.node.children)}}function Ue(o,e){if(o&1&&x(0,We,2,1,"div",15),o&2){let t=g(5);p("ngIf",t.node.children==null?null:t.node.children.length)}}function Ke(o,e){if(o&1&&x(0,ze,4,9,"div",43)(1,Ue,1,1,"ng-template",null,7,T),o&2){let t=N(2),n=g(4);p("ngIf",n.isStringInput())("ngIfElse",t)}}function He(o,e){if(o&1&&x(0,ke,8,2,"ng-container",8)(1,$e,1,2,"ng-template",null,4,T)(3,Ae,1,2,"ng-template",null,5,T)(5,Ke,3,2,"ng-template",null,6,T),o&2){let t=N(2),n=g(3);p("ngIf",n.isEnumList())("ngIfElse",t)}}function Qe(o,e){if(o&1&&(d(0,"details",9)(1,"summary",10)(2,"span",11),h(3),l()(),x(4,Te,3,1,"div",24)(5,Pe,9,3,"ng-container",8)(6,He,7,2,"ng-template",null,3,T),l()),o&2){let t=N(7),n=g(2);c(3),E(n.node.name||n.node.kind),c(),p("ngIf",n.node.meta==null||n.node.meta.docs==null?null:n.node.meta.docs.length),c(),p("ngIf",n.isChoice())("ngIfElse",t)}}function Ye(o,e){if(o&1&&x(0,we,2,1,"ng-container",8)(1,Qe,8,4,"ng-template",null,2,T),o&2){let t=N(2),n=g();p("ngIf",n.isWrapper())("ngIfElse",t)}}var Z=class o{constructor(e,t,n){this.liveXml=e;this.destroyRef=t;this.form=n}node;vPrefix="";instanceIndex;liveBoundPath;ngOnInit(){this.bindToLiveXmlIfReady()}ngOnChanges(e){("vPrefix"in e||"instanceIndex"in e)&&this.bindToLiveXmlIfReady()}trackByIndex(e){return e}parentBasePath(){return this.vPrefix||""}setOccTo(e){let t=this.occCount(this.node);if(e!==t)if(e>t)for(let n=t;n<e;n++)this.incOcc(this.node);else for(let n=t;n>e;n--)this.decOcc(this.node)}syncOccurrencesFromXml(){if(!this.isRepeatable()||!this.node?.name)return;let e=this.parentBasePath(),t=this.liveXml.count(`${e}/${this.node.name}`),n=this.node.meta?.occurs?.min??0,i=this.node.meta?.occurs?.max,r=Math.max(t,n);typeof i=="number"&&(r=Math.min(r,i)),this.setOccTo(r)}readFormOnce(){return this.isEnumList()?this.form.getEnum(this.fieldKey())??"":this.form.getText(this.fieldKey())??""}applyToFormFromXml(e){this.isEnumList()?this.form.setEnum(this.fieldKey(),e??""):this.form.setText(this.fieldKey(),e??"")}bindToLiveXmlIfReady(){let e=this.getVisualPath();if(!e||this.liveBoundPath===e)return;this.liveBoundPath=e;let t=(this.node?.kind||"").toLowerCase()==="element",n=this.node.meta?.occurs?.min??1;if(t&&n>0&&this.liveXml.ensurePath(e),this.node?.children?.length){let r=this.node.children.filter(s=>(s.kind||"").toLowerCase()==="element").map(s=>s.name).filter(Boolean);r.length&&this.liveXml.registerOrder(e,r)}this.liveXml.observe(e).pipe(G(this.destroyRef)).subscribe(r=>{r!==this.readFormOnce()&&this.applyToFormFromXml(r)});let i=this.readFormOnce();if((i??"").trim()!==""&&this.liveXml.setValue(e,i),this.isChoice?.()&&this.node?.children?.length){let r=this.choiceBasePath();for(let s of this.node.children){if((s.kind||"").toLowerCase()!=="element"||!s.name)continue;let a=`${r}/${s.name}`;this.liveXml.observe(a).pipe(G(this.destroyRef)).subscribe(()=>{this.syncChoiceFromXml()})}this.syncChoiceFromXml()}if(this.isRepeatable()&&this.node?.name){let s=`${this.parentBasePath()}/${this.node.name}`;this.liveXml.observe(s).pipe(G(this.destroyRef)).subscribe(()=>{this.syncOccurrencesFromXml()}),this.syncOccurrencesFromXml()}}lc=e=>(e||"").toLowerCase();logUpdate(e,t,n){console.groupCollapsed("[field:update]"),console.log("path  :",e),console.log("value :",t),console.log("valid :",n),console.groupEnd()}elName(){return this.node?.name||""}fieldKey(){return this.getVisualPath()}choiceKey(){return`${this.vPrefix||""}::choice@${this.node.id}`}getVisualPath(){if(!((this.node?.kind||"").toLowerCase()==="element"))return this.vPrefix||"";let t=this.instanceIndex!=null?`[${this.instanceIndex+1}]`:"";return(this.vPrefix?this.vPrefix+"/":"")+this.elName()+t}isRequiredElement(){return(this.node.meta?.occurs?.min??0)>=1}childrenOfKind(e,t){return(e.children||[]).filter(n=>this.lc(n.kind)===this.lc(t))}firstChildOfKind(e,t){return(e.children||[]).find(n=>this.lc(n.kind)===this.lc(t))}isWrapper(e=this.node){let t=this.lc(e.kind),n=e.name||"";return!!(["schema","complextype","sequence","simpletype","restriction","all","group","pattern","length","minlength","maxlength","mininclusive","maxinclusive","minexclusive","maxexclusive","totaldigits","fractiondigits"].includes(t)||/^(TS_|T_)/i.test(n))}chain(e=this.node,t=8){let n=[],i=e,r=0;for(;i&&r++<t;){n.push(i);let s=this.firstChildOfKind(i,"simpletype");if(s){i=s;continue}let a=this.firstChildOfKind(i,"restriction");if(a){i=a;continue}break}return n}effectiveBase(){let e="";for(let t of this.chain()){let n=t.meta||{};n.base?e=String(n.base):n.typeName&&(e=String(n.typeName))}return this.lc(e)}effectiveStringFacets(){let e,t,n,i=[],r=s=>{if(!s)return;let a=s.replace(/^\^/,"").replace(/\$$/,"").trim();a&&!i.includes(a)&&i.push(a)};for(let s of this.chain()){let a=s.meta?.stringFacets;a&&(a.length!=null&&(e=a.length),a.minLength!=null&&(t=a.minLength),a.maxLength!=null&&(n=a.maxLength),(a.patterns||[]).forEach(r)),this.childrenOfKind(s,"pattern").forEach(m=>r(m.name))}return{length:e,minLength:t,maxLength:n,patterns:i}}effectiveNumericFacets(){let e={minInclusive:void 0,maxInclusive:void 0,minExclusive:void 0,maxExclusive:void 0,totalDigits:void 0,fractionDigits:void 0};for(let t of this.chain()){let n=t.meta?.numericFacets;n&&(n.minInclusive!=null&&(e.minInclusive=n.minInclusive),n.maxInclusive!=null&&(e.maxInclusive=n.maxInclusive),n.minExclusive!=null&&(e.minExclusive=n.minExclusive),n.maxExclusive!=null&&(e.maxExclusive=n.maxExclusive),n.totalDigits!=null&&(e.totalDigits=n.totalDigits),n.fractionDigits!=null&&(e.fractionDigits=n.fractionDigits))}return e}isRequiredNode(e=this.node){let t=(e.meta?.use||"").toString().toLowerCase(),n=e.meta?.occurs?.min;return t==="required"||typeof n=="number"&&n>0}choiceBasePath(){return this.vPrefix||""}syncChoiceFromXml(){if(!this.isChoice?.()||!this.node?.children?.length)return;let e=this.choiceBasePath(),t=this.keyFor(this.node.id);for(let i of this.node.children){if((i.kind||"").toLowerCase()!=="element"||!i.name)continue;let r=`${e}/${i.name}`;if(this.liveXml.getValue(r)!==null){this.form.setChoice(this.choiceKey(),i.id);return}}this.form.setChoice(t,"");let n=`${e}/${this.node.name}`;setTimeout(()=>this.liveXml.reemit(n),0)}idPrefix="";disableRepeat=!1;keyFor(e){return(this.idPrefix?this.idPrefix:"")+e}occ=new Map;occursMeta(e){return e.meta?.occurs??{min:0,max:1}}initOcc(e){if(!this.occ.has(e.id)){let{min:t}=this.occursMeta(e);this.occ.set(e.id,Math.max(0,Number(t||0)))}}occCount(e){return this.initOcc(e),this.occ.get(e.id)}occIndexes(e){return Array.from({length:this.occCount(e)},(t,n)=>n)}canAdd(e){let{max:t}=this.occursMeta(e),n=this.occCount(e);return t==="unbounded"||n<(t??1)}canRemove(e){let{min:t}=this.occursMeta(e);return this.occCount(e)>(t??0)}incOcc(e){this.canAdd(e)&&this.occ.set(e.id,this.occCount(e)+1)}decOcc(e){this.canRemove(e)&&this.occ.set(e.id,this.occCount(e)-1)}isRepeatable(){if(this.disableRepeat)return!1;let e=this.node.meta?.occurs;return e?e.max==="unbounded"?!0:typeof e.max=="number"&&e.max>1:!1}isChoice(){return this.lc(this.node.kind)==="choice"}selectedChoiceId=I(()=>this.form.getChoice(this.keyFor(this.node.id))??"");onChoose(e){this.form.setChoice(this.keyFor(this.node.id),e),this.logUpdate(this.getVisualPath()+" [choice]",e,!!e)}selectedChild=I(()=>{let e=this.selectedChoiceId();if(!e){if(this.isChoice()&&this.node.children?.length===1){let t=this.node.children[0];return this.form.setChoice(this.node.id,t.id),t}return null}return(this.node.children||[]).find(t=>t.id===e)||null});collectEnumOptionsDeep(e,t=0){if(t>3)return[];let n=[];for(let m of this.childrenOfKind(e,"enumeration"))n.push(...m.children?.length?m.children:[m]);let i=this.firstChildOfKind(e,"restriction");if(i)for(let m of this.childrenOfKind(i,"enumeration"))n.push(...m.children?.length?m.children:[m]);let r=this.firstChildOfKind(e,"simpletype");r&&n.push(...this.collectEnumOptionsDeep(r,t+1));for(let m of e.children||[])if(this.lc(m.kind)!=="enumeration"&&m.children?.length)for(let f of this.childrenOfKind(m,"enumeration"))n.push(...f.children?.length?f.children:[f]);let s=e.meta?.numericFacets?.enums;if(s?.length)for(let m of s)n.push({id:`${e.id}#enum:${m}`,name:String(m),kind:"enumeration",children:[],source:e.source,meta:{docs:[]}});let a={};return n.filter(m=>{let f=m.name??"";return a[f]?!1:(a[f]=!0,!0)})}enumOptions=I(()=>this.collectEnumOptionsDeep(this.node));isEnumList(){return this.enumOptions().length>0}selectedEnum=I(()=>this.form.getEnum(this.fieldKey())??"");onChooseEnum(e){let t=(e??"").trim();this.form.setEnum(this.fieldKey(),t);let n=this.isRequiredNode(),i=this.enumOptions().map(a=>a.name),r=(t!==""||!n)&&(t===""||i.includes(t)),s=this.getVisualPath();this.liveXml.setValue(s,t),this.logUpdate(s,t,r)}enumLabel(e){let t=e.name||"",n=e.meta?.docs&&e.meta.docs[0]?String(e.meta.docs[0]).trim():"";return n?`${t} - ${n}`:t}enumError(e){let t=this.enumOptions().map(n=>n.name);return e?t.length&&!t.includes(e)?"Valor n\xE3o \xE9 uma op\xE7\xE3o v\xE1lida":"":this.isRequiredElement()?"Obrigat\xF3rio":""}isStringInput(){if(this.isEnumList()||this.isNumericInput())return!1;let e=this.effectiveBase(),t=this.lc(this.node.kind);return(t==="element"||t==="simpletype")&&e.includes("string")}textValue=I(()=>this.form.getText(this.fieldKey()));onText(e){let t=(e??"").trim();this.form.setText(this.fieldKey(),t);let n=this.textError()==="",i=this.getVisualPath();this.liveXml.setValue(i,t),this.logUpdate(i,t,n)}exactLen(){return this.effectiveStringFacets().length}minLen(){return this.effectiveStringFacets().minLength}maxLen(){return this.effectiveStringFacets().maxLength}collectAllPatternsDeep(e=this.node){let t=[],n=i=>{let r=this.normalizePattern(i);r&&!t.includes(r)&&t.push(r)};for(let i of this.chain(e))i.meta?.stringFacets?.patterns?.forEach(n),this.childrenOfKind(i,"pattern").forEach(r=>n(r.name));return t}patterns(){return this.collectAllPatternsDeep()}htmlPattern(){let e=this.patterns();return e.length?e.length===1?e[0]:`(?:${e.join(")|(?:")})`:null}compileAnchoredRegex(e){let t=this.normalizePattern(e);if(!t)return null;try{return new RegExp(`^(?:${t})$`)}catch{return null}}textError=I(()=>{let e=(this.textValue()??"").trim();if(e==="")return"Obrigat\xF3rio";for(let s of this.patterns()){let a=this.compileAnchoredRegex(s);if(a&&!a.test(e))return`Valor n\xE3o atende ao padr\xE3o: ${s}`}let t=e.length,n=this.exactLen();if(n!=null&&t!==n)return`Deve ter exatamente ${n} caracteres.`;let i=this.minLen();if(i!=null&&t<i)return`M\xEDnimo de ${i} caracteres.`;let r=this.maxLen();return r!=null&&t>r?`M\xE1ximo de ${r} caracteres.`:""});hint(){let e=[],t=this.patterns();t.length&&e.push(`pattern: ${t[0]}`);let n=this.exactLen(),i=this.minLen(),r=this.maxLen();return n!=null?e.push(`tamanho: ${n}`):(i!=null&&e.push(`m\xEDn: ${i}`),r!=null&&e.push(`m\xE1x: ${r}`)),e.join(" \xB7 ")}numericBases=["byte","short","int","integer","long","decimal","float","double","nonnegativeinteger","positiveinteger","nonpositiveinteger","negativeinteger","unsignedbyte","unsignedshort","unsignedint","unsignedlong"];isNumericInput(){if(this.isEnumList())return!1;let e=this.effectiveBase(),t=this.lc(this.node.kind);return(t==="element"||t==="simpletype")&&this.numericBases.some(n=>e.endsWith(n))}numberValue=I(()=>this.form.getText(this.fieldKey()));onNumber(e){let t=(e??"").trim();this.form.setText(this.fieldKey(),t);let n=this.numberError()==="",i=this.getVisualPath();this.liveXml.setValue(i,t),this.logUpdate(i,t,n)}numericPatterns(){return this.collectAllPatternsDeep()}numericHtmlPattern(){let e=this.numericPatterns();return e.length?e.length===1?e[0]:`(?:${e.join(")|(?:")})`:null}minAttr(){let e=this.effectiveNumericFacets();return e.minInclusive!=null?e.minInclusive:e.minExclusive!=null?e.minExclusive+1:null}maxAttr(){let e=this.effectiveNumericFacets();return e.maxInclusive!=null?e.maxInclusive:e.maxExclusive!=null?e.maxExclusive-1:null}stepAttr(){let e=this.effectiveNumericFacets();return e.fractionDigits!=null&&e.fractionDigits>0?"0."+"0".repeat(e.fractionDigits-1)+"1":"1"}numberError=I(()=>{let e=(this.numberValue()??"").trim();if(e==="")return"Obrigat\xF3rio";for(let a of this.numericPatterns()){let m=this.compileAnchoredRegex(a);if(m&&!m.test(e))return`Valor n\xE3o atende ao padr\xE3o: ${a}`}if(!/^-?\d+(\.\d+)?$/.test(e))return"N\xFAmero inv\xE1lido";let n=this.effectiveNumericFacets(),i=Number(e),r=this.effectiveBase();return!r.includes("decimal")&&!r.includes("float")&&!r.includes("double")&&!/^[-]?\d+$/.test(e)?"Deve ser inteiro":n.fractionDigits!=null&&(e.split(".")[1]||"").length>n.fractionDigits?`M\xE1ximo de ${n.fractionDigits} casas decimais`:n.totalDigits!=null&&e.replace(/^-/,"").replace(".","").length>n.totalDigits?`M\xE1ximo de ${n.totalDigits} d\xEDgitos`:n.minInclusive!=null&&!(i>=n.minInclusive)?`M\xEDnimo: ${n.minInclusive}`:n.minExclusive!=null&&!(i>n.minExclusive)?`Deve ser > ${n.minExclusive}`:n.maxInclusive!=null&&!(i<=n.maxInclusive)?`M\xE1ximo: ${n.maxInclusive}`:n.maxExclusive!=null&&!(i<n.maxExclusive)?`Deve ser < ${n.maxExclusive}`:""});numberHint(){let e=[],t=this.numericPatterns();t.length&&e.push(`pattern: ${t[0]}`);let n=this.effectiveNumericFacets();return n.minInclusive!=null&&e.push(`m\xEDn: ${n.minInclusive}`),n.maxInclusive!=null&&e.push(`m\xE1x: ${n.maxInclusive}`),n.minExclusive!=null&&e.push(`> ${n.minExclusive}`),n.maxExclusive!=null&&e.push(`< ${n.maxExclusive}`),n.totalDigits!=null&&e.push(`d\xEDgitos: ${n.totalDigits}`),n.fractionDigits!=null&&e.push(`decimais: ${n.fractionDigits}`),e.join(" \xB7 ")}normalizePattern(e){if(!e)return null;let t=String(e).trim();return t=t.replace(/^pattern\s*:\s*/i,"").replace(/^regex\s*:\s*/i,"").trim(),(t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))&&(t=t.slice(1,-1).trim()),t.startsWith("^")&&(t=t.slice(1)),t.endsWith("$")&&(t=t.slice(0,-1)),t=t.replace(/\\\\/g,"\\"),!t||t===".*"||t===".+"?null:t}qnToToken(e){return e?String(e).toLowerCase().trim().replace(/^\{[^}]+\}/,"").replace(/^[a-z_][\w.-]*:/,"").trim():""}isDateHere(){let e=(this.node.kind||"").toLowerCase();return e==="element"||e==="simpletype"?(this.qnToToken(this.node.meta?.base)||this.qnToToken(this.node.meta?.typeName))==="date":!1}dateValue(){return this.textValue()}onDate(e){let t=(e??"").trim();this.form.setText(this.fieldKey(),t);let n=this.dateError()==="",i=this.getVisualPath();this.liveXml.setValue(i,t),this.logUpdate(i,t,n)}dateFacetsHere(){return this.node.meta?.dateFacets??{}}addDays(e,t){let n=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e||"");if(!n)return null;let i=new Date(Date.UTC(+n[1],+n[2]-1,+n[3]+t)),r=String(i.getUTCMonth()+1).padStart(2,"0"),s=String(i.getUTCDate()).padStart(2,"0");return`${i.getUTCFullYear()}-${r}-${s}`}dateMinAttr(){let e=this.dateFacetsHere();return e.minInclusive??(e.minExclusive?this.addDays(e.minExclusive,1):null)}dateMaxAttr(){let e=this.dateFacetsHere();return e.maxInclusive??(e.maxExclusive?this.addDays(e.maxExclusive,-1):null)}dateHint(){let e=this.dateFacetsHere(),t=[];return e.minInclusive&&t.push(`m\xEDn: ${e.minInclusive}`),e.minExclusive&&t.push(`> ${e.minExclusive}`),e.maxInclusive&&t.push(`m\xE1x: ${e.maxInclusive}`),e.maxExclusive&&t.push(`< ${e.maxExclusive}`),t.join(" \xB7 ")}dateError(){let e=(this.dateValue()||"").trim();if(!e)return"Obrigat\xF3rio";if(!/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/.test(e))return"Formato inv\xE1lido (AAAA-MM-DD)";let t=new Date(e),[n,i,r]=e.split("-").map(Number);if(isNaN(+t)||t.getUTCFullYear()!==n||t.getUTCMonth()+1!==i||t.getUTCDate()!==r)return"Data inexistente";let s=this.dateFacetsHere();return s.minInclusive&&!(e>=s.minInclusive)?`M\xEDnimo: ${s.minInclusive}`:s.minExclusive&&!(e>s.minExclusive)?`Deve ser > ${s.minExclusive}`:s.maxInclusive&&!(e<=s.maxInclusive)?`M\xE1ximo: ${s.maxInclusive}`:s.maxExclusive&&!(e<s.maxExclusive)?`Deve ser < ${s.maxExclusive}`:""}static \u0275fac=function(t){return new(t||o)(V($),V(z),V(J))};static \u0275cmp=B({type:o,selectors:[["app-xs-tree-node"]],inputs:{node:"node",vPrefix:"vPrefix",instanceIndex:"instanceIndex",idPrefix:"idPrefix",disableRepeat:"disableRepeat"},features:[oe],decls:5,vars:2,consts:[["notRepeatable",""],["renderSelf",""],["normalBox",""],["notChoice",""],["maybeNumber",""],["maybeDate",""],["maybeString",""],["regularChildren",""],[4,"ngIf","ngIfElse"],["open","",1,"node"],[1,"sum"],[1,"name"],[1,"occ-ctrl"],["type","button",1,"btn",3,"click","disabled"],[1,"occ"],["class","children",4,"ngIf"],[1,"children"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"instance"],[1,"inst-header"],[3,"node","vPrefix","disableRepeat","instanceIndex"],[3,"ngTemplateOutlet"],[4,"ngFor","ngForOf"],[3,"node","idPrefix","vPrefix"],["class","docbox",4,"ngIf"],[1,"docbox"],[1,"docbox-list"],[1,"choice-picker"],[3,"change","value"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"enum-picker"],["class","number-input",4,"ngIf","ngIfElse"],[1,"number-input"],["type","number","inputmode","decimal",1,"text",3,"input","value","placeholder"],["class","hint",4,"ngIf"],["class","error",4,"ngIf"],[1,"hint"],[1,"error"],["class","date-input",4,"ngIf","ngIfElse"],[1,"date-input"],["type","date","placeholder","AAAA-MM-DD",1,"text",3,"input","value"],["class","string-input",4,"ngIf","ngIfElse"],[1,"string-input"],["type","text",1,"text",3,"input","value","placeholder"],[3,"node","idPrefix","vPrefix",4,"ngFor","ngForOf"]],template:function(t,n){if(t&1&&x(0,Ee,13,5,"ng-container",8)(1,ye,1,1,"ng-template",null,0,T)(3,Ye,3,2,"ng-template",null,1,T),t&2){let i=N(2);p("ngIf",n.isRepeatable())("ngIfElse",i)}},dependencies:[o,H,U,K,me],styles:[".node[_ngcontent-%COMP%]{border:1px solid #d7d7db;border-radius:12px;padding:8px 12px;background:#fff}[_nghost-%COMP%]{display:block;margin-top:12px}.sum[_ngcontent-%COMP%]{cursor:pointer;font-weight:600}.children[_ngcontent-%COMP%]{display:grid;grid-auto-rows:auto;gap:12px;margin-top:8px}details.node[_ngcontent-%COMP%] + details.node[_ngcontent-%COMP%]{margin-top:12px}.docbox[_ngcontent-%COMP%]{margin-top:10px;padding:10px 12px;border:1px solid #e5e7eb;background:#fafafa;border-radius:10px}.docbox-list[_ngcontent-%COMP%]{margin:0;padding-left:18px;white-space:pre-wrap;font-size:13px}.choice-picker[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:10px}.choice-picker[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;border-radius:8px;border:1px solid #c8c8cc;background:#fff}.string-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-top:10px}.text[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #c8c8cc;border-radius:8px}.text.invalid[_ngcontent-%COMP%]{border-color:#e11d48;background:#fff1f2}.hint[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.error[_ngcontent-%COMP%]{font-size:12px;color:#e11d48}.number-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;margin-top:10px}.occ-ctrl[_ngcontent-%COMP%]{display:inline-flex;gap:8px;margin-left:10px;align-items:center}.occ-ctrl[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:0 8px;border:1px solid #e5e7eb;border-radius:6px;background:#f8fafc;cursor:pointer}.occ-ctrl[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.occ-ctrl[_ngcontent-%COMP%]   .occ[_ngcontent-%COMP%]{min-width:22px;text-align:center;font-weight:600}.instance[_ngcontent-%COMP%]{border:1px dashed #e5e7eb;border-radius:10px;padding:10px}.inst-header[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin:6px 0 10px}[_nghost-%COMP%], .page[_ngcontent-%COMP%], .content[_ngcontent-%COMP%], .node[_ngcontent-%COMP%], .children[_ngcontent-%COMP%]{max-width:100%;overflow-x:hidden}.docbox[_ngcontent-%COMP%], .docbox-list[_ngcontent-%COMP%], .docbox-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], details.node[_ngcontent-%COMP%], summary.sum[_ngcontent-%COMP%], .enum-picker[_ngcontent-%COMP%], .string-input[_ngcontent-%COMP%], .number-input[_ngcontent-%COMP%], .date-input[_ngcontent-%COMP%]{white-space:normal;overflow-wrap:anywhere;word-break:break-word}*[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}details.node[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}"]})};var Ge=["xmlDlg"];function Je(o,e){if(o&1&&(d(0,"div",19),k(1,"app-xs-tree-node",20),l()),o&2){let t=e.ngIf;c(),p("node",t)}}function Ze(o,e){o&1&&(d(0,"div",21),h(1," N\xE3o foi poss\xEDvel construir a \xE1rvore do evento. Verifique se o "),d(2,"b"),h(3,"tipos.xsd"),l(),h(4," est\xE1 presente. "),l())}function et(o,e){o&1&&(O(0),h(1,"XML malformado"),w())}function tt(o,e){if(o&1&&(O(0),h(1),w()),o&2){let t=g();c(),A("Incompleto: ",t.missingRequired.length," obrigat\xF3rio(s)")}}function nt(o,e){o&1&&(O(0),h(1,"V\xE1lido"),w())}function it(o,e){if(o&1&&(d(0,"li"),h(1),l()),o&2){let t=e.$implicit;c(),E(t)}}function rt(o,e){if(o&1&&(d(0,"div",22)(1,"div",23),h(2,"Campos obrigat\xF3rios ausentes:"),l(),d(3,"ul"),x(4,it,2,1,"li",24),l()()),o&2){let t=g();c(4),p("ngForOf",t.missingRequired)}}var he=class o{constructor(e){this.liveXml=e;let t=decodeURIComponent(this.route.snapshot.paramMap.get("fileName")||""),{code:n,title:i,root:r}=this.adapter.buildViewTreeFromLatest(t),s=new RegExp(`^\\s*${n}\\b`,"i").test(i);this.headerTitle.set(s?i:`${n} - ${i}`),this.root.set(r),this.eventName=t.replace(".xsd",""),console.groupCollapsed("[VIEW TREE]",t),console.log({meta:{code:n,title:i,fileName:t},root:r}),console.groupEnd(),window.__viewTree=r}route=P(de);adapter=P(Q);eventName="";xmlDlg;xmlText="";xmlOk=!0;requiredOk=!0;xmlErr="";missingRequired=[];headerTitle=S("\u2014");root=S(null);ngOnInit(){this.bootstrapLiveXml()}bootstrapLiveXml(){this.liveXml.init("eSocial");let e=`eSocial/${this.eventName}`;this.liveXml.ensurePath(e);let t=this.generateEventId(),n=`${e}/@Id`;this.liveXml.setValue(n,t),console.log("[liveXML] set Id em",n,"=>",this.liveXml.getValue(n))}generateEventId(e){let t=(s,a)=>s.toString().padStart(a,"0"),n=new Date,i=`${n.getFullYear()}${t(n.getMonth()+1,2)}${t(n.getDate(),2)}${t(n.getHours(),2)}${t(n.getMinutes(),2)}${t(n.getSeconds(),2)}`,r=Math.floor(Math.random()*1e7).toString().padStart(7,"0");return`ID${e??"00000000000000"}${i}${r}`}expandAll(){document.querySelectorAll("details.node, details.docs").forEach(e=>e.setAttribute("open",""))}collapseAll(){document.querySelectorAll("details.node, details.docs").forEach(e=>e.removeAttribute("open"))}onGerarXmlConsole(){let e=this.liveXml.serialize(!0);console.log(`[LiveXML] XML gerado:
`+e)}openXmlModal(){this.xmlText=this.liveXml.serialize(!0),this.revalidateXmlAndRequired(),this.xmlDlg.nativeElement.showModal()}closeXmlModal(){this.xmlDlg.nativeElement.close()}onXmlInput(e){this.xmlText=e.target.value??"",this.revalidateXmlAndRequired()}updateXmlValidity(){let e=this.liveXml.validateXml(this.xmlText);this.xmlOk=e.ok,this.xmlErr=e.error||""}revalidateXmlAndRequired(){let e=this.liveXml.validateXml(this.xmlText);if(this.xmlOk=e.ok,this.xmlErr=e.error||"",this.xmlOk){let t=new DOMParser().parseFromString(this.xmlText,"application/xml");this.missingRequired=this.collectMissingRequiredFromDoc(t),this.requiredOk=this.missingRequired.length===0}else this.missingRequired=[],this.requiredOk=!1}applyXmlToForm(){this.xmlOk&&this.liveXml.import(this.xmlText)}downloadXml(){let e=new Blob([this.xmlText],{type:"application/xml;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="evento.xml",n.click(),URL.revokeObjectURL(t)}saveXmlLocal(){localStorage.setItem("esocial.liveXml.draft",this.xmlText)}loadXmlLocal(){let e=localStorage.getItem("esocial.liveXml.draft");e!=null&&(this.xmlText=e,this.updateXmlValidity())}collectMissingRequiredFromDoc(e){let t=[],n=this.root?.();if(!n)return t;let i=(r,s)=>{let a=(r.kind||"").toLowerCase(),m=r.name||"";if(this.isIgnoredName(m))return;let f=a==="element"?s?`${s}/${m}`:m:s;if(a==="choice"&&(r.meta?.occurs?.min??1)>0&&((r.children??[]).some(y=>{if((y.kind||"").toLowerCase()!=="element")return!1;let F=`${f}/${y.name}`;return this.countInDoc(e,F)>0})||t.push(`${f} [escolha um]`)),a==="element"&&r.children?.length){(r.meta?.occurs?.min??1)>0&&this.countInDoc(e,f)<1&&t.push(f);for(let _ of r.children)i(_,f)}if(a==="element"&&(!r.children||r.children.length===0)&&(r.meta?.occurs?.min??1)>0&&(this.textInDoc(e,f)||t.push(f)),(a==="sequence"||a==="complextype"||a==="schema"||a==="simpletype"||a==="group")&&r.children)for(let u of r.children)i(u,f)};return i(n,""),t.map(r=>r.startsWith("eSocial")?r:`eSocial/${r}`)}isIgnoredName(e){return e?/^ds:/i.test(e):!1}textInDoc(e,t){let n=t.split("/").filter(Boolean),i=e.documentElement;if(!i||i.tagName!==n[0])return null;for(let s=1;s<n.length;s++){let a=n[s].replace(/\[\d+]/,""),f=Array.from(i.children).filter(u=>u.tagName===a);if(f.length===0||(i=f[0]??null,!i))return null}let r=(i.textContent??"").trim();return r.length?r:null}countInDoc(e,t){let n=t.split("/").filter(Boolean),i=e.documentElement;if(!i||i.tagName!==n[0])return 0;for(let r=1;r<n.length;r++){let s=n[r].match(/^(.+?)(?:\[(\d+)])?$/),a=s?.[1]??n[r],m=s?.[2]?parseInt(s[2],10):void 0,u=Array.from(i.children).filter(_=>_.tagName===a);if(m!=null){if(m<1||m>u.length||(i=u[m-1]??null,!i))return 0}else{if(r===n.length-1)return u.length;if(i=u[0]??null,!i)return 0}}return i?1:0}static \u0275fac=function(t){return new(t||o)(V($))};static \u0275cmp=B({type:o,selectors:[["app-novo-evento-winzard"]],viewQuery:function(t,n){if(t&1&&ae(Ge,5),t&2){let i;le(i=ce())&&(n.xmlDlg=i.first)}},decls:39,vars:13,consts:[["missing",""],["xmlDlg",""],[1,"actions"],["routerLink","/gestao",1,"button"],["type","button",3,"click"],["type","button",1,"btn",3,"click"],[1,"title"],["class","root",4,"ngIf","ngIfElse"],[1,"xml-dlg"],["method","dialog",1,"xml-dlg-body",3,"submit"],[1,"xml-dlg-header"],[1,"status"],[4,"ngIf"],[1,"xml-scroll"],["spellcheck","false",1,"xml-text",3,"input","value"],["class","xml-issues",4,"ngIf"],[1,"xml-dlg-footer"],[1,"spacer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"root"],[3,"node"],[1,"placeholder"],[1,"xml-issues"],[1,"issues-title"],[4,"ngFor","ngForOf"]],template:function(t,n){if(t&1){let i=M();d(0,"div",2)(1,"button",3),h(2,"\u2190 Voltar"),l(),d(3,"button",4),C("click",function(){return v(i),b(n.expandAll())}),h(4,"Expandir tudo"),l(),d(5,"button",4),C("click",function(){return v(i),b(n.collapseAll())}),h(6,"Recolher tudo"),l(),d(7,"button",5),C("click",function(){return v(i),b(n.openXmlModal())}),h(8,"XML / Preview"),l()(),d(9,"h2",6),h(10),l(),x(11,Je,2,1,"div",7)(12,Ze,5,0,"ng-template",null,0,T),d(14,"dialog",8,1)(16,"form",9),C("submit",function(s){return v(i),b(s.preventDefault())}),d(17,"header",10)(18,"strong"),h(19,"Editor de XML"),l(),d(20,"span",11),x(21,et,2,0,"ng-container",12)(22,tt,2,1,"ng-container",12)(23,nt,2,0,"ng-container",12),l()(),d(24,"div",13)(25,"textarea",14),C("input",function(s){return v(i),b(n.onXmlInput(s))}),l(),x(26,rt,5,1,"div",15),l(),d(27,"footer",16)(28,"button",5),C("click",function(){return v(i),b(n.loadXmlLocal())}),h(29,"Carregar rascunho"),l(),d(30,"button",5),C("click",function(){return v(i),b(n.saveXmlLocal())}),h(31,"Salvar rascunho"),l(),k(32,"span",17),d(33,"button",5),C("click",function(){return v(i),b(n.downloadXml())}),h(34,"Baixar .xml"),l(),d(35,"button",18),C("click",function(){return v(i),b(n.applyXmlToForm())}),h(36," Aplicar no formul\xE1rio "),l(),d(37,"button",5),C("click",function(){return v(i),b(n.closeXmlModal())}),h(38,"Fechar"),l()()()()}if(t&2){let i=N(13);c(10),E(n.headerTitle()),c(),p("ngIf",n.root())("ngIfElse",i),c(9),X("ok",n.xmlOk&&n.requiredOk)("err",!(n.xmlOk&&n.requiredOk)),c(),p("ngIf",!n.xmlOk),c(),p("ngIf",n.xmlOk&&!n.requiredOk),c(),p("ngIf",n.xmlOk&&n.requiredOk),c(2),p("value",n.xmlText),c(),p("ngIf",n.xmlOk&&!n.requiredOk),c(9),p("disabled",!(n.xmlOk&&n.requiredOk))}},dependencies:[H,U,K,ue,Z],styles:[".back[_ngcontent-%COMP%]{margin-bottom:10px;padding:6px 10px;border-radius:8px;border:1px solid #c8c8cc;background:#f5f5f7}.title[_ngcontent-%COMP%]{margin:0 0 10px}.actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:10px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;border:1px solid #c8c8cc;background:#f5f5f7;cursor:pointer}.root[_ngcontent-%COMP%]{display:grid;gap:10px}.placeholder[_ngcontent-%COMP%]{opacity:.85;border:1px dashed #c8c8cc;border-radius:12px;padding:14px;background:#fff}dialog.xml-dlg[_ngcontent-%COMP%]{width:min(1100px,96vw);max-height:90vh;padding:0;border:none;border-radius:12px;overflow:hidden;box-shadow:0 20px 50px #00000059}.xml-dlg-body[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto 1fr auto;height:min(80vh,calc(100vh - 4rem))}.xml-dlg-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fff}.xml-dlg-header[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:auto;font-size:.9rem}.xml-dlg-header[_ngcontent-%COMP%]   .status.ok[_ngcontent-%COMP%]{color:#059669}.xml-dlg-header[_ngcontent-%COMP%]   .status.err[_ngcontent-%COMP%]{color:#dc2626}.xml-scroll[_ngcontent-%COMP%]{overflow:auto;background:#0b1020;height:100%}.xml-text[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border:0;outline:0;resize:none;box-sizing:border-box;padding:12px 16px;color:#e6edf3;background:#0b1020;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:13px;line-height:1.45}.xml-issues[_ngcontent-%COMP%]{padding:10px 16px;color:#eab308;background:#0f172a;border-top:1px solid #1f2937}.xml-issues[_ngcontent-%COMP%]   .issues-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.xml-dlg-footer[_ngcontent-%COMP%]{position:sticky;bottom:0;background:#fff;display:flex;align-items:center;gap:8px;padding:12px 16px;border-top:1px solid #e5e7eb}.btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{background:#f9fafb}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border-color:#2563eb}.btn-primary[_ngcontent-%COMP%]:hover{background:#1d4ed8}"]})};export{he as NovoEventoWinzardComponent};
