import{a as H,b as J,c as be,d as ce}from"./chunk-MI4H3XG5.js";import{a as ve}from"./chunk-KBWQJKVL.js";import{$ as U,C as a,Da as ee,E as L,Ea as te,F as z,Ia as ne,J as C,K as ae,Ka as _e,Ma as xe,P as d,Q as c,Qa as he,R as s,S as W,T as A,U as j,V as X,W as R,Y as M,Z as me,_ as E,a as I,aa as m,b as D,ba as ue,ca as pe,ga as K,ha as Y,ia as fe,ja as p,k as de,ka as O,la as V,ma as se,q as B,ra as ge,u as N,v as w,wa as Z}from"./chunk-OT5C62IN.js";var G=class i{removed=new Set;key(t,e){return`${t}|${e}`}removeEnum(t,e){this.removed.add(this.key(t,e))}undoEnum(t,e){this.removed.delete(this.key(t,e))}isEnumRemoved(t,e){return this.removed.has(this.key(t,e))}snapshot(){return Array.from(this.removed.values())}clear(){this.removed.clear()}occurs=new Map;setOccurs(t,e,n){this.occurs.set(t,{min:e,max:n})}getOccursMin(t){return this.occurs.get(t)?.min}getOccursMax(t){return this.occurs.get(t)?.max}snapshotOccurs(){return Array.from(this.occurs.entries())}clearOccurs(){this.occurs.clear()}stringEdits=new Map;setStringFacets(t,e){this.stringEdits.set(t,I({},e))}getStringFacets(t){return this.stringEdits.get(t)}snapshotStringFacets(){return Array.from(this.stringEdits.entries())}clearStringFacets(){this.stringEdits.clear()}numericEdits=new Map;setNumericFacets(t,e){this.numericEdits.set(t,I({},e))}getNumericFacets(t){return this.numericEdits.get(t)}snapshotNumericFacets(){return Array.from(this.numericEdits.entries())}clearNumericFacets(){this.numericEdits.clear()}dateEdits=new Map;setDateFacets(t,e){this.dateEdits.set(t,I({},e))}getDateFacets(t){return this.dateEdits.get(t)}snapshotDateFacets(){return Array.from(this.dateEdits.entries())}clearDateFacets(){this.dateEdits.clear()}static \u0275fac=function(e){return new(e||i)};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};var q=class i{_open=new Set;open$=new de(this._open);isOpen(t){return this._open.has(t)}toggle(t){this.isOpen(t)?this._open.delete(t):this._open.add(t),this.open$.next(new Set(this._open))}open(t){this.isOpen(t)||(this._open.add(t),this.open$.next(new Set(this._open)))}close(t){this.isOpen(t)&&(this._open.delete(t),this.open$.next(new Set(this._open)))}closeAll(){this._open.clear(),this.open$.next(new Set(this._open))}openAllFrom(t){let e=[t];for(;e.length;){let n=e.pop();this._open.add(n.id),n.children?.forEach(r=>e.push(r))}this.open$.next(new Set(this._open))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ce=()=>[];function Ie(i,t){if(i&1&&(c(0,"span",11),p(1),s()),i&2){let e=m();a(),V("type: ",e.typeName)}}function Me(i,t){if(i&1&&(c(0,"span",12),p(1),s()),i&2){let e=m();a(),V("base: ",e.base)}}function Te(i,t){if(i&1&&(c(0,"span",12),p(1),s()),i&2){let e=m();a(),V("use: ",e.use)}}function Fe(i,t){if(i&1&&(c(0,"div",22),p(1),s()),i&2){let e=t.$implicit;a(),O(e)}}function De(i,t){if(i&1&&(X(0),c(1,"div",20),C(2,Fe,2,1,"div",21),s(),R()),i&2){let e=t.ngIf,n=m(2);a(2),d("ngForOf",e)("ngForTrackBy",n.trackStr)}}function ke(i,t){if(i&1){let e=M();c(0,"div",26)(1,"label"),p(2,"M\xEDnimo"),s(),c(3,"input",30),E("input",function(r){N(e);let o=m(3);return w(o.setOccMin(r.target.valueAsNumber))}),s()()}if(i&2){let e=m(3);a(3),d("max",e.occMax==="unbounded"?null:e.occMax)("value",e.occMin)}}function Oe(i,t){if(i&1){let e=M();X(0),c(1,"input",31),E("input",function(r){N(e);let o=m(3);return w(o.setOccMax(r.target.valueAsNumber))}),s(),R()}if(i&2){let e=m(3);a(),d("value",e.occMax)}}function Le(i,t){if(i&1){let e=M();c(0,"input",32),E("input",function(r){N(e);let o=m(3);return w(o.setOccMax(r.target.valueAsNumber))}),s()}i&2&&d("value",50)}function Ve(i,t){if(i&1&&(c(0,"span"),p(1),s()),i&2){let e=m(3);a(),se("\u2192 Novo: ",e.occMin,"..",e.occMax==="unbounded"?"\u221E":e.occMax)}}function Ae(i,t){if(i&1){let e=M();c(0,"div",23)(1,"div",24),C(2,ke,4,2,"div",25),c(3,"div",26)(4,"label"),p(5,"M\xE1ximo"),s(),C(6,Oe,2,1,"ng-container",19)(7,Le,1,1,"ng-template",null,1,Z),c(9,"label",27)(10,"input",28),E("change",function(r){N(e);let o=m(2);return w(o.toggleUnbounded(r.target.checked))}),s(),p(11," ilimitado "),s()(),c(12,"div",29)(13,"span"),p(14),s(),C(15,Ve,2,2,"span",14),s()()()}if(i&2){let e=K(8),n=m(2);a(2),d("ngIf",(n.occurs==null?null:n.occurs.min)===0||n.occMin===0),a(4),d("ngIf",n.occMax!=="unbounded")("ngIfElse",e),a(4),d("checked",n.occMax==="unbounded"),a(4),se("Atual: ",(n.occurs==null?null:n.occurs.min)??1,"..",(n.occurs==null?null:n.occurs.max)==="unbounded"?"\u221E":(n.occurs==null?null:n.occurs.max)??1),a(),d("ngIf",n.occMin!==((n.occurs==null?null:n.occurs.min)??1)||n.occMax!==((n.occurs==null?null:n.occurs.max)??1))}}function Pe(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xEDnimo (inclusive)"),s(),c(3,"input",37),E("input",function(r){N(e);let o=m(3);return w(o.setDateFacet("minInclusive",r.target.value))}),s()()}if(i&2){let e,n=m(3);a(3),d("type",n.dateInputType)("value",((e=n.edits.getDateFacets(n.node.id))==null?null:e.minInclusive)??(n.dateFacets==null?null:n.dateFacets.minInclusive)??"")}}function $e(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xEDnimo (exclusive)"),s(),c(3,"input",37),E("input",function(r){N(e);let o=m(3);return w(o.setDateFacet("minExclusive",r.target.value))}),s()()}if(i&2){let e,n=m(3);a(3),d("type",n.dateInputType)("value",((e=n.edits.getDateFacets(n.node.id))==null?null:e.minExclusive)??(n.dateFacets==null?null:n.dateFacets.minExclusive)??"")}}function Xe(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xE1ximo (inclusive)"),s(),c(3,"input",37),E("input",function(r){N(e);let o=m(3);return w(o.setDateFacet("maxInclusive",r.target.value))}),s()()}if(i&2){let e,n=m(3);a(3),d("type",n.dateInputType)("value",((e=n.edits.getDateFacets(n.node.id))==null?null:e.maxInclusive)??(n.dateFacets==null?null:n.dateFacets.maxInclusive)??"")}}function Re(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xE1ximo (exclusive)"),s(),c(3,"input",37),E("input",function(r){N(e);let o=m(3);return w(o.setDateFacet("maxExclusive",r.target.value))}),s()()}if(i&2){let e,n=m(3);a(3),d("type",n.dateInputType)("value",((e=n.edits.getDateFacets(n.node.id))==null?null:e.maxExclusive)??(n.dateFacets==null?null:n.dateFacets.maxExclusive)??"")}}function Be(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"Pattern (regex)"),s(),c(3,"input",38),E("input",function(r){N(e);let o=m(3);return w(o.setDateFacet("pattern",r.target.value))}),s()()}if(i&2){let e,n=m(3);a(3),d("value",((e=n.edits.getDateFacets(n.node.id))==null?null:e.pattern)??(n.dateFacets==null?null:n.dateFacets.pattern)??"")}}function ze(i,t){if(i&1&&(c(0,"div",33),C(1,Pe,4,2,"div",34)(2,$e,4,2,"div",34)(3,Xe,4,2,"div",34)(4,Re,4,2,"div",34)(5,Be,4,1,"div",34),s()),i&2){let e=m(2);a(),d("ngIf",e.showMinIncDate),a(),d("ngIf",e.showMinExcDate),a(),d("ngIf",e.showMaxIncDate),a(),d("ngIf",e.showMaxExcDate),a(),d("ngIf",e.showDatePattern)}}function je(i,t){if(i&1&&(c(0,"span",41),p(1),s()),i&2){let e=m(4);a(),V(" sugerido: ",e.inferredNum==null?null:e.inferredNum.min," ")}}function Ue(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xEDnimo (inclusive)"),s(),c(3,"input",32),E("input",function(r){N(e);let o=m(3);return w(o.setMinInclusive(r.target.valueAsNumber))}),s(),C(4,je,2,1,"span",40),s()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.minInclusive??(e.numericFacets==null?null:e.numericFacets.minInclusive)??(e.inferredNum==null?null:e.inferredNum.min)??""),a(),d("ngIf",(e.numericFacets==null?null:e.numericFacets.minInclusive)===void 0&&(e.inferredNum==null?null:e.inferredNum.min)!==void 0)}}function Ke(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xEDnimo (exclusive)"),s(),c(3,"input",32),E("input",function(r){N(e);let o=m(3);return w(o.setMinExclusive(r.target.valueAsNumber))}),s()()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.minExclusive??(e.numericFacets==null?null:e.numericFacets.minExclusive)??"")}}function Ze(i,t){if(i&1&&(c(0,"span",41),p(1),s()),i&2){let e=m(4);a(),V(" sugerido: ",e.inferredNum==null?null:e.inferredNum.max," ")}}function Ge(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xE1ximo (inclusive)"),s(),c(3,"input",32),E("input",function(r){N(e);let o=m(3);return w(o.setMaxInclusive(r.target.valueAsNumber))}),s(),C(4,Ze,2,1,"span",40),s()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.maxInclusive??(e.numericFacets==null?null:e.numericFacets.maxInclusive)??(e.inferredNum==null?null:e.inferredNum.max)??""),a(),d("ngIf",(e.numericFacets==null?null:e.numericFacets.maxInclusive)===void 0&&(e.inferredNum==null?null:e.inferredNum.max)!==void 0)}}function qe(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"M\xE1ximo (exclusive)"),s(),c(3,"input",32),E("input",function(r){N(e);let o=m(3);return w(o.setMaxExclusive(r.target.valueAsNumber))}),s()()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.maxExclusive??(e.numericFacets==null?null:e.numericFacets.maxExclusive)??"")}}function We(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"totalDigits"),s(),c(3,"input",31),E("input",function(r){N(e);let o=m(3);return w(o.setTotalDigits(r.target.valueAsNumber))}),s()()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.totalDigits??(e.numericFacets==null?null:e.numericFacets.totalDigits)??"")}}function He(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"fractionDigits"),s(),c(3,"input",42),E("input",function(r){N(e);let o=m(3);return w(o.setFractionDigits(r.target.valueAsNumber))}),s(),c(4,"span",41),p(5,"para decimais (xs:decimal)"),s()()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.fractionDigits??(e.numericFacets==null?null:e.numericFacets.fractionDigits)??"")}}function Je(i,t){if(i&1){let e=M();c(0,"div",35)(1,"label",36),p(2,"Pattern (regex)"),s(),c(3,"input",38),E("input",function(r){N(e);let o=m(3);return w(o.setNumPattern(r.target.value))}),s()()}if(i&2){let e=m(3);a(3),d("value",e.nfDraft.pattern??(e.numericFacets==null?null:e.numericFacets.pattern)??"")}}function Qe(i,t){if(i&1&&(c(0,"div",39),C(1,Ue,5,2,"div",34)(2,Ke,4,1,"div",34)(3,Ge,5,2,"div",34)(4,qe,4,1,"div",34)(5,We,4,1,"div",34)(6,He,6,1,"div",34)(7,Je,4,1,"div",34),s()),i&2){let e=m(2);a(),d("ngIf",e.showMinInclusive),a(),d("ngIf",e.showMinExclusive),a(),d("ngIf",e.showMaxInclusive),a(),d("ngIf",e.showMaxExclusive),a(),d("ngIf",e.showTotalDigits),a(),d("ngIf",e.showFractionDigits),a(),d("ngIf",e.showNumPattern)}}function Ye(i,t){if(i&1&&(c(0,"span",41),p(1),s()),i&2){let e=m(3);a(),V(" sugerido: ",e.inferredString==null?null:e.inferredString.minLength," ")}}function et(i,t){if(i&1&&(c(0,"span",41),p(1),s()),i&2){let e=m(3);a(),V(" sugerido: ",e.inferredString==null?null:e.inferredString.maxLength," ")}}function tt(i,t){if(i&1){let e=M();c(0,"div",43)(1,"div",35)(2,"label",36),p(3,"M\xEDnimo"),s(),c(4,"input",32),E("input",function(r){N(e);let o=m(2);return w(o.setMinLen(r.target.valueAsNumber))}),s(),C(5,Ye,2,1,"span",40),s(),c(6,"div",35)(7,"label",36),p(8,"M\xE1ximo"),s(),c(9,"input",32),E("input",function(r){N(e);let o=m(2);return w(o.setMaxLen(r.target.valueAsNumber))}),s(),C(10,et,2,1,"span",40),s(),c(11,"div",35)(12,"label",36),p(13,"Pattern (regex)"),s(),c(14,"input",44),E("input",function(r){N(e);let o=m(2);return w(o.setPattern(r.target.value))}),s(),c(15,"span",41),p(16,"adicionar/substituir (mais restritivo)"),s()()()}if(i&2){let e=m(2);a(4),d("value",e.minLenForForm),a(),d("ngIf",(e.stringFacets==null?null:e.stringFacets.minLength)===void 0&&(e.inferredString==null?null:e.inferredString.minLength)),a(4),d("value",e.maxLenForForm),a(),d("ngIf",(e.stringFacets==null?null:e.stringFacets.maxLength)===void 0&&(e.inferredString==null?null:e.inferredString.maxLength)),a(4),d("value",((e.sfDraft.patterns==null?null:e.sfDraft.patterns[0])??(e.stringFacets==null||e.stringFacets.patterns==null?null:e.stringFacets.patterns[0]))||"")}}function nt(i,t){if(i&1&&(c(0,"span",54),p(1),s()),i&2){let e=t.ngIf;a(),V(" ",e[0]||""," ")}}function it(i,t){if(i&1){let e=M();c(0,"button",55),E("click",function(){N(e);let r=m().$implicit,o=m(3);return w(o.removeEnum(r))}),p(1,"Remover"),s()}}function rt(i,t){if(i&1){let e=M();c(0,"button",56),E("click",function(){N(e);let r=m().$implicit,o=m(3);return w(o.undoEnum(r))}),p(1,"Desfazer"),s()}}function ot(i,t){if(i&1&&(c(0,"div",47)(1,"div",48)(2,"strong",49),p(3),s(),C(4,nt,2,1,"span",50),s(),c(5,"div",51),C(6,it,2,0,"button",52)(7,rt,2,0,"button",53),s()()),i&2){let e=t.$implicit,n=m(3);fe("removed",n.isEnumRemoved(e)),a(3),O(e.name),a(),d("ngIf",(e.meta==null?null:e.meta.docs)||(e.source==null||e.source.meta==null?null:e.source.meta.docs)),a(2),d("ngIf",!n.isEnumRemoved(e)),a(),d("ngIf",n.isEnumRemoved(e))}}function at(i,t){if(i&1&&(X(0),c(1,"div",45),C(2,ot,8,6,"div",46),s(),R()),i&2){let e=m(2);a(2),d("ngForOf",e.node.children||ge(2,Ce))("ngForTrackBy",e.trackById)}}function st(i,t){if(i&1&&W(0,"app-schema-node",58),i&2){let e=t.$implicit,n=m(4);d("node",e)("depth",n.depth+1)}}function ct(i,t){if(i&1&&(X(0),C(1,st,1,2,"app-schema-node",57),R()),i&2){let e=m(3);a(),d("ngForOf",e.filteredChildren())("ngForTrackBy",e.trackById)}}function lt(i,t){}function dt(i,t){if(i&1&&C(0,ct,2,2,"ng-container",19)(1,lt,0,0,"ng-template",null,2,Z),i&2){let e=K(2),n=m(2);d("ngIf",n.filteredChildren().length)("ngIfElse",e)}}function mt(i,t){if(i&1){let e=M();c(0,"div",13),E("click",function(r){return N(e),w(r.stopPropagation())}),C(1,De,3,2,"ng-container",14)(2,Ae,16,7,"div",15)(3,ze,6,5,"div",16)(4,Qe,8,7,"div",17)(5,tt,17,5,"div",18)(6,at,3,3,"ng-container",19)(7,dt,3,2,"ng-template",null,0,Z),s()}if(i&2){let e=K(8),n=m();a(),d("ngIf",(n.node.meta==null?null:n.node.meta.docs)||(n.node.source==null||n.node.source.meta==null?null:n.node.source.meta.docs)),a(),d("ngIf",n.showOccursEditor),a(),d("ngIf",n.showDateEditor),a(),d("ngIf",n.showNumericEditor),a(),d("ngIf",n.showStringEditor),a(),d("ngIf",n.node.kind==="enumeration")("ngIfElse",e)}}var ie=class i{constructor(t,e){this.edits=t;this.toggleBus=e}node;depth=0;expanded=!1;isOpen(t){return this.toggleBus.isOpen(t)}toggle(t){this.toggleBus.toggle(t)}get dateFacets(){return this.node.meta?.dateFacets??this.node.source?.meta?.dateFacets}get isDateSimpleType(){let t=(this.base||"").toLowerCase(),e=this.node.kind==="simpleType"||this.node.source?.kind==="simpleType",n=!!this.dateFacets?.enums?.length;return e&&/^(xs:date|xs:datetime|xs:gyearmonth|xs:gyear|xs:time)$/.test(t)&&!n}get showDateEditor(){return this.isDateSimpleType}get showMinIncDate(){return this.dateFacets?.minInclusive!==void 0}get showMinExcDate(){return this.dateFacets?.minExclusive!==void 0}get showMaxIncDate(){return this.dateFacets?.maxInclusive!==void 0}get showMaxExcDate(){return this.dateFacets?.maxExclusive!==void 0}get showDatePattern(){return this.dateFacets?.pattern!==void 0}get dateInputType(){let t=(this.base||"").toLowerCase();return t==="xs:date"?"date":t==="xs:datetime"?"datetime-local":t==="xs:gyearmonth"?"month":t==="xs:gyear"?"number":t==="xs:time"?"time":"text"}get isNumericSimpleType(){let t=(this.base||"").toLowerCase(),e=this.node.kind==="simpleType"||this.node.source?.kind==="simpleType",n=/^xs:(byte|short|int|integer|long|nonnegativeinteger|nonpositiveinteger|positiveinteger|negativeinteger|unsignedbyte|unsignedshort|unsignedint|unsignedlong|decimal)$/.test(t),r=!!(this.node.meta?.numericFacets?.enums?.length||this.node.source?.numericFacets?.enums?.length);return e&&n&&!r}get showNumericEditor(){return this.isNumericSimpleType}get numericFacets(){return this.node.meta?.numericFacets??this.node.source?.meta?.numericFacets}get inferredNum(){return this.node.meta?.inferred??this.node.source?.inferred}get showMinInclusive(){return this.numericFacets?.minInclusive!==void 0||this.inferredNum?.min!==void 0}get showMinExclusive(){return this.numericFacets?.minExclusive!==void 0}get showMaxInclusive(){return this.numericFacets?.maxInclusive!==void 0||this.inferredNum?.max!==void 0}get showMaxExclusive(){return this.numericFacets?.maxExclusive!==void 0}get showTotalDigits(){return this.numericFacets?.totalDigits!==void 0}get showFractionDigits(){return this.numericFacets?.fractionDigits!==void 0}get showNumPattern(){return this.numericFacets?.pattern!==void 0}get nfDraft(){return this.edits.getNumericFacets(this.node.id)??I({},this.numericFacets??{})}NUM_FACET_KINDS=new Set(["minInclusive","maxInclusive","minExclusive","maxExclusive","totalDigits","fractionDigits","pattern"]);filteredChildrenNum(){let t=this.node.children??[];return this.showNumericEditor?t.filter(e=>!this.NUM_FACET_KINDS.has(e.kind)):t}get inferredString(){return this.node.meta?.inferred??this.node.source?.inferred}get minLenForForm(){return this.edits.getStringFacets(this.node.id)?.minLength??this.stringFacets?.minLength??this.inferredString?.minLength??""}get maxLenForForm(){return this.edits.getStringFacets(this.node.id)?.maxLength??this.stringFacets?.maxLength??this.inferredString?.maxLength??""}get isStringType(){let t=this.base?.toLowerCase();return!!(t&&(t==="xs:string"||t.endsWith(":string")))}get sfDraft(){return this.edits.getStringFacets(this.node.id)??I({},this.stringFacets??{})}get stringFacets(){return this.node.meta?.stringFacets??this.node.source?.meta?.stringFacets??void 0}get isStringSimpleType(){let t=(this.base||"").toLowerCase();return(this.node.kind==="simpleType"||this.node.source?.kind==="simpleType")&&t.endsWith(":string")}get showStringEditor(){return this.isStringSimpleType&&!!this.stringFacets}get inferredMax(){return this.node.meta?.inferred?.maxLengthFromName??this.node.source?.meta?.inferred?.maxLengthFromName}get maxForForm(){let t=this.edits.getStringFacets(this.node.id)?.maxLength;if(t!==void 0)return t;let e=this.stringFacets?.maxLength;return e!==void 0?e:this.inferredMax??""}get occurs(){return this.node.meta?.occurs??this.node.source?.meta?.occurs??null}get showOccursEditor(){let t=this.occurs;if(!t)return!1;let e=t.min??1,n=t.max??1;return!(e===1&&n===1)}get occMin(){return this.edits.getOccursMin(this.node.id)??this.occurs?.min??1}get occMax(){return this.edits.getOccursMax(this.node.id)??this.occurs?.max??1}get docs(){return this.node?.meta?.docs??this.node?.source?.meta?.docs??[]}get typeName(){return this.node?.meta?.typeName??this.node?.source?.meta?.typeName}get base(){return this.node?.meta?.base??this.node?.source?.meta?.base}get use(){return this.node?.meta?.use??this.node?.source?.meta?.use}setDateFacet(t,e){let n=this.edits.getDateFacets(this.node.id)??I({},this.dateFacets??{}),r=D(I({},n),{[t]:e||void 0});t==="minInclusive"&&delete r.minExclusive,t==="minExclusive"&&delete r.minInclusive,t==="maxInclusive"&&delete r.maxExclusive,t==="maxExclusive"&&delete r.maxInclusive,this.edits.setDateFacets(this.node.id,r)}clampMin(t){let e=this.numericFacets?.minInclusive,n=this.numericFacets?.minExclusive;return e!==void 0&&t!==void 0&&(t=Math.max(t,e)),n!==void 0&&t!==void 0&&(t=Math.max(t,n+1)),t}clampMax(t){let e=this.numericFacets?.maxInclusive,n=this.numericFacets?.maxExclusive;return e!==void 0&&t!==void 0&&(t=Math.min(t,e)),n!==void 0&&t!==void 0&&(t=Math.min(t,n-1)),t}setMinInclusive(t){let e=this.clampMin(Number.isFinite(t)?Math.floor(t):void 0),n=D(I({},this.nfDraft),{minInclusive:e});delete n.minExclusive,this.edits.setNumericFacets(this.node.id,n)}setMinExclusive(t){let e=this.clampMin(Number.isFinite(t)?Math.floor(t):void 0),n=D(I({},this.nfDraft),{minExclusive:e});delete n.minInclusive,this.edits.setNumericFacets(this.node.id,n)}setMaxInclusive(t){let e=this.clampMax(Number.isFinite(t)?Math.floor(t):void 0),n=D(I({},this.nfDraft),{maxInclusive:e});delete n.maxExclusive,this.edits.setNumericFacets(this.node.id,n)}setMaxExclusive(t){let e=this.clampMax(Number.isFinite(t)?Math.floor(t):void 0),n=D(I({},this.nfDraft),{maxExclusive:e});delete n.maxInclusive,this.edits.setNumericFacets(this.node.id,n)}setTotalDigits(t){let e=D(I({},this.nfDraft),{totalDigits:Number.isFinite(t)&&t>0?Math.floor(t):void 0});this.edits.setNumericFacets(this.node.id,e)}setFractionDigits(t){let e=D(I({},this.nfDraft),{fractionDigits:Number.isFinite(t)&&t>=0?Math.floor(t):void 0});this.edits.setNumericFacets(this.node.id,e)}setNumPattern(t){let e=D(I({},this.nfDraft),{pattern:t||void 0});this.edits.setNumericFacets(this.node.id,e)}setMinLen(t){let e=this.stringFacets?.minLength??0,n=Math.max(e,Math.max(0,Math.floor(t||0))),r=D(I({},this.sfDraft),{minLength:n});r.length!==void 0&&(r.length=Math.max(r.length,n)),this.edits.setStringFacets(this.node.id,r)}setMaxLen(t){let e=this.stringFacets?.maxLength??1/0,n=Math.min(e,Math.max(1,Math.floor(t||1))),r=D(I({},this.sfDraft),{maxLength:n});r.length!==void 0&&(r.length=Math.min(r.length,n)),r.minLength!==void 0&&r.minLength>n&&(r.minLength=n),this.edits.setStringFacets(this.node.id,r)}setLen(t){let e=this.stringFacets?.length,n=this.stringFacets?.minLength??0,r=this.stringFacets?.maxLength??1/0,o=Math.max(e??0,Math.max(n,Math.min(r,Math.floor(t||0)))),g=D(I({},this.sfDraft),{length:o,minLength:o,maxLength:Math.min(r,o)});this.edits.setStringFacets(this.node.id,g)}setPattern(t){let e=(this.sfDraft.patterns??[]).slice(0,1);e[0]=t,this.edits.setStringFacets(this.node.id,D(I({},this.sfDraft),{patterns:e}))}setOccMin(t){let e=this.occMax==="unbounded"?1/0:this.occMax,n=Math.max(0,Math.min(t,e));this.edits.setOccurs(this.node.id,n,this.occMax)}setOccMax(t){let e=this.occMin,n=t;if(t!=="unbounded"){let r=Math.max(e,Number(t||0));n=r<1?1:r}this.edits.setOccurs(this.node.id,this.occMin,n)}toggleUnbounded(t){this.setOccMax(t?"unbounded":Math.max(this.occMin,50))}isEnumRemoved(t){let e=this.node.id;return this.edits.isEnumRemoved(e,t.name)}removeEnum(t){let e=this.node.id;this.edits.removeEnum(e,t.name)}undoEnum(t){let e=this.node.id;this.edits.undoEnum(e,t.name)}trackById=(t,e)=>e.id;trackStr=(t,e)=>e;STRING_FACET_KINDS=new Set(["length","minLength","maxLength","pattern"]);NUMERIC_FACET_KINDS=new Set(["minInclusive","maxInclusive","minExclusive","maxExclusive","totalDigits","fractionDigits","pattern"]);DATE_FACET_KINDS=new Set(["minInclusive","maxInclusive","minExclusive","maxExclusive","pattern"]);filteredChildren(){let t=this.node.children??[];return this.showStringEditor&&(t=t.filter(e=>!this.STRING_FACET_KINDS.has(e.kind))),this.showNumericEditor&&(t=t.filter(e=>!this.NUMERIC_FACET_KINDS.has(e.kind))),this.showDateEditor&&(t=t.filter(e=>!this.DATE_FACET_KINDS.has(e.kind))),t}static \u0275fac=function(e){return new(e||i)(L(G),L(q))};static \u0275cmp=z({type:i,selectors:[["app-schema-node"]],inputs:{node:"node",depth:"depth"},decls:11,vars:8,consts:[["normalChildren",""],["unbounded",""],["leaf",""],[1,"box"],[1,"box-head",3,"click"],[1,"left"],[1,"tag"],["class","doc",4,"ngIf"],["class","doc","style","margin-left:8px",4,"ngIf"],[1,"right"],["class","box-body",3,"click",4,"ngIf"],[1,"doc"],[1,"doc",2,"margin-left","8px"],[1,"box-body",3,"click"],[4,"ngIf"],["class","occurs",4,"ngIf"],["class","date-box",4,"ngIf"],["class","num-box",4,"ngIf"],["class","sf-box",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"docbox"],["class","docline",4,"ngFor","ngForOf","ngForTrackBy"],[1,"docline"],[1,"occurs"],[1,"occ-row"],["class","occ-item",4,"ngIf"],[1,"occ-item"],[1,"chk"],["type","checkbox",3,"change","checked"],[1,"occ-hint"],["type","number","min","0",3,"input","max","value"],["type","number","min","1",3,"input","value"],["type","number",3,"input","value"],[1,"date-box"],["class","sf-row",4,"ngIf"],[1,"sf-row"],[1,"lbl"],[3,"input","type","value"],["type","text",3,"input","value"],[1,"num-box"],["class","hint",4,"ngIf"],[1,"hint"],["type","number","min","0",3,"input","value"],[1,"sf-box"],["type","text","placeholder","ex.: ^\\\\S.*$",3,"input","value"],[1,"enum-list"],["class","enum-row",3,"removed",4,"ngFor","ngForOf","ngForTrackBy"],[1,"enum-row"],[1,"enum-left"],[1,"enum-value"],["class","enum-doc",4,"ngIf"],[1,"enum-actions"],["class","btn danger",3,"click",4,"ngIf"],["class","btn",3,"click",4,"ngIf"],[1,"enum-doc"],[1,"btn","danger",3,"click"],[1,"btn",3,"click"],[3,"node","depth",4,"ngFor","ngForOf","ngForTrackBy"],[3,"node","depth"]],template:function(e,n){e&1&&(c(0,"div",3)(1,"div",4),E("click",function(){return n.toggle(n.node.id)}),c(2,"div",5)(3,"span",6),p(4),s(),C(5,Ie,2,1,"span",7)(6,Me,2,1,"span",8)(7,Te,2,1,"span",8),s(),c(8,"div",9),p(9),s()(),C(10,mt,9,7,"div",10),s()),e&2&&(Y("margin-left",n.depth*5,"px"),a(4),O(n.node.name),a(),d("ngIf",n.typeName),a(),d("ngIf",n.base),a(),d("ngIf",n.use),a(2),O(n.expanded?"\u25BE":"\u25B8"),a(),d("ngIf",n.isOpen(n.node.id)))},dependencies:[i,ne,ee,te],styles:[".box[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:10px;margin-bottom:8px}.box-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;cursor:pointer}.box-body[_ngcontent-%COMP%]{border-top:1px dashed #e5e7eb;padding:12px}.left[_ngcontent-%COMP%]   .tag[_ngcontent-%COMP%]{font-weight:600;margin-right:8px}.right[_ngcontent-%COMP%]{opacity:.9}.docbox[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #eef2f7;border-radius:8px;padding:8px 10px;margin-bottom:10px}.docline[_ngcontent-%COMP%]{font-size:13px;color:#334155;line-height:1.35}.enum-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.enum-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;align-items:center;border:1px solid #f1f5f9;border-radius:10px;padding:10px 12px;background:#fff}.enum-row.removed[_ngcontent-%COMP%]{opacity:.55;background:#fafafa}.enum-left[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.enum-value[_ngcontent-%COMP%]{font-weight:600}.enum-doc[_ngcontent-%COMP%]{color:#475569;font-size:13px}.enum-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:6px 10px;border:1px solid #e5e7eb;border-radius:8px;background:#f8fafc;cursor:pointer}.enum-actions[_ngcontent-%COMP%]   .btn.danger[_ngcontent-%COMP%]{background:#fff1f2;border-color:#fecdd3}.occurs[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #eef2f7;border-radius:8px;padding:10px;margin-bottom:10px}.occ-row[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.occ-item[_ngcontent-%COMP%]{display:flex;gap:6px;align-items:center}.occ-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:90px;padding:6px 8px;border:1px solid #e5e7eb;border-radius:8px}.chk[_ngcontent-%COMP%]{display:flex;gap:6px;align-items:center;margin-left:8px;font-size:13px;color:#334155}.occ-hint[_ngcontent-%COMP%]{margin-left:auto;font-size:12px;color:#475569;display:flex;gap:8px}.sf-box[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #eef2f7;border-radius:8px;padding:10px;margin-bottom:10px;display:grid;gap:8px}.sf-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:180px 1fr auto;align-items:center;gap:10px}.lbl[_ngcontent-%COMP%]{font-weight:600}.sf-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:6px 8px;border:1px solid #e5e7eb;border-radius:8px}.hint[_ngcontent-%COMP%]{font-size:12px;color:#475569}.num-box[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #eef2f7;border-radius:8px;padding:10px;margin-bottom:10px;display:grid;gap:8px}"]})};var ut=["*"],re=class i{title="";width=720;confirmText="Confirmar";cancelText="Cancelar";disabled=!1;confirm=new ae;cancel=new ae;onBackdrop(t){t.target.classList.contains("modal-backdrop")&&this.cancel.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=z({type:i,selectors:[["app-modal"]],inputs:{title:"title",width:"width",confirmText:"confirmText",cancelText:"cancelText",disabled:"disabled"},outputs:{confirm:"confirm",cancel:"cancel"},ngContentSelectors:ut,decls:14,vars:6,consts:[[1,"modal-backdrop",3,"click"],[1,"modal-card",3,"click"],[1,"modal-header"],[1,"icon",3,"click"],[1,"modal-body"],[1,"modal-footer"],[1,"btn",3,"click"],[1,"btn","primary",3,"click","disabled"]],template:function(e,n){e&1&&(ue(),A(0,"div",0),U("click",function(o){return n.onBackdrop(o)}),A(1,"div",1),U("click",function(o){return o.stopPropagation()}),A(2,"div",2)(3,"h3"),p(4),j(),A(5,"button",3),U("click",function(){return n.cancel.emit()}),p(6,"\u2715"),j()(),A(7,"div",4),pe(8),j(),A(9,"div",5)(10,"button",6),U("click",function(){return n.cancel.emit()}),p(11),j(),A(12,"button",7),U("click",function(){return n.confirm.emit()}),p(13),j()()()()),e&2&&(a(),Y("max-width",n.width,"px"),a(3),O(n.title),a(7),O(n.cancelText),a(),me("disabled",n.disabled),a(),V(" ",n.confirmText," "))},styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172a59;display:flex;align-items:center;justify-content:center;padding:24px;z-index:50}.modal-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;box-shadow:0 10px 30px #0003;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #eef2f7}.modal-body[_ngcontent-%COMP%]{padding:12px 16px;overflow:auto}.modal-footer[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid #eef2f7}.btn[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;background:#f8fafc;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.icon[_ngcontent-%COMP%]{border:none;background:transparent;font-size:16px;cursor:pointer}"]})};var oe=class i{XS="http://www.w3.org/2001/XMLSchema";applyEnumRemovals(t,e,n){let r=h=>new DOMParser().parseFromString(h,"application/xml"),o=h=>new XMLSerializer().serializeToString(h),g=r(t),S=r(e),b=0,T=[];for(let h of n){let x=h.lastIndexOf("|");if(x<0)continue;let l=h.slice(0,x),f=h.slice(x+1),_=l.match(/\/st:([A-Za-z_][\w.-]*)/g),u=_?_[_.length-1]:null,v=u?u.replace("/st:",""):void 0,y=/\/st:inline/.test(l),F=y?l.match(/\/el:([A-Za-z_][\w.-]*)/):null,P=F?F[0].replace("/el:",""):void 0,k=!1;if(v&&(k=this.removeEnumUnderGlobalSimpleType(S,v,f),k)){b++,T.push(`Removido enum "${f}" de simpleType global ${v} (tipos.xsd).`);continue}if(!k&&y&&P&&(k=this.removeEnumUnderInlineSimpleType(g,P,f),k)){b++,T.push(`Removido enum "${f}" de simpleType inline do elemento ${P} (evento.xsd).`);continue}k||(k=this.removeEnumByValueAnywhere(S,f)||this.removeEnumByValueAnywhere(g,f),k?(b++,T.push(`Removido enum "${f}" por busca ampla (tipos/evento).`)):T.push(`\u26A0\uFE0F N\xE3o encontrado enum "${f}" para contexto: ${l}`))}return{eventoXml:o(g),tiposXml:o(S),changes:b,report:T}}removeEnumUnderGlobalSimpleType(t,e,n){let r=Array.from(t.getElementsByTagNameNS(this.XS,"simpleType")).find(S=>S.getAttribute("name")===e);if(!r)return!1;let o=this.firstChildNS(r,"restriction");if(!o)return!1;let g=Array.from(o.getElementsByTagNameNS(this.XS,"enumeration")).find(S=>S.getAttribute("value")===n);return!g||!g.parentNode?!1:(g.parentNode.removeChild(g),!0)}removeEnumUnderInlineSimpleType(t,e,n){let r=Array.from(t.getElementsByTagNameNS(this.XS,"element")).find(b=>b.getAttribute("name")===e);if(!r)return!1;let o=this.firstChildNS(r,"simpleType")||r.querySelector("xs\\:simpleType");if(!o)return!1;let g=this.firstChildNS(o,"restriction");if(!g)return!1;let S=Array.from(g.getElementsByTagNameNS(this.XS,"enumeration")).find(b=>b.getAttribute("value")===n);return!S||!S.parentNode?!1:(S.parentNode.removeChild(S),!0)}removeEnumByValueAnywhere(t,e){let r=Array.from(t.getElementsByTagNameNS(this.XS,"enumeration")).find(o=>o.getAttribute("value")===e);return!r||!r.parentNode?!1:(r.parentNode.removeChild(r),!0)}firstChildNS(t,e){for(let n of Array.from(t.children))if(n.namespaceURI===this.XS&&n.localName===e)return n;return null}applyOccursEdits(t,e,n){let r=l=>new DOMParser().parseFromString(l,"application/xml"),o=l=>new XMLSerializer().serializeToString(l),g="http://www.w3.org/2001/XMLSchema",S=r(t),b=r(e),T=[],h=0,x=(l,f,_,u)=>{let v=Array.from(l.getElementsByTagNameNS(g,"element")).find(y=>y.getAttribute("name")===f);return v?(_===1?v.removeAttribute("minOccurs"):v.setAttribute("minOccurs",String(_)),u===1?v.removeAttribute("maxOccurs"):v.setAttribute("maxOccurs",u==="unbounded"?"unbounded":String(u)),!0):!1};for(let[l,{min:f,max:_}]of n){let u=l.match(/\/el:([A-Za-z_][\w.-]*)/g),v=u?u[u.length-1]:null,y=v?v.replace("/el:",""):void 0;if(!y){T.push(`\u26A0\uFE0F Sem el:<name> no contexto ${l}`);continue}let F=x(S,y,f,_);F||(F=x(b,y,f,_)),F?(h++,T.push(`Ocorr\xEAncia de <${y}> \u2192 ${f}..${_==="unbounded"?"\u221E":_}.`)):T.push(`\u26A0\uFE0F <${y}> n\xE3o encontrado p/ aplicar ocorr\xEAncia.`)}return{eventoXml:o(S),tiposXml:o(b),changes:h,report:T}}applyStringFacets(t,e,n){let r=_=>new DOMParser().parseFromString(_,"application/xml"),o=_=>new XMLSerializer().serializeToString(_),g="http://www.w3.org/2001/XMLSchema",S=r(t),b=r(e),T=(_,u)=>{let v=Array.from(_.getElementsByTagNameNS(g,u)).find(y=>y.parentNode===_);return v||(v=_.ownerDocument.createElementNS(g,`xs:${u}`),_.appendChild(v)),v},h=(_,u,v)=>{if(Array.from(_.getElementsByTagNameNS(g,u)).forEach(F=>{F.parentNode===_&&F.parentNode.removeChild(F)}),v==null||v==="")return;let y=_.ownerDocument.createElementNS(g,`xs:${u}`);y.setAttribute("value",String(v)),_.appendChild(y)},x=(_,u)=>{let v=u.match(/\/st:([A-Za-z_][\w.-]*)/g),y=v?v[v.length-1].replace("/st:",""):void 0;if(y){let F=Array.from(_.getElementsByTagNameNS(g,"simpleType")).find(k=>k.getAttribute("name")===y);return F&&Array.from(F.children).find(k=>k.namespaceURI===g&&k.localName==="restriction")||null}if(/\/st:inline/.test(u)){let F=u.match(/\/el:([A-Za-z_][\w.-]*)/g),P=F?F[F.length-1].replace("/el:",""):void 0;if(P){let k=Array.from(_.getElementsByTagNameNS(g,"element")).find($=>$.getAttribute("name")===P),le=k&&Array.from(k.children).find($=>$.namespaceURI===g&&$.localName==="simpleType");return le&&Array.from(le.children).find($=>$.namespaceURI===g&&$.localName==="restriction")||null}}return null},l=0,f=[];for(let[_,u]of n){let v=x(b,_)||x(S,_);if(!v){f.push(`\u26A0\uFE0F Restriction n\xE3o encontrada para ${_}`);continue}let y=pt(v);u.minLength!==void 0&&y.minLength!==void 0&&u.minLength<y.minLength&&(u.minLength=y.minLength),u.maxLength!==void 0&&y.maxLength!==void 0&&u.maxLength>y.maxLength&&(u.maxLength=y.maxLength),u.length!==void 0&&(y.length!==void 0&&u.length<y.length&&(u.length=y.length),u.minLength=Math.max(u.minLength??0,u.length),u.maxLength=Math.min(u.maxLength??u.length,u.length)),h(v,"length",u.length),u.length===void 0?(h(v,"minLength",u.minLength),h(v,"maxLength",u.maxLength)):(h(v,"minLength",void 0),h(v,"maxLength",void 0)),u.patterns&&u.patterns[0]&&h(v,"pattern",u.patterns[0]),l++;let F=u.length??`${u.minLength??"\u2205"}..${u.maxLength??"\u221E"}`;f.push(`Facets de string atualizados (${_}) \u2192 ${F}${u.patterns?.[0]?`, pattern: ${u.patterns[0]}`:""}`)}return{eventoXml:o(S),tiposXml:o(b),changes:l,report:f}}applyNumericFacets(t,e,n){let r=x=>new DOMParser().parseFromString(x,"application/xml"),o=x=>new XMLSerializer().serializeToString(x),g=r(t),S=r(e),b=(x,l,f)=>{if(Array.from(x.getElementsByTagNameNS(H,l)).filter(u=>u.parentNode===x).forEach(u=>u.parentNode.removeChild(u)),f==null||f==="")return;let _=x.ownerDocument.createElementNS(H,`xs:${l}`);_.setAttribute("value",String(f)),x.appendChild(_)},T=0,h=[];for(let[x,l]of n){let f=J(S,x)||J(g,x);if(!f){h.push(`\u26A0\uFE0F Restriction n\xE3o encontrada para ${x}`);continue}l.minInclusive!==void 0&&delete l.minExclusive,l.maxInclusive!==void 0&&delete l.maxExclusive,l.minExclusive!==void 0&&delete l.minInclusive,l.maxExclusive!==void 0&&delete l.maxInclusive,b(f,"minInclusive",l.minInclusive),b(f,"maxInclusive",l.maxInclusive),b(f,"minExclusive",l.minExclusive),b(f,"maxExclusive",l.maxExclusive),b(f,"totalDigits",l.totalDigits),b(f,"fractionDigits",l.fractionDigits),b(f,"pattern",l.pattern),T++;let _=l.minInclusive??(l.minExclusive!==void 0?`>${l.minExclusive}`:"\u2205"),u=l.maxInclusive??(l.maxExclusive!==void 0?`<${l.maxExclusive}`:"\u2205");h.push(`Facets num\xE9ricos (${x}) \u2192 min:${_} max:${u}`+(l.totalDigits?`, totalDigits:${l.totalDigits}`:"")+(l.fractionDigits!==void 0?`, fractionDigits:${l.fractionDigits}`:"")+(l.pattern?", pattern":""))}return{eventoXml:o(g),tiposXml:o(S),changes:T,report:h}}applyDateFacets(t,e,n){let r=x=>new DOMParser().parseFromString(x,"application/xml"),o=x=>new XMLSerializer().serializeToString(x),g=r(t),S=r(e),b=(x,l,f)=>{if(Array.from(x.getElementsByTagNameNS(H,l)).filter(u=>u.parentNode===x).forEach(u=>u.parentNode.removeChild(u)),f==null||f==="")return;let _=x.ownerDocument.createElementNS(H,`xs:${l}`);_.setAttribute("value",f),x.appendChild(_)},T=0,h=[];for(let[x,l]of n){let f=J(S,x)||J(g,x);if(!f){h.push(`\u26A0\uFE0F Restriction n\xE3o encontrada para ${x}`);continue}l.minInclusive!==void 0&&delete l.minExclusive,l.maxInclusive!==void 0&&delete l.maxExclusive,l.minExclusive!==void 0&&delete l.minInclusive,l.maxExclusive!==void 0&&delete l.maxInclusive,b(f,"minInclusive",l.minInclusive),b(f,"maxInclusive",l.maxInclusive),b(f,"minExclusive",l.minExclusive),b(f,"maxExclusive",l.maxExclusive),b(f,"pattern",l.pattern),T++,h.push(`Datas (${x}) \u2192 min:${l.minInclusive??(l.minExclusive?">"+l.minExclusive:"\u2205")} max:${l.maxInclusive??(l.maxExclusive?"<"+l.maxExclusive:"\u2205")}${l.pattern?", pattern":""}`)}return{eventoXml:o(g),tiposXml:o(S),changes:T,report:h}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};function pt(i){let t="http://www.w3.org/2001/XMLSchema",e={};for(let n of Array.from(i.children)){if(n.namespaceURI!==t)continue;let r=n,o=r.getAttribute("value");switch(r.localName){case"length":e.length=o?Number(o):void 0;break;case"minLength":e.minLength=o?Number(o):void 0;break;case"maxLength":e.maxLength=o?Number(o):void 0;break;case"pattern":(e.patterns??=[]).push(o??"");break}}return e}var gt=["class","component"];function _t(i,t){if(i&1&&W(0,"app-schema-node",18),i&2){let e=t.$implicit;d("node",e)("depth",0)}}function xt(i,t){if(i&1&&(X(0),C(1,_t,1,2,"app-schema-node",17),R()),i&2){let e=m(3);a(),d("ngForOf",e.topLevelViewNodes)("ngForTrackBy",e.trackNode)}}function ht(i,t){i&1&&(c(0,"p",19),p(1," Esquema n\xE3o dispon\xEDvel "),s())}function vt(i,t){if(i&1){let e=M();c(0,"div",13),C(1,xt,2,2,"ng-container",14)(2,ht,2,0,"ng-template",null,0,Z),c(4,"div",15)(5,"button",16),E("click",function(){N(e);let r=m(2);return w(r.openConfirm())}),p(6,"Salvar altera\xE7\xF5es"),s()()()}if(i&2){let e=K(3),n=m(2);a(),d("ngIf",n.rootNode)("ngIfElse",e)}}function bt(i,t){if(i&1){let e=M();c(0,"div",6)(1,"div",7)(2,"div",8),E("click",function(r){N(e);let o=m();return w(o.toggleRoot(r))}),c(3,"div",9)(4,"span",10),p(5),s()(),c(6,"div",11),p(7),s()(),C(8,vt,7,2,"div",12),s()()}if(i&2){let e=m();a(5),O(e.label),a(2),O(e.rootOpen?"\u25BE":"\u25B8"),a(),d("ngIf",e.rootOpen)}}function Et(i,t){i&1&&(c(0,"div",19),p(1,"Nenhuma altera\xE7\xE3o pendente."),s())}function St(i,t){if(i&1&&(c(0,"li"),p(1),s()),i&2){let e=t.$implicit;a(),O(e)}}function yt(i,t){if(i&1&&(c(0,"div")(1,"h4",23),p(2,"Relat\xF3rio"),s(),c(3,"ul",24),C(4,St,2,1,"li",25),s(),c(5,"details")(6,"summary"),p(7,"Pr\xE9via dos arquivos (ap\xF3s aplicar)"),s(),c(8,"div",26)(9,"div")(10,"div",27)(11,"strong"),p(12),s()(),c(13,"pre",28),p(14),s()(),c(15,"div")(16,"div",27)(17,"strong"),p(18,"tipos.xsd"),s()(),c(19,"pre",28),p(20),s()()()()()),i&2){let e=m(2);a(4),d("ngForOf",e.reportLines),a(8),O(e.fileName),a(2),O(e.previewEvento),a(6),O(e.previewTipos)}}function Nt(i,t){if(i&1){let e=M();c(0,"app-modal",20),E("confirm",function(){N(e);let r=m();return w(r.confirmApply())})("cancel",function(){N(e);let r=m();return w(r.showConfirm=!1)}),C(1,Et,2,0,"div",21)(2,yt,21,4,"div",22),s()}if(i&2){let e=m();d("width",900)("confirmText","Aplicar agora")("cancelText","Voltar")("disabled",e.applyDisabled),a(),d("ngIf",e.applyDisabled),a(),d("ngIf",!e.applyDisabled)}}var Ne=class i{constructor(t,e,n,r,o,g,S){this.route=t;this.router=e;this.store=n;this.treeService=r;this.edits=o;this.mut=g;this.treeToggle=S;let b=this.route.snapshot.paramMap.get("schemaId");this.fileName=this.route.snapshot.paramMap.get("fileName"),this.schema=this.store.get(b);let T=this.schema?.events.find(h=>h.fileName===this.fileName);if(this.label=T?.isTipos?"tipos":T?.label||this.fileName,this.title=this.label,this.fileName==="tipos.xsd"){console.log(this.schema);let h=this.schema?.files[this.fileName];this.rootNode=this.treeService.buildTiposTree(String(h))}else{let h=this.schema?.files["tipos.xsd"],x=this.schema?.files[this.fileName];this.rootNode=this.treeService.buildEventoTree(String(x),String(h))}if(this.rootNode){let h=this.rootNode.kind==="schema"&&this.rootNode.children?.length?D(I({},this.rootNode),{children:this.rootNode.children}):this.rootNode;this.viewRoot=ce(h)}}schema=null;label="";title="";fileName="";rootNode=null;viewRoot=null;showConfirm=!1;reportLines=[];previewEvento="";previewTipos="";applyDisabled=!1;rootOpen=!0;openAll(){this.viewRoot&&this.treeToggle.openAllFrom(this.viewRoot)}closeAll(){this.treeToggle.closeAll()}get topLevelViewNodes(){return this.viewRoot?this.viewRoot.children??[this.viewRoot]:[]}trackNode=(t,e)=>e.id;toggleRoot(t){t?.stopPropagation(),this.rootOpen=!this.rootOpen}goBack(){history.length>1?history.back():this.router.navigate(["/gerenciamento"])}openConfirm(){if(!this.schema)return;let t=this.schema.files||{},e=t[this.fileName]||"",n=Object.keys(t).find(h=>/^tipos.*\.xsd$/i.test(h))||"tipos.xsd",r=t[n]||"",o=this.mut.applyEnumRemovals(e,r,this.edits.snapshot()),g=this.mut.applyOccursEdits(o.eventoXml,o.tiposXml,this.edits.snapshotOccurs()),S=this.mut.applyStringFacets(g.eventoXml,g.tiposXml,this.edits.snapshotStringFacets()),b=this.mut.applyNumericFacets(S.eventoXml,S.tiposXml,this.edits.snapshotNumericFacets()),T=this.mut.applyDateFacets(b.eventoXml,b.tiposXml,this.edits.snapshotDateFacets());this.reportLines=[...o.report,...g.report,...S.report,...b.report,...T.report],this.previewEvento=g.eventoXml,this.previewTipos=g.tiposXml,this.showConfirm=!0,this.applyDisabled=o.changes+g.changes+S.changes===0}confirmApply(){if(!this.schema)return;let t=I({},this.schema.files),e=Object.keys(t).find(o=>/^tipos.*\.xsd$/i.test(o))||"tipos.xsd";t[this.fileName]=this.previewEvento||t[this.fileName],t[e]=this.previewTipos||t[e];let n=D(I({},this.schema),{files:t});this.store.upsert(n),this.edits.clear(),this.showConfirm=!1;let r=this.store.get(n.id);if(r){if(this.schema=r,this.fileName==="tipos.xsd"){console.log(this.schema);let o=this.schema?.files[this.fileName];this.rootNode=this.treeService.buildTiposTree(String(o))}else{let o=this.schema?.files["tipos.xsd"],g=this.schema?.files[this.fileName];this.rootNode=this.treeService.buildEventoTree(String(g),String(o))}if(this.rootNode){let o=this.rootNode.kind==="schema"&&this.rootNode.children?.length?D(I({},this.rootNode),{children:this.rootNode.children}):this.rootNode;this.viewRoot=ce(o)}}alert("Altera\xE7\xF5es aplicadas com sucesso!")}static \u0275fac=function(e){return new(e||i)(L(_e),L(xe),L(ve),L(be),L(G),L(oe),L(q))};static \u0275cmp=z({type:i,selectors:[["app-evento-detail",8,"component"]],attrs:gt,decls:10,vars:2,consts:[["noTree",""],[1,"header"],[1,"btn",3,"click"],[2,"flex","1"],["class","card",4,"ngIf"],["title","Aplicar altera\xE7\xF5es no XSD",3,"width","confirmText","cancelText","disabled","confirm","cancel",4,"ngIf"],[1,"card"],[1,"box"],[1,"box-head",3,"click"],[1,"left"],[1,"tag"],[1,"right"],["class","box-body",4,"ngIf"],[1,"box-body"],[4,"ngIf","ngIfElse"],[1,"actions"],[1,"btn","primary",3,"click"],[3,"node","depth",4,"ngFor","ngForOf","ngForTrackBy"],[3,"node","depth"],[1,"muted"],["title","Aplicar altera\xE7\xF5es no XSD",3,"confirm","cancel","width","confirmText","cancelText","disabled"],["class","muted",4,"ngIf"],[4,"ngIf"],[2,"margin","8px 0 6px"],[2,"margin","0 0 12px 18px","padding","0"],[4,"ngFor","ngForOf"],[2,"display","grid","grid-template-columns","1fr 1fr","gap","12px","margin-top","10px"],[1,"docline"],[2,"max-height","45vh","overflow","auto","background","#0f172a","color","#e2e8f0","padding","10px","border-radius","8px","font-size","12px"]],template:function(e,n){e&1&&(c(0,"div",1)(1,"button",2),E("click",function(){return n.goBack()}),p(2,"\u2190 Voltar"),s(),W(3,"span",3),c(4,"button",2),E("click",function(){return n.openAll()}),p(5,"Abrir tudo"),s(),c(6,"button",2),E("click",function(){return n.closeAll()}),p(7,"Fechar tudo"),s()(),C(8,bt,9,3,"div",4)(9,Nt,3,6,"app-modal",5)),e&2&&(a(8),d("ngIf",n.schema),a(),d("ngIf",n.showConfirm))},dependencies:[ne,ee,te,he,ie,re],styles:[".header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:12px}.btn[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;background:#f8fafc;cursor:pointer}.btn.primary[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}.box[_ngcontent-%COMP%]{border:1px dashed #e5e7eb;border-radius:10px;margin-bottom:8px}.box-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;cursor:pointer}.tag[_ngcontent-%COMP%]{font-weight:600;margin-right:8px}.doc[_ngcontent-%COMP%]{color:#334155}.box-body[_ngcontent-%COMP%]{border-top:1px dashed #e5e7eb;padding:12px}.subbox[_ngcontent-%COMP%]{border:1px solid #f1f5f9;border-radius:10px;margin:8px 0}.subbox-head[_ngcontent-%COMP%]{padding:8px 12px;background:#f8fafc;border-bottom:1px solid #f1f5f9;border-radius:10px 10px 0 0}.subbox-body[_ngcontent-%COMP%]{padding:12px}.muted[_ngcontent-%COMP%]{color:#64748b;font-size:13px}.actions[_ngcontent-%COMP%]{margin-top:8px;display:flex;gap:8px}"]})};export{Ne as EventoDetailComponent};
